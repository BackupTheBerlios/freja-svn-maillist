<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Freja-svn] r21 - in trunk: . lib src/auxiliary
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/freja-svn/2006-April/index.html" >
   <LINK REL="made" HREF="mailto:freja-svn%40lists.berlios.de?Subject=Re%3A%20%5BFreja-svn%5D%20r21%20-%20in%20trunk%3A%20.%20lib%20src/auxiliary&In-Reply-To=%3C200604020928.k329S1iU020603%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Freja-svn] r21 - in trunk: . lib src/auxiliary</H1>
    <B>troelskn at BerliOS</B> 
    <A HREF="mailto:freja-svn%40lists.berlios.de?Subject=Re%3A%20%5BFreja-svn%5D%20r21%20-%20in%20trunk%3A%20.%20lib%20src/auxiliary&In-Reply-To=%3C200604020928.k329S1iU020603%40sheep.berlios.de%3E"
       TITLE="[Freja-svn] r21 - in trunk: . lib src/auxiliary">troelskn at berlios.de
       </A><BR>
    <I>Sun Apr  2 11:28:01 CEST 2006</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000018.html">[Freja-svn] r22 - in trunk: lib src/auxiliary tests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17">[ date ]</a>
              <a href="thread.html#17">[ thread ]</a>
              <a href="subject.html#17">[ subject ]</a>
              <a href="author.html#17">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: troelskn
Date: 2006-04-02 11:28:00 +0200 (Sun, 02 Apr 2006)
New Revision: 21

Added:
   trunk/src/auxiliary/minimal.js
Modified:
   trunk/build.wsf
   trunk/lib/Freja.js
   trunk/src/auxiliary/default.js
Log:
added minimal auxiliary and updated build-script

Modified: trunk/build.wsf
===================================================================
--- trunk/build.wsf	2006-03-31 07:14:29 UTC (rev 20)
+++ trunk/build.wsf	2006-04-02 09:28:00 UTC (rev 21)
@@ -5,55 +5,72 @@
 	var Shell = WScript.CreateObject(&quot;WScript.Shell&quot;);
 	var FileSystem = WScript.CreateObject(&quot;Scripting.FileSystemObject&quot;);
 	var cwd = FileSystem.GetParentFolderName(WScript.ScriptFullName);
-	var srcDir = cwd + &quot;/src&quot;;
-	var outfile = cwd + &quot;/lib/Freja.js&quot;;
-	try {
-		FileSystem.deleteFile(outfile);
-	} catch (ex) {}
+	var srcDir = cwd + &quot;\\src&quot;;
 
-	var file = FileSystem.openTextFile(srcDir + &quot;/Freja.js&quot;, 1, -2);
-	var source = file.readAll();
-	var VERSION = source.match(/Freja.VERSION \= \&quot;(.*)\&quot;/)[1];
-	file.close();
-	source = null;
+	var dialog = WScript.CreateObject(&quot;UserAccounts.CommonDialog&quot;);
+	dialog.Filter = &quot;JavaScript files (*.js)|*.js| &quot;;
+//	dialog.Title = &quot;Select auxiliary&quot;;
+	dialog.InitialDir = srcDir + &quot;\\auxiliary&quot;;
+	dialog.FilterIndex = 1
 	
-	var TARGET = &quot;default&quot;;
-	var SUBMODULES = [
-		&quot;Freja&quot;,
-		&quot;auxiliary/&quot; + TARGET,
-		&quot;QueryEngine&quot;,
-		&quot;Model&quot;,
-		&quot;View&quot;,
-		&quot;UndoHistory&quot;,
-		&quot;AssetManager&quot;
-	];
+	
+	if (dialog.ShowOpen()) {
+		var AUXILIARY = dialog.FileName;
 
-	var buildID = (new Date()).toUTCString();
+		var outfile = cwd + &quot;/lib/Freja.js&quot;;
+		try {
+			FileSystem.deleteFile(outfile);
+		} catch (ex) {}
 
-	var header = &quot;/&quot; + &quot;***\n&quot; +
-		&quot;\n    Freja &quot; + VERSION +
-		&quot;\n&quot; +
-		&quot;\n    Build $&quot; + buildID + &quot;$&quot; +
-		&quot;\n&quot; +
-		&quot;\n    THIS FILE IS AUTOMATICALLY GENERATED.  If creating patches, please&quot; +
-		&quot;\n    diff against the source tree, not this file.&quot; +
-		&quot;\n&quot; +
-		&quot;\n    Copyright (c) 2006 C&#233;dric Savarese &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freja-svn">pro at 4213miles.com</A>&gt;, Troels Knak-Nielsen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freja-svn">troelskn at gmail.com</A>&gt;&quot; +
-		&quot;\n    This software is licensed under the CC-GNU LGPL &lt;<A HREF="http://creativecommons.org/licenses/LGPL/2.1/">http://creativecommons.org/licenses/LGPL/2.1/</A>&gt;&quot; +
-		&quot;\n&quot; +
-		&quot;\n***&quot; + &quot;/&quot; +
-		&quot;\n&quot;;
+		var file = FileSystem.openTextFile(srcDir + &quot;/Freja.js&quot;, 1, -2);
+		var source = file.readAll();
+		var VERSION = source.match(/Freja.VERSION \= \&quot;(.*)\&quot;/)[1];
+		file.close();
+		source = null;
 
-	var source = &quot;&quot;;
-	for (var i=0; i &lt; SUBMODULES.length; ++i) {
-		var filename = srcDir + &quot;/&quot; + SUBMODULES[i] + &quot;.js&quot;;
-		var file = FileSystem.openTextFile(filename, 1, -2);
-		source += &quot;\n&quot; + file.readAll();
-		file.close();
+		var SUBMODULES = [
+			&quot;Freja&quot;,
+			&quot;AUXILIARY&quot;,
+			&quot;QueryEngine&quot;,
+			&quot;Model&quot;,
+			&quot;View&quot;,
+			&quot;UndoHistory&quot;,
+			&quot;AssetManager&quot;
+		];
+
+		var buildID = (new Date()).toUTCString();
+
+		var header = &quot;/&quot; + &quot;***\n&quot; +
+			&quot;\n    Freja &quot; + VERSION +
+			&quot;\n&quot; +
+			&quot;\n    Build $&quot; + buildID + &quot;$&quot; +
+			&quot;\n&quot; +
+			&quot;\n    Target: &quot; + AUXILIARY.match(/([^\\]*).js$/)[1] +
+			&quot;\n&quot; +
+			&quot;\n    THIS FILE IS AUTOMATICALLY GENERATED.  If creating patches, please&quot; +
+			&quot;\n    diff against the source tree, not this file.&quot; +
+			&quot;\n&quot; +
+			&quot;\n    Copyright (c) 2006 C&#233;dric Savarese &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freja-svn">pro at 4213miles.com</A>&gt;, Troels Knak-Nielsen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freja-svn">troelskn at gmail.com</A>&gt;&quot; +
+			&quot;\n    This software is licensed under the CC-GNU LGPL &lt;<A HREF="http://creativecommons.org/licenses/LGPL/2.1/">http://creativecommons.org/licenses/LGPL/2.1/</A>&gt;&quot; +
+			&quot;\n&quot; +
+			&quot;\n***&quot; + &quot;/&quot; +
+			&quot;\n&quot;;
+
+		var source = &quot;&quot;;
+		for (var i=0; i &lt; SUBMODULES.length; ++i) {
+			if (SUBMODULES[i] == 'AUXILIARY') {
+				var filename = AUXILIARY;
+			} else {
+				var filename = srcDir + &quot;/&quot; + SUBMODULES[i] + &quot;.js&quot;;
+			}
+			var file = FileSystem.openTextFile(filename, 1, -2);
+			source += &quot;\n&quot; + file.readAll();
+			file.close();
+		}
+		var out = FileSystem.openTextFile(outfile, 2, -2);
+		out.write(header + source);
+		out.close();
 	}
-	var out = FileSystem.openTextFile(outfile, 2, -2);
-	out.write(header + source);
-	out.close();
 	]]&gt;
 	&lt;/script&gt;
 &lt;/job&gt;
\ No newline at end of file

Modified: trunk/lib/Freja.js
===================================================================
--- trunk/lib/Freja.js	2006-03-31 07:14:29 UTC (rev 20)
+++ trunk/lib/Freja.js	2006-04-02 09:28:00 UTC (rev 21)
@@ -2,8 +2,10 @@
 
     Freja 2.0.alpha
 
-    Build $Fri, 31 Mar 2006 07:12:48 UTC$
+    Build $Sun, 2 Apr 2006 09:27:01 UTC$
 
+    Target: default
+
     THIS FILE IS AUTOMATICALLY GENERATED.  If creating patches, please
     diff against the source tree, not this file.
 
@@ -87,18 +89,18 @@
 	Freja = {};
 }
 Freja._aux = {};
-/** bind(func, self[, arg, ...]) : function */
+/** bind(func, self) : function */
 Freja._aux.bind = MochiKit.Base.bind;
 /** formContents(elem) : Array */
 Freja._aux.formContents = MochiKit.DOM.formContents;
-/** getElement() : HTMLElement */
+/** getElement(id) : HTMLElement */
 Freja._aux.getElement = MochiKit.DOM.getElement;
 
 /** registerSignals(src, signals) : void */
 Freja._aux.registerSignals = MochiKit.Signal.registerSignals;
-/** connect(src, signal, dest[, func]) : void */
+/** connect(src, signal, fnc) : void */
 Freja._aux.connect = MochiKit.Signal.connect;
-/** signal(src, signal, ...) : void */
+/** signal(src, signal, arg) : void */
 Freja._aux.signal = MochiKit.Signal.signal;
 /** createDeferred() : Deferred */
 Freja._aux.createDeferred = function() {

Modified: trunk/src/auxiliary/default.js
===================================================================
--- trunk/src/auxiliary/default.js	2006-03-31 07:14:29 UTC (rev 20)
+++ trunk/src/auxiliary/default.js	2006-04-02 09:28:00 UTC (rev 21)
@@ -40,18 +40,18 @@
 	Freja = {};
 }
 Freja._aux = {};
-/** bind(func, self[, arg, ...]) : function */
+/** bind(func, self) : function */
 Freja._aux.bind = MochiKit.Base.bind;
 /** formContents(elem) : Array */
 Freja._aux.formContents = MochiKit.DOM.formContents;
-/** getElement() : HTMLElement */
+/** getElement(id) : HTMLElement */
 Freja._aux.getElement = MochiKit.DOM.getElement;
 
 /** registerSignals(src, signals) : void */
 Freja._aux.registerSignals = MochiKit.Signal.registerSignals;
-/** connect(src, signal, dest[, func]) : void */
+/** connect(src, signal, fnc) : void */
 Freja._aux.connect = MochiKit.Signal.connect;
-/** signal(src, signal, ...) : void */
+/** signal(src, signal, arg) : void */
 Freja._aux.signal = MochiKit.Signal.signal;
 /** createDeferred() : Deferred */
 Freja._aux.createDeferred = function() {

Added: trunk/src/auxiliary/minimal.js
===================================================================
--- trunk/src/auxiliary/minimal.js	2006-03-31 07:14:29 UTC (rev 20)
+++ trunk/src/auxiliary/minimal.js	2006-04-02 09:28:00 UTC (rev 21)
@@ -0,0 +1,217 @@
+/**
+  * Freja._aux
+  * wrapper for external dependencies (frameworks).
+  *
+  * This is the minimal auxiliary adapter. It contains self-sufficient
+  * implementations of all dependencies.
+  *
+  */
+if (typeof(Freja) == &quot;undefined&quot;) {
+	Freja = {};
+}
+Freja._aux = {};
+/** bind(func, self) : function */
+Freja._aux.bind = function(func, self) {
+	return function() { func.apply(self, arguments); };
+};
+/** formContents(elem) : Array */
+Freja._aux.formContents = MochiKit.DOM.formContents;
+/** getElement(id) : HTMLElement */
+Freja._aux.getElement = function(id) {
+	if (typeof(id) == &quot;object&quot;) {
+		return id;
+	} else {
+		return document.getElementById(id);
+	}
+};
+
+/** registerSignals(src, signals) : void */
+Freja._aux.registerSignals = function(src, signals) { /* void */ };
+/** connect(src, signal, fnc) : void */
+Freja._aux.connect = function(src, signal, fnc) {
+	if(!src) return;
+	if (src.addEventListener) {
+		var wrapper = function(e) {
+			var evt = {
+				stop : function() {
+					if (e.cancelable) {
+						e.preventDefault();
+					}
+					e.stopPropagation();
+				}
+			}
+			fnc(evt);
+		}
+		src.addEventListener(signal.replace(/^(on)/, &quot;&quot;), wrapper, false);
+	} else if (src.attachEvent) {
+		var wrapper = function() {
+			var e = window.event;
+			var evt = {
+				stop : function() {
+					e.cancelBubble = true;
+					e.returnValue = false;
+				}
+			}
+			fnc(evt);
+		}
+		src.attachEvent(signal, wrapper);
+	}
+	if (!src._signals) {
+		src._signals = [];
+	}
+	if (!src._signals[signal]) {
+		src._signals[signal] = [];
+	}
+	src._signals[signal].push(fnc);
+};
+/** signal(src, signal, ...) : void */
+Freja._aux.signal = function(src, signal) {
+	try {
+		var sigs = src._signals[signal];
+		var args = [];
+		for (var i=2; i &lt; arguments.length; i++) {
+			args.push(arguments[i]);
+		}
+		for (var i=0; i &lt; sigs.length; i++) {
+			try {
+				sigs[i].apply(src, args);
+			} catch (e) { /* squelch */ }
+		}
+	} catch (e) { /* squelch */ }
+};
+/** createDeferred() : Deferred */
+Freja._aux.createDeferred = function() {
+	return new Freja._aux.Deferred();
+};
+/** openXMLHttpRequest(method, url, async, user, pass) : XMLHttpRequest */
+Freja._aux.openXMLHttpRequest = function(method, url, async, user, pass) {
+	var req;
+	method = method.toUpperCase();
+	try { req = new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;); }
+	catch (e) { try { req = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;); }
+	catch (e) { req = new XMLHttpRequest(); }}
+	if (!req) throw new Error(&quot;Can't create XMLHttpRequest&quot;);
+	if (user &amp;&amp; pass) {
+		req.open(method, url, async, user, pass);
+	} else {
+		req.open(method, url, async);
+	}
+	if (method == &quot;POST&quot; || method == &quot;PUT&quot;) {
+		req.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
+	}
+	return req;
+};
+/** sendXMLHttpRequest(req, sendContent) : Deferred */
+Freja._aux.sendXMLHttpRequest = function(req, sendContent) {
+	var d = Freja._aux.createDeferred();
+	var bComplete = false;
+	req.onreadystatechange = function() {
+		if (req.readyState == 4 &amp;&amp; !bComplete) {
+			if (req.status == 0 || req.status == 200 || req.status == 304) {
+				d.callback(req);
+			} else {
+				d.errback(req);
+			}
+			bComplete = true;
+		}
+	}
+	if (!sendContent) sendContent = &quot;&quot;;
+	req.send(sendContent);
+	return d;
+};
+/** xmlize(anyObject, objectName) : string */
+Freja._aux.xmlize = Sarissa.xmlize;
+/** serializeXML(node) : string */
+Freja._aux.serializeXML = Sarissa.serialize;
+/** loadXML(string) : XMLDocument */
+Freja._aux.loadXML = function(text) {
+	return (new DOMParser()).parseFromString(text, &quot;text/xml&quot;);
+};
+/** transformXSL(XMLDocument, XSLDocument) : string */
+Freja._aux.transformXSL = function(xml, xsl) {
+	var processor = new XSLTProcessor();
+	processor.importStylesheet(xsl);
+	return Freja._aux.serializeXML(processor.transformToDocument(xml));
+
+};
+/** cloneXMLDocument(document) : XMLDocument */
+Freja._aux.cloneXMLDocument = function(xmlDoc) {
+	var clone = null;
+	try {
+		clone = xmlDoc.cloneNode(true);
+	} catch(e) { /* squelch */ }
+
+	// Can't clone a DocumentNode in Safari &amp; Opera. Let's try something else.
+	// @note Wouldn't it be easier to serialize the document to string and the parse it to a new document ?
+	if (!clone) {
+		if (document.implementation &amp;&amp; document.implementation.createDocument) {
+			clone = document.implementation.createDocument(&quot;&quot;, xmlDoc.documentElement.nodeName, null);
+			// importNode is not safe in Safari ! the source document is altered. used cloneNode to fix the prblm
+			var data = clone.importNode(xmlDoc.documentElement.cloneNode(true), true);
+			try {
+				clone.appendChild(data);
+			} catch(e) {
+				// Opera has already created a documentElement and can't append another root node
+				var rootNode = clone.documentElement;
+				for (var i = data.childNodes.length; i &gt;= 0; i--) {
+					rootNode.insertBefore(data.childNodes[i], rootNode.firstChild);
+				}
+				// need to copy root node attributes
+				for (var i = 0; i &lt; xmlDoc.documentElement.attributes.length; i++) {
+					var name  = xmlDoc.documentElement.attributes.item(i).name;
+					var value = xmlDoc.documentElement.attributes.item(i).value;
+					clone.documentElement.setAttribute(name, value);
+				}
+			}
+		}
+	}
+	return clone;
+};
+/** hasSupportForXSLT() : boolean */
+Freja._aux.hasSupportForXSLT = function() { return (typeof(XSLTProcessor) != &quot;undefined&quot;); };
+/** createQueryEngine() : Freja.QueryEngine */
+Freja._aux.createQueryEngine = function() {
+	if (Sarissa.IS_ENABLED_SELECT_NODES) {
+		return new Freja.QueryEngine.XPath();
+	} else {
+		return new Freja.QueryEngine.SimplePath();
+	}
+};
+/** A pale replacement for MochiKit.Async.Deferred */
+Freja._aux.Deferred = function() {
+	this._good = [];
+	this._bad = [];
+	this._pending = null;
+};
+Freja._aux.Deferred.prototype.callback = function() {
+	if (this._good.length == 0) {
+		this._pending = [this.callback, arguments];
+		return;
+	}
+	for (var i=0; i &lt; this._good.length; i++) {
+		this._good[i].apply(window, arguments);
+	}
+};
+Freja._aux.Deferred.prototype.errback = function() {
+	if (this._bad.length == 0) {
+		this._pending = [this.errback, arguments];
+		return;
+	}
+	for (var i=0; i &lt; this._bad.length; i++) {
+		this._bad[i].apply(window, arguments);
+	}
+};
+Freja._aux.Deferred.prototype.addCallbacks = function(fncOK, fncError) {
+	if (fncOK) this._good[this._good.length] = fncOK;
+	if (fncError) this._bad[this._bad.length] = fncError;
+
+	if (this._pending) {
+		this._pending[0].apply(this, this._pending[1]);
+	}
+};
+Freja._aux.Deferred.prototype.addCallback = function(fncOK) {
+	this.addCallbacks(fncOK);
+};
+Freja._aux.Deferred.prototype.addErrback = function(fncError) {
+	this.addCallbacks(null, fncOK);
+};


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000018.html">[Freja-svn] r22 - in trunk: lib src/auxiliary tests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17">[ date ]</a>
              <a href="thread.html#17">[ thread ]</a>
              <a href="subject.html#17">[ subject ]</a>
              <a href="author.html#17">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/freja-svn">More information about the Freja-svn
mailing list</a><br>
</body></html>
