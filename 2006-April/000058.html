<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Freja-svn] r62 - in trunk: lib src src/auxiliary tests tests/data
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/freja-svn/2006-April/index.html" >
   <LINK REL="made" HREF="mailto:freja-svn%40lists.berlios.de?Subject=Re%3A%20%5BFreja-svn%5D%20r62%20-%20in%20trunk%3A%20lib%20src%20src/auxiliary%20tests%20tests/data&In-Reply-To=%3C200604290920.k3T9KEtm017688%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000059.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Freja-svn] r62 - in trunk: lib src src/auxiliary tests tests/data</H1>
    <B>troelskn at BerliOS</B> 
    <A HREF="mailto:freja-svn%40lists.berlios.de?Subject=Re%3A%20%5BFreja-svn%5D%20r62%20-%20in%20trunk%3A%20lib%20src%20src/auxiliary%20tests%20tests/data&In-Reply-To=%3C200604290920.k3T9KEtm017688%40sheep.berlios.de%3E"
       TITLE="[Freja-svn] r62 - in trunk: lib src src/auxiliary tests tests/data">troelskn at berlios.de
       </A><BR>
    <I>Sat Apr 29 11:20:14 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000059.html">[Freja-svn] r61 - trunk/src
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58">[ date ]</a>
              <a href="thread.html#58">[ thread ]</a>
              <a href="subject.html#58">[ subject ]</a>
              <a href="author.html#58">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: troelskn
Date: 2006-04-29 11:20:10 +0200 (Sat, 29 Apr 2006)
New Revision: 62

Modified:
   trunk/lib/Freja.js
   trunk/lib/MochiKit.js
   trunk/src/Model.js
   trunk/src/QueryEngine.js
   trunk/src/View.js
   trunk/src/auxiliary/minimal.js
   trunk/src/auxiliary/mochi+sarissa.js
   trunk/tests/data/form-view.xsl
   trunk/tests/test_View.js
Log:
Upgraded MochiKit to latest release, which got rid of registerSignal
Also fixed a bug in SimplePath and fixed tests

Modified: trunk/lib/Freja.js
===================================================================
--- trunk/lib/Freja.js	2006-04-28 21:18:29 UTC (rev 61)
+++ trunk/lib/Freja.js	2006-04-29 09:20:10 UTC (rev 62)
@@ -2,7 +2,7 @@
 
     Freja 2.0.alpha
 
-    Build $Tue, 25 Apr 2006 17:39:11 UTC$
+    Build $Sat, 29 Apr 2006 09:18:08 UTC$
 
     Target: minimal
 
@@ -133,8 +133,6 @@
 	}
 };
 
-/** registerSignals(src, signals) : void */
-Freja._aux.registerSignals = function(src, signals) { /* void */ };
 /** connect(src, signal, fnc) : void */
 Freja._aux.connect = function(src, signal, fnc) {
 
@@ -512,37 +510,35 @@
 	}
 };
 Freja.QueryEngine.prototype.get = function(document, expression) {
-	var node = this._find(document, expression);
+	try {
+		var node = this._find(document, expression);
+	} catch(x) {
+		return null;
+	}
 	if(node) return node.nodeValue;
-	return null;
+
 };
 Freja.QueryEngine.prototype.set = function(document, expression, value) {
-	var node = this._find(document, expression);	
-	if(node) {
-		node.nodeValue = value;
-	} else {
+	try {
+		var node = this._find(document, expression);
+		if(node)
+			node.nodeValue = value;
+	} catch(x) {
 		// text node not found. Might need to be created.
-		// try not to process field names that are not meant to be xpath expressions  
-		if(expression.lastIndexOf('/') != -1) {		 	
+		// try not to process field names that are not meant to be xpath expressions
+		if(expression.lastIndexOf('/') != -1) {
 			var nodeName = expression.substr(expression.lastIndexOf('/')+1);
-			
 			if(nodeName.charAt(0)=='@') {
 				// trying to set a non-existing attribute. Let's create it.
-				var newexpression =  expression.substring(0, expression.lastIndexOf('/'));
-				var node = document.selectSingleNode(newexpression);
-				if(node) 
-					node.setAttribute(nodeName.substr(1),value);
-			} else {
-				// this could be an empty node (&lt;tag /&gt;)
-				// let's try to create the text node.
-				var node = document.selectSingleNode(expression);
-				if(node) {
-					var n = document.createTextNode(value);
-					node.appendChild(n);							
-				} else {
-					// the element does not exist.
+				var parentExpression =  expression.substring(0, expression.lastIndexOf('/'));
+				var pNode = this._find(document, parentExpression);
+				if(pNode) {
+					// this._find returns a text node
+					pNode = pNode.parentNode;
+					pNode.setAttribute(nodeName.substr(1),value);
 				}
 			}
+			// else parent element does not exist.. can't do anything
 		}
 	}
 };
@@ -555,12 +551,19 @@
 	var node = document.selectSingleNode(expression);
 	if (node &amp;&amp; node.nodeType == 2) {
 		return node;
-	} else if (node &amp;&amp; node.firstChild &amp;&amp; node.firstChild.nodeType == 3) {
+	}
+	if (node &amp;&amp; node.firstChild &amp;&amp; node.firstChild.nodeType == 3) {
 		return node.firstChild;
-	} else if (node &amp;&amp; node.firstChild &amp;&amp; node.firstChild.nodeType == 4) {
+	}
+	if (node &amp;&amp; node.firstChild &amp;&amp; node.firstChild.nodeType == 4) {
 		return node.firstChild;
-	} 
-//	throw new Error(&quot;Can't evaluate expression &quot; + expression);
+	}
+	if (node &amp;&amp; node.nodeType==1 &amp;&amp; !node.firstChild) {
+		// empty element (&lt;tag/&gt;). Let's create and return a blank text node
+		return node.appendChild(window.document.createTextNode(''));
+	}
+
+	throw new Error(&quot;Can't evaluate expression &quot; + expression);
 	return null;
 };
 /**
@@ -569,38 +572,65 @@
 Freja.QueryEngine.SimplePath = function() {};
 Freja.Class.extend(Freja.QueryEngine.SimplePath, Freja.QueryEngine);
 Freja.QueryEngine.SimplePath.prototype._find = function(document, expression) {
-	if (!expression.match(/^[\d\w\/@\[\]]*$/)) {
+	if (!expression.match(/^[\d\w\/@\[\]=_\-']*$/)) {
 		throw new Error(&quot;Can't evaluate expression &quot; + expression);
 	}
 	var parts = expression.split(/\//);
 	var node = document;
 	var regAttr = new RegExp(&quot;^@([\\d\\w]*)&quot;);
 	var regOffset = new RegExp(&quot;^([@\\d\\w]*)\\[([\\d]*)\\]$&quot;);
+	var regFilter = new RegExp(&quot;^([\\d\\w]+)\\[@([@\\d\\w]+)=['\&quot;]{1}(.*)['\&quot;]{1}\\]$&quot;);
 	var attr = null;
 	var offset = 0;
 	for (var i = 0; i &lt; parts.length; ++i) {
 		var part = parts[i];
-		offset = regOffset.exec(part);
-		if (offset) {
-			part = offset[1];
-			offset = offset[2] - 1;
-		} else {
-			offset = 0;
+		var filter = regFilter.exec(part);
+		if(filter) {
+			// filter[1] element name, filter[2] attribute name, filter[3] attribute value
+			if(i&gt;0 &amp;&amp; parts[i-1]=='') {
+				// expression was of type //element[...]
+				var cn = node.getElementsByTagName(filter[1]);
+			} else {
+				var cn = node.childNodes;
+			}
+			for(var j=0, l=cn.length; j&lt;l ; j++) {
+				if(cn[j].nodeType==1 &amp;&amp; cn[j].tagName==filter[1] &amp;&amp; cn[j].getAttribute(filter[2])== filter[3]) {
+					node = cn[j];
+					break;
+				}
+			}
+			if (j==l)
+				throw new Error(&quot;Can't evaluate expression &quot; + part);
 		}
-		if (part != &quot;&quot;) {
-			attr = regAttr.exec(part);
-			if (attr) {
-				node = node.getAttributeNode(attr[1]);
+		else {
+			offset = regOffset.exec(part);
+			if (offset) {
+				part = offset[1];
+				offset = offset[2] - 1;
 			} else {
-				node = node.getElementsByTagName(part).item(offset);
+				offset = 0;
 			}
+			if (part != &quot;&quot;) {
+				attr = regAttr.exec(part);
+				if (attr) {
+					node = node.getAttributeNode(attr[1]);
+				} else {
+					node = node.getElementsByTagName(part).item(offset);
+				}
+			}
 		}
 	}
 	if (node &amp;&amp; node.firstChild &amp;&amp; node.firstChild.nodeType == 3) {
 		return node.firstChild;
-	} else if (node &amp;&amp; node.firstChild &amp;&amp; node.firstChild.nodeType == 4) {
+	}
+	if (node &amp;&amp; node.firstChild &amp;&amp; node.firstChild.nodeType == 4) {
 		return node.firstChild;
 	}
+	if (node &amp;&amp; node.nodeType==1 &amp;&amp; !node.firstChild) {
+		// empty element (&lt;tag/&gt;). Let's create and return a blank text node
+		return node.appendChild(window.document.createTextNode(''));
+	}
+
 	if (!node) {
 		throw new Error(&quot;Can't evaluate expression &quot; + expression);
 	}
@@ -614,7 +644,6 @@
 	this.ready = false;
 	this.document = null;
 	this._query = query;
-	Freja._aux.registerSignals(this, [&quot;onload&quot;]);
 };
 /**
   * Returns a single value
@@ -744,7 +773,6 @@
 	this._destination = null;
 	this.behaviors = [];
 	this.placeholder = null;
-	Freja._aux.registerSignals(this, [&quot;onload&quot;,&quot;onrendercomplete&quot;]);
 	Freja._aux.connect(this, &quot;onrendercomplete&quot;, Freja._aux.bind(this._connectBehavior, this));
 };
 /**
@@ -841,8 +869,8 @@
 				var child = c[i];
 				if (child.nodeType == 1) {
 					if(child.className) {
-						var classNames = child.className.split(' ');						
-						for (var j=0;j&lt;classNames.length;j++) {											
+						var classNames = child.className.split(' ');
+						for (var j=0;j&lt;classNames.length;j++) {
 							var handler = behaviors[classNames[j]];
 							if (handler) {
 								for (var eventType in handler) {
@@ -928,8 +956,15 @@
 	// prepare posted data  (no need to send the XSL document, just its url)
 	var xslUrl = view.url;
 	var postedData = &quot;xslFile=&quot; + encodeURIComponent(xslUrl) + &quot;&amp;xmlData=&quot; + encodeURIComponent(Freja._aux.serializeXML(model.document));
-	if (xslParameters)
-		postedData  = postedData + &quot;&amp;xslParam=&quot; + encodeURIComponent(xslParameters.toString());
+
+	var xslParameterString = '';
+	for (var paramname in xslParameters) {
+		xslParameterString += encodeURIComponent(paramname + &quot;,&quot; + xslParameters[paramname]);
+	}
+	if(xslParameterString.length &gt; 0) {
+		postedData  = postedData + '&amp;xslParam=' + xslParameterString;
+	}
+
 	// send request to the server-side XSL transformation service
 	var req = Freja.AssetManager.openXMLHttpRequest(&quot;POST&quot;, Freja.AssetManager.XSLT_SERVICE_URL);
 	req.onreadystatechange = function() {

Modified: trunk/lib/MochiKit.js
===================================================================
--- trunk/lib/MochiKit.js	2006-04-28 21:18:29 UTC (rev 61)
+++ trunk/lib/MochiKit.js	2006-04-29 09:20:10 UTC (rev 62)
@@ -1,6 +1,6 @@
 /***
 
-    MochiKit.MochiKit 1.3 : PACKED VERSION
+    MochiKit.MochiKit 1.3.1 : PACKED VERSION
 
     THIS FILE IS AUTOMATICALLY GENERATED.  If creating patches, please
     diff against the source tree, not this file.
@@ -20,15 +20,15 @@
 if(typeof (MochiKit.Base)==&quot;undefined&quot;){
 MochiKit.Base={};
 }
-MochiKit.Base.VERSION=&quot;1.3&quot;;
+MochiKit.Base.VERSION=&quot;1.3.1&quot;;
 MochiKit.Base.NAME=&quot;MochiKit.Base&quot;;
 MochiKit.Base.update=function(_1,_2){
-if(_1==null){
+if(_1===null){
 _1={};
 }
 for(var i=1;i&lt;arguments.length;i++){
 var o=arguments[i];
-if(typeof (o)!=&quot;undefined&quot;&amp;&amp;o!=null){
+if(typeof (o)!=&quot;undefined&quot;&amp;&amp;o!==null){
 for(var k in o){
 _1[k]=o[k];
 }
@@ -41,7 +41,7 @@
 },toString:function(){
 return this.__repr__();
 },counter:function(n){
-if(arguments.length==0){
+if(arguments.length===0){
 n=1;
 }
 return function(){
@@ -53,10 +53,25 @@
 me.prototype=_7;
 return new me();
 }
-},extend:function(_9,obj,_11){
-if(!_11){
-_11=0;
+},flattenArguments:function(_9){
+var res=[];
+var m=MochiKit.Base;
+var _12=m.extend(null,arguments);
+while(_12.length){
+var o=_12.shift();
+if(o&amp;&amp;typeof (o)==&quot;object&quot;&amp;&amp;typeof (o.length)==&quot;number&quot;){
+for(var i=o.length-1;i&gt;=0;i--){
+_12.unshift(o[i]);
 }
+}else{
+res.push(o);
+}
+}
+return res;
+},extend:function(_13,obj,_15){
+if(!_15){
+_15=0;
+}
 if(obj){
 var l=obj.length;
 if(typeof (l)!=&quot;number&quot;){
@@ -67,68 +82,68 @@
 throw new TypeError(&quot;Argument not an array-like and MochiKit.Iter not present&quot;);
 }
 }
-if(!_9){
-_9=[];
+if(!_13){
+_13=[];
 }
-for(var i=_11;i&lt;l;i++){
-_9.push(obj[i]);
+for(var i=_15;i&lt;l;i++){
+_13.push(obj[i]);
 }
 }
-return _9;
-},updatetree:function(_13,obj){
-if(_13==null){
-_13={};
+return _13;
+},updatetree:function(_17,obj){
+if(_17===null){
+_17={};
 }
 for(var i=1;i&lt;arguments.length;i++){
 var o=arguments[i];
-if(typeof (o)!=&quot;undefined&quot;&amp;&amp;o!=null){
+if(typeof (o)!=&quot;undefined&quot;&amp;&amp;o!==null){
 for(var k in o){
 var v=o[k];
-if(typeof (_13[k])==&quot;object&quot;&amp;&amp;typeof (v)==&quot;object&quot;){
-arguments.callee(_13[k],v);
+if(typeof (_17[k])==&quot;object&quot;&amp;&amp;typeof (v)==&quot;object&quot;){
+arguments.callee(_17[k],v);
 }else{
-_13[k]=v;
+_17[k]=v;
 }
 }
 }
 }
-return _13;
-},setdefault:function(_15,obj){
-if(_15==null){
-_15={};
+return _17;
+},setdefault:function(_19,obj){
+if(_19===null){
+_19={};
 }
 for(var i=1;i&lt;arguments.length;i++){
 var o=arguments[i];
 for(var k in o){
-if(!(k in _15)){
-_15[k]=o[k];
+if(!(k in _19)){
+_19[k]=o[k];
 }
 }
 }
-return _15;
+return _19;
 },keys:function(obj){
-var _16=[];
-for(var _17 in obj){
-_16.push(_17);
+var _20=[];
+for(var _21 in obj){
+_20.push(_21);
 }
-return _16;
+return _20;
 },items:function(obj){
-var _18=[];
+var _22=[];
 var e;
-for(var _20 in obj){
+for(var _24 in obj){
 var v;
 try{
-v=obj[_20];
+v=obj[_24];
 }
 catch(e){
 continue;
 }
-_18.push([_20,v]);
+_22.push([_24,v]);
 }
-return _18;
-},_newNamedError:function(_21,_22,_23){
-_23.prototype=new MochiKit.Base.NamedError(_21.NAME+&quot;.&quot;+_22);
-_21[_22]=_23;
+return _22;
+},_newNamedError:function(_25,_26,_27){
+_27.prototype=new MochiKit.Base.NamedError(_25.NAME+&quot;.&quot;+_26);
+_25[_26]=_27;
 },operator:{truth:function(a){
 return !!a;
 },lognot:function(a){
@@ -174,9 +189,9 @@
 },le:function(a,b){
 return a&lt;=b;
 },ceq:function(a,b){
-return MochiKit.Base.compare(a,b)==0;
+return MochiKit.Base.compare(a,b)===0;
 },cne:function(a,b){
-return MochiKit.Base.compare(a,b)!=0;
+return MochiKit.Base.compare(a,b)!==0;
 },cgt:function(a,b){
 return MochiKit.Base.compare(a,b)==1;
 },cge:function(a,b){
@@ -191,23 +206,23 @@
 return a||b;
 },contains:function(a,b){
 return b in a;
-}},forward:function(_26){
+}},forwardCall:function(_30){
 return function(){
-return this[_26].apply(this,arguments);
+return this[_30].apply(this,arguments);
 };
-},itemgetter:function(_27){
+},itemgetter:function(_31){
 return function(arg){
-return arg[_27];
+return arg[_31];
 };
 },typeMatcher:function(){
-var _29={};
+var _33={};
 for(var i=0;i&lt;arguments.length;i++){
 var typ=arguments[i];
-_29[typ]=typ;
+_33[typ]=typ;
 }
 return function(){
 for(var i=0;i&lt;arguments.length;i++){
-if(!(typeof (arguments[i]) in _29)){
+if(!(typeof (arguments[i]) in _33)){
 return false;
 }
 }
@@ -223,11 +238,13 @@
 },isUndefinedOrNull:function(){
 for(var i=0;i&lt;arguments.length;i++){
 var o=arguments[i];
-if(!(typeof (o)==&quot;undefined&quot;||o==null)){
+if(!(typeof (o)==&quot;undefined&quot;||o===null)){
 return false;
 }
 }
 return true;
+},isEmpty:function(obj){
+return !MochiKit.Base.isNotEmpty.apply(this,arguments);
 },isNotEmpty:function(obj){
 for(var i=0;i&lt;arguments.length;i++){
 var o=arguments[i];
@@ -240,7 +257,7 @@
 for(var i=0;i&lt;arguments.length;i++){
 var o=arguments[i];
 var typ=typeof (o);
-if((typ!=&quot;object&quot;&amp;&amp;!(typ==&quot;function&quot;&amp;&amp;typeof (o.item)==&quot;function&quot;))||o==null||typeof (o.length)!=&quot;number&quot;){
+if((typ!=&quot;object&quot;&amp;&amp;!(typ==&quot;function&quot;&amp;&amp;typeof (o.item)==&quot;function&quot;))||o===null||typeof (o.length)!=&quot;number&quot;){
 return false;
 }
 }
@@ -248,84 +265,85 @@
 },isDateLike:function(){
 for(var i=0;i&lt;arguments.length;i++){
 var o=arguments[i];
-if(typeof (o)!=&quot;object&quot;||o==null||typeof (o.getTime)!=&quot;function&quot;){
+if(typeof (o)!=&quot;object&quot;||o===null||typeof (o.getTime)!=&quot;function&quot;){
 return false;
 }
 }
 return true;
 },xmap:function(fn){
-if(fn==null){
+if(fn===null){
 return MochiKit.Base.extend(null,arguments,1);
 }
-var _32=[];
+var _36=[];
 for(var i=1;i&lt;arguments.length;i++){
-_32.push(fn(arguments[i]));
+_36.push(fn(arguments[i]));
 }
-return _32;
+return _36;
 },map:function(fn,lst){
 var m=MochiKit.Base;
-var _35=m.isArrayLike;
+var itr=MochiKit.Iter;
+var _39=m.isArrayLike;
 if(arguments.length&lt;=2){
-if(!_35(lst)){
-if(MochiKit.Iter){
-lst=MochiKit.Iter.list(lst);
-if(fn==null){
+if(!_39(lst)){
+if(itr){
+lst=itr.list(lst);
+if(fn===null){
 return lst;
 }
 }else{
 throw new TypeError(&quot;Argument not an array-like and MochiKit.Iter not present&quot;);
 }
 }
-if(fn==null){
+if(fn===null){
 return m.extend(null,lst);
 }
-var _36=[];
+var _40=[];
 for(var i=0;i&lt;lst.length;i++){
-_36.push(fn(lst[i]));
+_40.push(fn(lst[i]));
 }
-return _36;
+return _40;
 }else{
-if(fn==null){
+if(fn===null){
 fn=Array;
 }
-var _37=null;
+var _41=null;
 for(i=1;i&lt;arguments.length;i++){
-if(!_35(arguments[i])){
-if(MochiKit.Iter){
-arguments[i]=MochiKit.Iter.list(arguments[i]);
+if(!_39(arguments[i])){
+if(itr){
+return itr.list(itr.imap.apply(null,arguments));
 }else{
 throw new TypeError(&quot;Argument not an array-like and MochiKit.Iter not present&quot;);
 }
 }
 var l=arguments[i].length;
-if(_37==null||_37&gt;l){
-_37=l;
+if(_41===null||_41&gt;l){
+_41=l;
 }
 }
-_36=[];
-for(i=0;i&lt;_37;i++){
-var _38=[];
+_40=[];
+for(i=0;i&lt;_41;i++){
+var _42=[];
 for(var j=1;j&lt;arguments.length;j++){
-_38.push(arguments[j][i]);
+_42.push(arguments[j][i]);
 }
-_36.push(fn.apply(this,_38));
+_40.push(fn.apply(this,_42));
 }
-return _36;
+return _40;
 }
 },xfilter:function(fn){
-var _40=[];
-if(fn==null){
+var _44=[];
+if(fn===null){
 fn=MochiKit.Base.operator.truth;
 }
 for(var i=1;i&lt;arguments.length;i++){
 var o=arguments[i];
 if(fn(o)){
-_40.push(o);
+_44.push(o);
 }
 }
-return _40;
-},filter:function(fn,lst,_41){
-var _42=[];
+return _44;
+},filter:function(fn,lst,_45){
+var _46=[];
 var m=MochiKit.Base;
 if(!m.isArrayLike(lst)){
 if(MochiKit.Iter){
@@ -334,116 +352,119 @@
 throw new TypeError(&quot;Argument not an array-like and MochiKit.Iter not present&quot;);
 }
 }
-if(fn==null){
+if(fn===null){
 fn=m.operator.truth;
 }
 if(typeof (Array.prototype.filter)==&quot;function&quot;){
-return Array.prototype.filter.call(lst,fn,_41);
+return Array.prototype.filter.call(lst,fn,_45);
 }else{
-if(typeof (_41)==&quot;undefined&quot;||_41==null){
+if(typeof (_45)==&quot;undefined&quot;||_45===null){
 for(var i=0;i&lt;lst.length;i++){
 var o=lst[i];
 if(fn(o)){
-_42.push(o);
+_46.push(o);
 }
 }
 }else{
 for(i=0;i&lt;lst.length;i++){
 o=lst[i];
-if(fn.call(_41,o)){
-_42.push(o);
+if(fn.call(_45,o)){
+_46.push(o);
 }
 }
 }
 }
-return _42;
-},_wrapDumbFunction:function(_43){
+return _46;
+},_wrapDumbFunction:function(_47){
 return function(){
 switch(arguments.length){
 case 0:
-return _43();
+return _47();
 case 1:
-return _43(arguments[0]);
+return _47(arguments[0]);
 case 2:
-return _43(arguments[0],arguments[1]);
+return _47(arguments[0],arguments[1]);
 case 3:
-return _43(arguments[0],arguments[1],arguments[2]);
+return _47(arguments[0],arguments[1],arguments[2]);
 }
-var _44=[];
+var _48=[];
 for(var i=0;i&lt;arguments.length;i++){
-_44.push(&quot;arguments[&quot;+i+&quot;]&quot;);
+_48.push(&quot;arguments[&quot;+i+&quot;]&quot;);
 }
-return eval(&quot;(func(&quot;+_44.join(&quot;,&quot;)+&quot;))&quot;);
+return eval(&quot;(func(&quot;+_48.join(&quot;,&quot;)+&quot;))&quot;);
 };
-},bind:function(_45,_46){
-if(typeof (_45)==&quot;string&quot;){
-_45=_46[_45];
+},method:function(_49,_50){
+var m=MochiKit.Base;
+return m.bind.apply(this,m.extend([_50,_49],arguments,2));
+},bind:function(_51,_52){
+if(typeof (_51)==&quot;string&quot;){
+_51=_52[_51];
 }
-var _47=_45.im_func;
-var _48=_45.im_preargs;
-var _49=_45.im_self;
+var _53=_51.im_func;
+var _54=_51.im_preargs;
+var _55=_51.im_self;
 var m=MochiKit.Base;
-if(typeof (_45)==&quot;function&quot;&amp;&amp;typeof (_45.apply)==&quot;undefined&quot;){
-_45=m._wrapDumbFunction(_45);
+if(typeof (_51)==&quot;function&quot;&amp;&amp;typeof (_51.apply)==&quot;undefined&quot;){
+_51=m._wrapDumbFunction(_51);
 }
-if(typeof (_47)!=&quot;function&quot;){
-_47=_45;
+if(typeof (_53)!=&quot;function&quot;){
+_53=_51;
 }
-if(typeof (_46)!=&quot;undefined&quot;){
-_49=_46;
+if(typeof (_52)!=&quot;undefined&quot;){
+_55=_52;
 }
-if(typeof (_48)==&quot;undefined&quot;){
-_48=[];
+if(typeof (_54)==&quot;undefined&quot;){
+_54=[];
 }else{
-_48=_48.slice();
+_54=_54.slice();
 }
-m.extend(_48,arguments,2);
-var _50=function(){
-var _51=arguments;
+m.extend(_54,arguments,2);
+var _56=function(){
+var _57=arguments;
 var me=arguments.callee;
 if(me.im_preargs.length&gt;0){
-_51=m.concat(me.im_preargs,_51);
+_57=m.concat(me.im_preargs,_57);
 }
-var _46=me.im_self;
-if(!_46){
-_46=this;
+var _52=me.im_self;
+if(!_52){
+_52=this;
 }
-return me.im_func.apply(_46,_51);
+return me.im_func.apply(_52,_57);
 };
-_50.im_self=_49;
-_50.im_func=_47;
-_50.im_preargs=_48;
-return _50;
-},bindMethods:function(_52){
-var _53=MochiKit.Base.bind;
-for(var k in _52){
-var _54=_52[k];
-if(typeof (_54)==&quot;function&quot;){
-_52[k]=_53(_54,_52);
+_56.im_self=_55;
+_56.im_func=_53;
+_56.im_preargs=_54;
+return _56;
+},bindMethods:function(_58){
+var _59=MochiKit.Base.bind;
+for(var k in _58){
+var _60=_58[k];
+if(typeof (_60)==&quot;function&quot;){
+_58[k]=_59(_60,_58);
 }
 }
-},registerComparator:function(_55,_56,_57,_58){
-MochiKit.Base.comparatorRegistry.register(_55,_56,_57,_58);
+},registerComparator:function(_61,_62,_63,_64){
+MochiKit.Base.comparatorRegistry.register(_61,_62,_63,_64);
 },_primitives:{&quot;bool&quot;:true,&quot;string&quot;:true,&quot;number&quot;:true},compare:function(a,b){
 if(a==b){
 return 0;
 }
-var _59=(typeof (a)==&quot;undefined&quot;||a==null);
-var _60=(typeof (b)==&quot;undefined&quot;||b==null);
-if(_59&amp;&amp;_60){
+var _65=(typeof (a)==&quot;undefined&quot;||a===null);
+var _66=(typeof (b)==&quot;undefined&quot;||b===null);
+if(_65&amp;&amp;_66){
 return 0;
 }else{
-if(_59){
+if(_65){
 return -1;
 }else{
-if(_60){
+if(_66){
 return 1;
 }
 }
 }
 var m=MochiKit.Base;
-var _61=m._primitives;
-if(!(typeof (a) in _61&amp;&amp;typeof (b) in _61)){
+var _67=m._primitives;
+if(!(typeof (a) in _67&amp;&amp;typeof (b) in _67)){
 try{
 return m.comparatorRegistry.match(a,b);
 }
@@ -460,31 +481,31 @@
 return 1;
 }
 }
-var _62=m.repr;
-throw new TypeError(_62(a)+&quot; and &quot;+_62(b)+&quot; can not be compared&quot;);
+var _68=m.repr;
+throw new TypeError(_68(a)+&quot; and &quot;+_68(b)+&quot; can not be compared&quot;);
 },compareDateLike:function(a,b){
 return MochiKit.Base.compare(a.getTime(),b.getTime());
 },compareArrayLike:function(a,b){
-var _63=MochiKit.Base.compare;
-var _64=a.length;
-var _65=0;
-if(_64&gt;b.length){
-_65=1;
-_64=b.length;
+var _69=MochiKit.Base.compare;
+var _70=a.length;
+var _71=0;
+if(_70&gt;b.length){
+_71=1;
+_70=b.length;
 }else{
-if(_64&lt;b.length){
-_65=-1;
+if(_70&lt;b.length){
+_71=-1;
 }
 }
-for(var i=0;i&lt;_64;i++){
-var cmp=_63(a[i],b[i]);
+for(var i=0;i&lt;_70;i++){
+var cmp=_69(a[i],b[i]);
 if(cmp){
 return cmp;
 }
 }
-return _65;
-},registerRepr:function(_67,_68,_69,_70){
-MochiKit.Base.reprRegistry.register(_67,_68,_69,_70);
+return _71;
+},registerRepr:function(_73,_74,_75,_76){
+MochiKit.Base.reprRegistry.register(_73,_74,_75,_76);
 },repr:function(o){
 if(typeof (o)==&quot;undefined&quot;){
 return &quot;undefined&quot;;
@@ -509,19 +530,19 @@
 }
 }
 try{
-var _71=(o+&quot;&quot;);
+var _77=(o+&quot;&quot;);
 }
 catch(e){
 return &quot;[&quot;+typeof (o)+&quot;]&quot;;
 }
 if(typeof (o)==&quot;function&quot;){
-o=_71.replace(/^\s+/,&quot;&quot;);
+o=_77.replace(/^\s+/,&quot;&quot;);
 var idx=o.indexOf(&quot;{&quot;);
 if(idx!=-1){
 o=o.substr(0,idx)+&quot;{...}&quot;;
 }
 }
-return _71;
+return _77;
 },reprArrayLike:function(o){
 var m=MochiKit.Base;
 return &quot;[&quot;+m.map(m.repr,o).join(&quot;, &quot;)+&quot;]&quot;;
@@ -529,16 +550,16 @@
 return (&quot;\&quot;&quot;+o.replace(/([&quot;\\])/g,&quot;\\$1&quot;)+&quot;\&quot;&quot;).replace(/[\f]/g,&quot;\\f&quot;).replace(/[\b]/g,&quot;\\b&quot;).replace(/[\n]/g,&quot;\\n&quot;).replace(/[\t]/g,&quot;\\t&quot;).replace(/[\r]/g,&quot;\\r&quot;);
 },reprNumber:function(o){
 return o+&quot;&quot;;
-},registerJSON:function(_73,_74,_75,_76){
-MochiKit.Base.jsonRegistry.register(_73,_74,_75,_76);
+},registerJSON:function(_79,_80,_81,_82){
+MochiKit.Base.jsonRegistry.register(_79,_80,_81,_82);
 },evalJSON:function(){
 return eval(&quot;(&quot;+arguments[0]+&quot;)&quot;);
 },serializeJSON:function(o){
-var _77=typeof (o);
-if(_77==&quot;undefined&quot;){
+var _83=typeof (o);
+if(_83==&quot;undefined&quot;){
 return &quot;undefined&quot;;
 }else{
-if(_77==&quot;number&quot;||_77==&quot;boolean&quot;){
+if(_83==&quot;number&quot;||_83==&quot;boolean&quot;){
 return o+&quot;&quot;;
 }else{
 if(o===null){
@@ -547,25 +568,25 @@
 }
 }
 var m=MochiKit.Base;
-var _78=m.reprString;
-if(_77==&quot;string&quot;){
-return _78(o);
+var _84=m.reprString;
+if(_83==&quot;string&quot;){
+return _84(o);
 }
 var me=arguments.callee;
-var _79;
+var _85;
 if(typeof (o.__json__)==&quot;function&quot;){
-_79=o.__json__();
-if(o!==_79){
-return me(_79);
+_85=o.__json__();
+if(o!==_85){
+return me(_85);
 }
 }
 if(typeof (o.json)==&quot;function&quot;){
-_79=o.json();
-if(o!==_79){
-return me(_79);
+_85=o.json();
+if(o!==_85){
+return me(_85);
 }
 }
-if(_77!=&quot;function&quot;&amp;&amp;typeof (o.length)==&quot;number&quot;){
+if(_83!=&quot;function&quot;&amp;&amp;typeof (o.length)==&quot;number&quot;){
 var res=[];
 for(var i=0;i&lt;o.length;i++){
 var val=me(o[i]);
@@ -577,25 +598,25 @@
 return &quot;[&quot;+res.join(&quot;, &quot;)+&quot;]&quot;;
 }
 try{
-_79=m.jsonRegistry.match(o);
-return me(_79);
+_85=m.jsonRegistry.match(o);
+return me(_85);
 }
 catch(e){
 if(e!=m.NotFound){
 throw e;
 }
 }
-if(_77==&quot;function&quot;){
+if(_83==&quot;function&quot;){
 return null;
 }
 res=[];
 for(var k in o){
-var _82;
+var _87;
 if(typeof (k)==&quot;number&quot;){
-_82=&quot;\&quot;&quot;+k+&quot;\&quot;&quot;;
+_87=&quot;\&quot;&quot;+k+&quot;\&quot;&quot;;
 }else{
 if(typeof (k)==&quot;string&quot;){
-_82=_78(k);
+_87=_84(k);
 }else{
 continue;
 }
@@ -604,57 +625,57 @@
 if(typeof (val)!=&quot;string&quot;){
 continue;
 }
-res.push(_82+&quot;:&quot;+val);
+res.push(_87+&quot;:&quot;+val);
 }
 return &quot;{&quot;+res.join(&quot;, &quot;)+&quot;}&quot;;
 },objEqual:function(a,b){
-return (MochiKit.Base.compare(a,b)==0);
-},arrayEqual:function(_83,arr){
-if(_83.length!=arr.length){
+return (MochiKit.Base.compare(a,b)===0);
+},arrayEqual:function(_88,arr){
+if(_88.length!=arr.length){
 return false;
 }
-return (MochiKit.Base.compare(_83,arr)==0);
+return (MochiKit.Base.compare(_88,arr)===0);
 },concat:function(){
-var _85=[];
-var _86=MochiKit.Base.extend;
+var _90=[];
+var _91=MochiKit.Base.extend;
 for(var i=0;i&lt;arguments.length;i++){
-_86(_85,arguments[i]);
+_91(_90,arguments[i]);
 }
-return _85;
+return _90;
 },keyComparator:function(key){
 var m=MochiKit.Base;
-var _88=m.compare;
+var _93=m.compare;
 if(arguments.length==1){
 return function(a,b){
-return _88(a[key],b[key]);
+return _93(a[key],b[key]);
 };
 }
-var _89=m.extend(null,arguments);
+var _94=m.extend(null,arguments);
 return function(a,b){
-var _90=0;
-for(var i=0;(_90==0)&amp;&amp;(i&lt;_89.length);i++){
-var key=_89[i];
-_90=_88(a[key],b[key]);
+var _95=0;
+for(var i=0;(_95===0)&amp;&amp;(i&lt;_94.length);i++){
+var key=_94[i];
+_95=_93(a[key],b[key]);
 }
-return _90;
+return _95;
 };
 },reverseKeyComparator:function(key){
-var _91=MochiKit.Base.keyComparator.apply(this,arguments);
+var _96=MochiKit.Base.keyComparator.apply(this,arguments);
 return function(a,b){
-return _91(b,a);
+return _96(b,a);
 };
-},partial:function(_92){
+},partial:function(_97){
 var m=MochiKit.Base;
-return m.bind.apply(this,m.extend([_92,undefined],arguments,1));
-},listMinMax:function(_93,lst){
-if(lst.length==0){
+return m.bind.apply(this,m.extend([_97,undefined],arguments,1));
+},listMinMax:function(_98,lst){
+if(lst.length===0){
 return null;
 }
 var cur=lst[0];
-var _95=MochiKit.Base.compare;
+var _100=MochiKit.Base.compare;
 for(var i=1;i&lt;lst.length;i++){
 var o=lst[i];
-if(_95(o,cur)==_93){
+if(_100(o,cur)==_98){
 cur=o;
 }
 }
@@ -663,45 +684,45 @@
 return MochiKit.Base.listMinMax(1,arguments);
 },objMin:function(){
 return MochiKit.Base.listMinMax(-1,arguments);
-},findIdentical:function(lst,_96,_97,end){
-if(typeof (end)==&quot;undefined&quot;||end==null){
+},findIdentical:function(lst,_101,_102,end){
+if(typeof (end)==&quot;undefined&quot;||end===null){
 end=lst.length;
 }
-for(var i=(_97||0);i&lt;end;i++){
-if(lst[i]===_96){
+for(var i=(_102||0);i&lt;end;i++){
+if(lst[i]===_101){
 return i;
 }
 }
 return -1;
-},find:function(lst,_99,_100,end){
-if(typeof (end)==&quot;undefined&quot;||end==null){
+},findValue:function(lst,_104,_105,end){
+if(typeof (end)==&quot;undefined&quot;||end===null){
 end=lst.length;
 }
 var cmp=MochiKit.Base.compare;
-for(var i=(_100||0);i&lt;end;i++){
-if(cmp(lst[i],_99)==0){
+for(var i=(_105||0);i&lt;end;i++){
+if(cmp(lst[i],_104)===0){
 return i;
 }
 }
 return -1;
-},nodeWalk:function(node,_102){
-var _103=[node];
-var _104=MochiKit.Base.extend;
-while(_103.length){
-var res=_102(_103.shift());
+},nodeWalk:function(node,_107){
+var _108=[node];
+var _109=MochiKit.Base.extend;
+while(_108.length){
+var res=_107(_108.shift());
 if(res){
-_104(_103,res);
+_109(_108,res);
 }
 }
-},nameFunctions:function(_105){
-var base=_105.NAME;
+},nameFunctions:function(_110){
+var base=_110.NAME;
 if(typeof (base)==&quot;undefined&quot;){
 base=&quot;&quot;;
 }else{
 base=base+&quot;.&quot;;
 }
-for(var name in _105){
-var o=_105[name];
+for(var name in _110){
+var o=_110[name];
 if(typeof (o)==&quot;function&quot;&amp;&amp;typeof (o.NAME)==&quot;undefined&quot;){
 try{
 o.NAME=base+name;
@@ -710,59 +731,59 @@
 }
 }
 }
-},queryString:function(_108,_109){
-if(typeof (MochiKit.DOM)!=&quot;undefined&quot;&amp;&amp;arguments.length==1&amp;&amp;(typeof (_108)==&quot;string&quot;||(typeof (_108.nodeType)!=&quot;undefined&quot;&amp;&amp;_108.nodeType&gt;0))){
-var kv=MochiKit.DOM.formContents(_108);
-_108=kv[0];
-_109=kv[1];
+},queryString:function(_113,_114){
+if(typeof (MochiKit.DOM)!=&quot;undefined&quot;&amp;&amp;arguments.length==1&amp;&amp;(typeof (_113)==&quot;string&quot;||(typeof (_113.nodeType)!=&quot;undefined&quot;&amp;&amp;_113.nodeType&gt;0))){
+var kv=MochiKit.DOM.formContents(_113);
+_113=kv[0];
+_114=kv[1];
 }else{
 if(arguments.length==1){
-var o=_108;
-_108=[];
-_109=[];
+var o=_113;
+_113=[];
+_114=[];
 for(var k in o){
 var v=o[k];
 if(typeof (v)!=&quot;function&quot;){
-_108.push(k);
-_109.push(v);
+_113.push(k);
+_114.push(v);
 }
 }
 }
 }
 var rval=[];
-var len=Math.min(_108.length,_109.length);
-var _113=MochiKit.Base.urlEncode;
+var len=Math.min(_113.length,_114.length);
+var _118=MochiKit.Base.urlEncode;
 for(var i=0;i&lt;len;i++){
-v=_109[i];
-if(typeof (v)!=&quot;undefined&quot;&amp;&amp;v!=null){
-rval.push(_113(_108[i])+&quot;=&quot;+_113(v));
+v=_114[i];
+if(typeof (v)!=&quot;undefined&quot;&amp;&amp;v!==null){
+rval.push(_118(_113[i])+&quot;=&quot;+_118(v));
 }
 }
 return rval.join(&quot;&amp;&quot;);
-},parseQueryString:function(_114,_115){
-var _116=_114.replace(/\+/g,&quot;%20&quot;).split(&quot;&amp;&quot;);
+},parseQueryString:function(_119,_120){
+var _121=_119.replace(/\+/g,&quot;%20&quot;).split(&quot;&amp;&quot;);
 var o={};
-var _117;
+var _122;
 if(typeof (decodeURIComponent)!=&quot;undefined&quot;){
-_117=decodeURIComponent;
+_122=decodeURIComponent;
 }else{
-_117=unescape;
+_122=unescape;
 }
-if(_115){
-for(var i=0;i&lt;_116.length;i++){
-var pair=_116[i].split(&quot;=&quot;);
-var name=_117(pair[0]);
+if(_120){
+for(var i=0;i&lt;_121.length;i++){
+var pair=_121[i].split(&quot;=&quot;);
+var name=_122(pair[0]);
 var arr=o[name];
 if(!(arr instanceof Array)){
 arr=[];
 o[name]=arr;
 }
-arr.push(_117(pair[1]));
+arr.push(_122(pair[1]));
 }
 }else{
-for(i=0;i&lt;_116.length;i++){
-pair=_116[i].split(&quot;=&quot;);
-o[_117(pair[0])]=_117(pair[1]);
+for(i=0;i&lt;_121.length;i++){
+pair=_121[i].split(&quot;=&quot;);
+o[_122(pair[0])]=_122(pair[1]);
 }
 }
 return o;
@@ -770,11 +791,11 @@
 MochiKit.Base.AdapterRegistry=function(){
 this.pairs=[];
 };
-MochiKit.Base.AdapterRegistry.prototype={register:function(name,_119,wrap,_121){
-if(_121){
-this.pairs.unshift([name,_119,wrap]);
+MochiKit.Base.AdapterRegistry.prototype={register:function(name,_124,wrap,_126){
+if(_126){
+this.pairs.unshift([name,_124,wrap]);
 }else{
-this.pairs.push([name,_119,wrap]);
+this.pairs.push([name,_124,wrap]);
 }
 },match:function(){
 for(var i=0;i&lt;this.pairs.length;i++){
@@ -794,29 +815,31 @@
 }
 return false;
 }};
-MochiKit.Base.EXPORT=[&quot;counter&quot;,&quot;clone&quot;,&quot;extend&quot;,&quot;update&quot;,&quot;updatetree&quot;,&quot;setdefault&quot;,&quot;keys&quot;,&quot;items&quot;,&quot;NamedError&quot;,&quot;operator&quot;,&quot;forward&quot;,&quot;itemgetter&quot;,&quot;typeMatcher&quot;,&quot;isCallable&quot;,&quot;isUndefined&quot;,&quot;isUndefinedOrNull&quot;,&quot;isNull&quot;,&quot;isNotEmpty&quot;,&quot;isArrayLike&quot;,&quot;isDateLike&quot;,&quot;xmap&quot;,&quot;map&quot;,&quot;xfilter&quot;,&quot;filter&quot;,&quot;bind&quot;,&quot;bindMethods&quot;,&quot;NotFound&quot;,&quot;AdapterRegistry&quot;,&quot;registerComparator&quot;,&quot;compare&quot;,&quot;registerRepr&quot;,&quot;repr&quot;,&quot;objEqual&quot;,&quot;arrayEqual&quot;,&quot;concat&quot;,&quot;keyComparator&quot;,&quot;reverseKeyComparator&quot;,&quot;partial&quot;,&quot;merge&quot;,&quot;listMinMax&quot;,&quot;listMax&quot;,&quot;listMin&quot;,&quot;objMax&quot;,&quot;objMin&quot;,&quot;nodeWalk&quot;,&quot;zip&quot;,&quot;urlEncode&quot;,&quot;queryString&quot;,&quot;serializeJSON&quot;,&quot;registerJSON&quot;,&quot;evalJSON&quot;,&quot;parseQueryString&quot;,&quot;find&quot;,&quot;findIdentical&quot;];
+MochiKit.Base.EXPORT=[&quot;counter&quot;,&quot;clone&quot;,&quot;extend&quot;,&quot;update&quot;,&quot;updatetree&quot;,&quot;setdefault&quot;,&quot;keys&quot;,&quot;items&quot;,&quot;NamedError&quot;,&quot;operator&quot;,&quot;forwardCall&quot;,&quot;itemgetter&quot;,&quot;typeMatcher&quot;,&quot;isCallable&quot;,&quot;isUndefined&quot;,&quot;isUndefinedOrNull&quot;,&quot;isNull&quot;,&quot;isEmpty&quot;,&quot;isNotEmpty&quot;,&quot;isArrayLike&quot;,&quot;isDateLike&quot;,&quot;xmap&quot;,&quot;map&quot;,&quot;xfilter&quot;,&quot;filter&quot;,&quot;bind&quot;,&quot;bindMethods&quot;,&quot;NotFound&quot;,&quot;AdapterRegistry&quot;,&quot;registerComparator&quot;,&quot;compare&quot;,&quot;registerRepr&quot;,&quot;repr&quot;,&quot;objEqual&quot;,&quot;arrayEqual&quot;,&quot;concat&quot;,&quot;keyComparator&quot;,&quot;reverseKeyComparator&quot;,&quot;partial&quot;,&quot;merge&quot;,&quot;listMinMax&quot;,&quot;listMax&quot;,&quot;listMin&quot;,&quot;objMax&quot;,&quot;objMin&quot;,&quot;nodeWalk&quot;,&quot;zip&quot;,&quot;urlEncode&quot;,&quot;queryString&quot;,&quot;serializeJSON&quot;,&quot;registerJSON&quot;,&quot;evalJSON&quot;,&quot;parseQueryString&quot;,&quot;findValue&quot;,&quot;findIdentical&quot;,&quot;flattenArguments&quot;,&quot;method&quot;];
 MochiKit.Base.EXPORT_OK=[&quot;nameFunctions&quot;,&quot;comparatorRegistry&quot;,&quot;reprRegistry&quot;,&quot;jsonRegistry&quot;,&quot;compareDateLike&quot;,&quot;compareArrayLike&quot;,&quot;reprArrayLike&quot;,&quot;reprString&quot;,&quot;reprNumber&quot;];
-MochiKit.Base._exportSymbols=function(_122,_123){
+MochiKit.Base._exportSymbols=function(_127,_128){
 if(typeof (MochiKit.__export__)==&quot;undefined&quot;){
 MochiKit.__export__=(MochiKit.__compat__||(typeof (JSAN)==&quot;undefined&quot;&amp;&amp;typeof (dojo)==&quot;undefined&quot;));
 }
 if(!MochiKit.__export__){
 return;
 }
-var all=_123.EXPORT_TAGS[&quot;:all&quot;];
+var all=_128.EXPORT_TAGS[&quot;:all&quot;];
 for(var i=0;i&lt;all.length;i++){
-_122[all[i]]=_123[all[i]];
+_127[all[i]]=_128[all[i]];
 }
 };
 MochiKit.Base.__new__=function(){
 var m=this;
+m.forward=m.forwardCall;
+m.find=m.findValue;
 if(typeof (encodeURIComponent)!=&quot;undefined&quot;){
-m.urlEncode=function(_125){
-return encodeURIComponent(_125).replace(/\'/g,&quot;%27&quot;);
+m.urlEncode=function(_130){
+return encodeURIComponent(_130).replace(/\'/g,&quot;%27&quot;);
 };
 }else{
-m.urlEncode=function(_126){
-return escape(_126).replace(/\+/g,&quot;%2B&quot;).replace(/\&quot;/g,&quot;%22&quot;).rval.replace(/\'/g,&quot;%27&quot;);
+m.urlEncode=function(_131){
+return escape(_131).replace(/\+/g,&quot;%2B&quot;).replace(/\&quot;/g,&quot;%22&quot;).rval.replace(/\'/g,&quot;%27&quot;);
 };
 }
 m.NamedError=function(name){
@@ -830,7 +853,7 @@
 }else{
 return this.name+&quot;()&quot;;
 }
-},toString:m.forward(&quot;repr&quot;)});
+},toString:m.forwardCall(&quot;repr&quot;)});
 m.NotFound=new m.NamedError(&quot;MochiKit.Base.NotFound&quot;);
 m.listMax=m.partial(m.listMinMax,1);
 m.listMin=m.partial(m.listMinMax,-1);
@@ -851,7 +874,9 @@
 m.nameFunctions(this);
 };
 MochiKit.Base.__new__();
+if(!MochiKit.__compat__){
 compare=MochiKit.Base.compare;
+}
 MochiKit.Base._exportSymbols(this,MochiKit.Base);
 if(typeof (dojo)!=&quot;undefined&quot;){
 dojo.provide(&quot;MochiKit.Iter&quot;);
@@ -872,34 +897,34 @@
 MochiKit.Iter={};
 }
 MochiKit.Iter.NAME=&quot;MochiKit.Iter&quot;;
-MochiKit.Iter.VERSION=&quot;1.3&quot;;
+MochiKit.Iter.VERSION=&quot;1.3.1&quot;;
 MochiKit.Base.update(MochiKit.Iter,{__repr__:function(){
 return &quot;[&quot;+this.NAME+&quot; &quot;+this.VERSION+&quot;]&quot;;
 },toString:function(){
 return this.__repr__();
-},registerIteratorFactory:function(name,_127,_128,_129){
-MochiKit.Iter.iteratorRegistry.register(name,_127,_128,_129);
-},iter:function(_130,_131){
+},registerIteratorFactory:function(name,_132,_133,_134){
+MochiKit.Iter.iteratorRegistry.register(name,_132,_133,_134);
+},iter:function(_135,_136){
 var self=MochiKit.Iter;
 if(arguments.length==2){
 return self.takewhile(function(a){
-return a!=_131;
-},_130);
+return a!=_136;
+},_135);
 }
-if(typeof (_130.next)==&quot;function&quot;){
-return _130;
+if(typeof (_135.next)==&quot;function&quot;){
+return _135;
 }else{
-if(typeof (_130.iter)==&quot;function&quot;){
-return _130.iter();
+if(typeof (_135.iter)==&quot;function&quot;){
+return _135.iter();
 }
 }
 try{
-return self.iteratorRegistry.match(_130);
+return self.iteratorRegistry.match(_135);
 }
 catch(e){
 var m=MochiKit.Base;
 if(e==m.NotFound){
-e=new TypeError(typeof (_130)+&quot;: &quot;+m.repr(_130)+&quot; is not iterable&quot;);
+e=new TypeError(typeof (_135)+&quot;: &quot;+m.repr(_135)+&quot; is not iterable&quot;);
 }
 throw e;
 }
@@ -910,17 +935,17 @@
 var m=MochiKit.Base;
 return {repr:function(){
 return &quot;count(&quot;+n+&quot;)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:m.counter(n)};
+},toString:m.forwardCall(&quot;repr&quot;),next:m.counter(n)};
 },cycle:function(p){
 var self=MochiKit.Iter;
 var m=MochiKit.Base;
 var lst=[];
-var _134=self.iter(p);
+var _139=self.iter(p);
 return {repr:function(){
 return &quot;cycle(...)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:function(){
+},toString:m.forwardCall(&quot;repr&quot;),next:function(){
 try{
-var rval=_134.next();
+var rval=_139.next();
 lst.push(rval);
 return rval;
 }
@@ -928,7 +953,7 @@
 if(e!=self.StopIteration){
 throw e;
 }
-if(lst.length==0){
+if(lst.length===0){
 this.next=function(){
 throw self.StopIteration;
 };
@@ -947,39 +972,39 @@
 if(typeof (n)==&quot;undefined&quot;){
 return {repr:function(){
 return &quot;repeat(&quot;+m.repr(elem)+&quot;)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:function(){
+},toString:m.forwardCall(&quot;repr&quot;),next:function(){
 return elem;
 }};
 }
 return {repr:function(){
 return &quot;repeat(&quot;+m.repr(elem)+&quot;, &quot;+n+&quot;)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:function(){
+},toString:m.forwardCall(&quot;repr&quot;),next:function(){
 if(n&lt;=0){
 throw MochiKit.Iter.StopIteration;
 }
 n-=1;
 return elem;
 }};
-},next:function(_136){
-return _136.next();
+},next:function(_141){
+return _141.next();
 },izip:function(p,q){
 var m=MochiKit.Base;
 var next=MochiKit.Iter.next;
-var _139=m.map(iter,arguments);
+var _144=m.map(iter,arguments);
 return {repr:function(){
 return &quot;izip(...)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:function(){
-return m.map(next,_139);
+},toString:m.forwardCall(&quot;repr&quot;),next:function(){
+return m.map(next,_144);
 }};
 },ifilter:function(pred,seq){
 var m=MochiKit.Base;
 seq=MochiKit.Iter.iter(seq);
-if(pred==null){
+if(pred===null){
 pred=m.operator.truth;
 }
 return {repr:function(){
 return &quot;ifilter(...)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:function(){
+},toString:m.forwardCall(&quot;repr&quot;),next:function(){
 while(true){
 var rval=seq.next();
 if(pred(rval)){
@@ -991,12 +1016,12 @@
 },ifilterfalse:function(pred,seq){
 var m=MochiKit.Base;
 seq=MochiKit.Iter.iter(seq);
-if(pred==null){
+if(pred===null){
 pred=m.operator.truth;
 }
 return {repr:function(){
 return &quot;ifilterfalse(...)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:function(){
+},toString:m.forwardCall(&quot;repr&quot;),next:function(){
 while(true){
 var rval=seq.next();
 if(!pred(rval)){
@@ -1009,7 +1034,7 @@
 var self=MochiKit.Iter;
 var m=MochiKit.Base;
 seq=self.iter(seq);
-var _142=0;
+var _147=0;
 var stop=0;
 var step=1;
 var i=-1;
@@ -1017,45 +1042,45 @@
 stop=arguments[1];
 }else{
 if(arguments.length==3){
-_142=arguments[1];
+_147=arguments[1];
 stop=arguments[2];
 }else{
-_142=arguments[1];
+_147=arguments[1];
 stop=arguments[2];
 step=arguments[3];
 }
 }
 return {repr:function(){
-return &quot;islice(&quot;+[&quot;...&quot;,_142,stop,step].join(&quot;, &quot;)+&quot;)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:function(){
+return &quot;islice(&quot;+[&quot;...&quot;,_147,stop,step].join(&quot;, &quot;)+&quot;)&quot;;
+},toString:m.forwardCall(&quot;repr&quot;),next:function(){
 var rval;
-while(i&lt;_142){
+while(i&lt;_147){
 rval=seq.next();
 i++;
 }
-if(_142&gt;=stop){
+if(_147&gt;=stop){
 throw self.StopIteration;
 }
-_142+=step;
+_147+=step;
 return rval;
 }};
 },imap:function(fun,p,q){
 var m=MochiKit.Base;
 var self=MochiKit.Iter;
-var _146=m.map(self.iter,m.extend(null,arguments,1));
+var _151=m.map(self.iter,m.extend(null,arguments,1));
 var map=m.map;
 var next=self.next;
 return {repr:function(){
 return &quot;imap(...)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:function(){
-return fun.apply(this,map(next,_146));
+},toString:m.forwardCall(&quot;repr&quot;),next:function(){
+return fun.apply(this,map(next,_151));
 }};
 },applymap:function(fun,seq,self){
 seq=MochiKit.Iter.iter(seq);
 var m=MochiKit.Base;
 return {repr:function(){
 return &quot;applymap(...)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:function(){
+},toString:m.forwardCall(&quot;repr&quot;),next:function(){
 return fun.apply(self,seq.next());
 }};
 },chain:function(p,q){
@@ -1064,23 +1089,23 @@
 if(arguments.length==1){
 return self.iter(arguments[0]);
 }
-var _148=m.map(self.iter,arguments);
+var _153=m.map(self.iter,arguments);
 return {repr:function(){
 return &quot;chain(...)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:function(){
-while(_148.length&gt;1){
+},toString:m.forwardCall(&quot;repr&quot;),next:function(){
+while(_153.length&gt;1){
 try{
-return _148[0].next();
+return _153[0].next();
 }
 catch(e){
 if(e!=self.StopIteration){
 throw e;
 }
-_148.shift();
+_153.shift();
 }
 }
-if(_148.length==1){
-var arg=_148.shift();
+if(_153.length==1){
+var arg=_153.shift();
 this.next=m.bind(&quot;next&quot;,arg);
 return this.next();
 }
@@ -1091,7 +1116,7 @@
 seq=self.iter(seq);
 return {repr:function(){
 return &quot;takewhile(...)&quot;;
-},toString:MochiKit.Base.forward(&quot;repr&quot;),next:function(){
+},toString:MochiKit.Base.forwardCall(&quot;repr&quot;),next:function(){
 var rval=seq.next();
 if(!pred(rval)){
 this.next=function(){
@@ -1107,7 +1132,7 @@
 var bind=m.bind;
 return {&quot;repr&quot;:function(){
 return &quot;dropwhile(...)&quot;;
-},&quot;toString&quot;:m.forward(&quot;repr&quot;),&quot;next&quot;:function(){
+},&quot;toString&quot;:m.forwardCall(&quot;repr&quot;),&quot;next&quot;:function(){
 while(true){
 var rval=seq.next();
 if(!pred(rval)){
@@ -1117,58 +1142,58 @@
 this.next=bind(&quot;next&quot;,seq);
 return rval;
 }};
-},_tee:function(_150,sync,_152){
-sync.pos[_150]=-1;
+},_tee:function(_155,sync,_157){
+sync.pos[_155]=-1;
 var m=MochiKit.Base;
-var _153=m.listMin;
+var _158=m.listMin;
 return {repr:function(){
-return &quot;tee(&quot;+_150+&quot;, ...)&quot;;
-},toString:m.forward(&quot;repr&quot;),next:function(){
+return &quot;tee(&quot;+_155+&quot;, ...)&quot;;
+},toString:m.forwardCall(&quot;repr&quot;),next:function(){
 var rval;
-var i=sync.pos[_150];
+var i=sync.pos[_155];
 if(i==sync.max){
-rval=_152.next();
+rval=_157.next();
 sync.deque.push(rval);
 sync.max+=1;
-sync.pos[_150]+=1;
+sync.pos[_155]+=1;
 }else{
 rval=sync.deque[i-sync.min];
-sync.pos[_150]+=1;
-if(i==sync.min&amp;&amp;_153(sync.pos)!=sync.min){
+sync.pos[_155]+=1;
+if(i==sync.min&amp;&amp;_158(sync.pos)!=sync.min){
 sync.min+=1;
 sync.deque.shift();
 }
 }
 return rval;
 }};
-},tee:function(_154,n){
+},tee:function(_159,n){
 var rval=[];
 var sync={&quot;pos&quot;:[],&quot;deque&quot;:[],&quot;max&quot;:-1,&quot;min&quot;:-1};
 if(arguments.length==1){
 n=2;
 }
 var self=MochiKit.Iter;
-_154=self.iter(_154);
+_159=self.iter(_159);
 var _tee=self._tee;
 for(var i=0;i&lt;n;i++){
-rval.push(_tee(i,sync,_154));
+rval.push(_tee(i,sync,_159));
 }
 return rval;
-},list:function(_156){
+},list:function(_161){
 var m=MochiKit.Base;
-if(typeof (_156.slice)==&quot;function&quot;){
-return _156.slice();
+if(typeof (_161.slice)==&quot;function&quot;){
+return _161.slice();
 }else{
-if(m.isArrayLike(_156)){
-return m.concat(_156);
+if(m.isArrayLike(_161)){
+return m.concat(_161);
 }
 }
 var self=MochiKit.Iter;
-_156=self.iter(_156);
+_161=self.iter(_161);
 var rval=[];
 try{
 while(true){
-rval.push(_156.next());
+rval.push(_161.next());
 }
 }
 catch(e){
@@ -1178,14 +1203,14 @@
 return rval;
 }
 return undefined;
-},reduce:function(fn,_157,_158){
+},reduce:function(fn,_162,_163){
 var i=0;
-var x=_158;
+var x=_163;
 var self=MochiKit.Iter;
-_157=self.iter(_157);
+_162=self.iter(_162);
 if(arguments.length&lt;3){
 try{
-x=_157.next();
+x=_162.next();
 }
 catch(e){
 if(e==self.StopIteration){
@@ -1197,7 +1222,7 @@
 }
 try{
 while(true){
-x=fn(x,_157.next());
+x=fn(x,_162.next());
 }
 }
 catch(e){
@@ -1207,18 +1232,18 @@
 }
 return x;
 },range:function(){
-var _160=0;
+var _165=0;
 var stop=0;
 var step=1;
 if(arguments.length==1){
 stop=arguments[0];
 }else{
 if(arguments.length==2){
-_160=arguments[0];
+_165=arguments[0];
 stop=arguments[1];
 }else{
 if(arguments.length==3){
-_160=arguments[0];
+_165=arguments[0];
 stop=arguments[1];
 step=arguments[2];
 }else{
@@ -1226,26 +1251,26 @@
 }
 }
 }
-if(step==0){
+if(step===0){
 throw new TypeError(&quot;range() step must not be 0&quot;);
 }
 return {next:function(){
-if((step&gt;0&amp;&amp;_160&gt;=stop)||(step&lt;0&amp;&amp;_160&lt;=stop)){
+if((step&gt;0&amp;&amp;_165&gt;=stop)||(step&lt;0&amp;&amp;_165&lt;=stop)){
 throw MochiKit.Iter.StopIteration;
 }
-var rval=_160;
-_160+=step;
+var rval=_165;
+_165+=step;
 return rval;
 },repr:function(){
-return &quot;range(&quot;+[_160,stop,step].join(&quot;, &quot;)+&quot;)&quot;;
-},toString:MochiKit.Base.forward(&quot;repr&quot;)};
-},sum:function(_161,_162){
-var x=_162||0;
+return &quot;range(&quot;+[_165,stop,step].join(&quot;, &quot;)+&quot;)&quot;;
+},toString:MochiKit.Base.forwardCall(&quot;repr&quot;)};
+},sum:function(_166,_167){
+var x=_167||0;
 var self=MochiKit.Iter;
-_161=self.iter(_161);
+_166=self.iter(_166);
 try{
 while(true){
-x+=_161.next();
+x+=_166.next();
 }
 }
 catch(e){
@@ -1254,12 +1279,12 @@
 }
 }
 return x;
-},exhaust:function(_163){
+},exhaust:function(_168){
 var self=MochiKit.Iter;
-_163=self.iter(_163);
+_168=self.iter(_168);
 try{
 while(true){
-_163.next();
+_168.next();
 }
 }
 catch(e){
@@ -1267,15 +1292,15 @@
 throw e;
 }
 }
-},forEach:function(_164,func,self){
+},forEach:function(_169,func,self){
 var m=MochiKit.Base;
 if(arguments.length&gt;2){
 func=m.bind(func,self);
 }
-if(m.isArrayLike(_164)){
+if(m.isArrayLike(_169)){
 try{
-for(var i=0;i&lt;_164.length;i++){
-func(_164[i]);
+for(var i=0;i&lt;_169.length;i++){
+func(_169[i]);
 }
 }
 catch(e){
@@ -1285,12 +1310,12 @@
 }
 }else{
 self=MochiKit.Iter;
-self.exhaust(self.imap(func,_164));
+self.exhaust(self.imap(func,_169));
 }
-},every:function(_166,func){
+},every:function(_171,func){
 var self=MochiKit.Iter;
 try{
-self.ifilterfalse(func,_166).next();
+self.ifilterfalse(func,_171).next();
 return false;
 }
 catch(e){
@@ -1299,21 +1324,21 @@
 }
 return true;
 }
-},sorted:function(_167,cmp){
-var rval=MochiKit.Iter.list(_167);
+},sorted:function(_172,cmp){
+var rval=MochiKit.Iter.list(_172);
 if(arguments.length==1){
 cmp=MochiKit.Base.compare;
 }
 rval.sort(cmp);
 return rval;
-},reversed:function(_168){
-var rval=MochiKit.Iter.list(_168);
+},reversed:function(_173){
+var rval=MochiKit.Iter.list(_173);
 rval.reverse();
 return rval;
-},some:function(_169,func){
+},some:function(_174,func){
 var self=MochiKit.Iter;
 try{
-self.ifilter(func,_169).next();
+self.ifilter(func,_174).next();
 return true;
 }
 catch(e){
@@ -1322,17 +1347,17 @@
 }
 return false;
 }
-},iextend:function(lst,_170){
-if(MochiKit.Base.isArrayLike(_170)){
-for(var i=0;i&lt;_170.length;i++){
-lst.push(_170[i]);
+},iextend:function(lst,_175){
+if(MochiKit.Base.isArrayLike(_175)){
+for(var i=0;i&lt;_175.length;i++){
+lst.push(_175[i]);
 }
 }else{
 var self=MochiKit.Iter;
-_170=self.iter(_170);
+_175=self.iter(_175);
 try{
 while(true){
-lst.push(_170.next());
+lst.push(_175.next());
 }
 }
 catch(e){
@@ -1342,33 +1367,33 @@
 }
 }
 return lst;
-},groupby:function(_171,_172){
+},groupby:function(_176,_177){
 var m=MochiKit.Base;
 var self=MochiKit.Iter;
 if(arguments.length&lt;2){
-_172=m.operator.identity;
+_177=m.operator.identity;
 }
-_171=self.iter(_171);
+_176=self.iter(_176);
 var pk=undefined;
 var k=undefined;
 var v;
 function fetch(){
-v=_171.next();
-k=_172(v);
+v=_176.next();
+k=_177(v);
 }
 function eat(){
 var ret=v;
 v=undefined;
 return ret;
 }
-var _175=true;
+var _180=true;
 return {repr:function(){
 return &quot;groupby(...)&quot;;
 },next:function(){
 while(k==pk){
 fetch();
-if(_175){
-_175=false;
+if(_180){
+_180=false;
 break;
 }
 }
@@ -1383,20 +1408,20 @@
 return eat();
 }}];
 }};
-},groupby_as_array:function(_176,_177){
+},groupby_as_array:function(_181,_182){
 var m=MochiKit.Base;
 var self=MochiKit.Iter;
 if(arguments.length&lt;2){
-_177=m.operator.identity;
+_182=m.operator.identity;
 }
-_176=self.iter(_176);
-var _178=[];
-var _179=true;
-var _180;
+_181=self.iter(_181);
+var _183=[];
+var _184=true;
+var _185;
 while(true){
 try{
-var _181=_176.next();
-var key=_177(_181);
+var _186=_181.next();
+var key=_182(_186);
 }
 catch(e){
 if(e==self.StopIteration){
@@ -1404,32 +1429,32 @@
 }
 throw e;
 }
-if(_179||key!=_180){
-var _182=[];
-_178.push([key,_182]);
+if(_184||key!=_185){
+var _187=[];
+_183.push([key,_187]);
 }
-_182.push(_181);
-_179=false;
-_180=key;
+_187.push(_186);
+_184=false;
+_185=key;
 }
-return _178;
-},arrayLikeIter:function(_183){
+return _183;
+},arrayLikeIter:function(_188){
 var i=0;
 return {repr:function(){
 return &quot;arrayLikeIter(...)&quot;;
-},toString:MochiKit.Base.forward(&quot;repr&quot;),next:function(){
-if(i&gt;=_183.length){
+},toString:MochiKit.Base.forwardCall(&quot;repr&quot;),next:function(){
+if(i&gt;=_188.length){
 throw MochiKit.Iter.StopIteration;
 }
-return _183[i++];
+return _188[i++];
 }};
-},hasIterateNext:function(_184){
-return (_184&amp;&amp;typeof (_184.iterateNext)==&quot;function&quot;);
-},iterateNextIter:function(_185){
+},hasIterateNext:function(_189){
+return (_189&amp;&amp;typeof (_189.iterateNext)==&quot;function&quot;);
+},iterateNextIter:function(_190){
 return {repr:function(){
 return &quot;iterateNextIter(...)&quot;;
-},toString:MochiKit.Base.forward(&quot;repr&quot;),next:function(){
-var rval=_185.iterateNext();
+},toString:MochiKit.Base.forwardCall(&quot;repr&quot;),next:function(){
+var rval=_190.iterateNext();
 if(rval===null||rval===undefined){
 throw MochiKit.Iter.StopIteration;
 }
@@ -1448,7 +1473,9 @@
 m.nameFunctions(this);
 };
 MochiKit.Iter.__new__();
+if(!MochiKit.__compat__){
 reduce=MochiKit.Iter.reduce;
+}
 MochiKit.Base._exportSymbols(this,MochiKit.Iter);
 if(typeof (dojo)!=&quot;undefined&quot;){
 dojo.provide(&quot;MochiKit.Logging&quot;);
@@ -1469,7 +1496,7 @@
 MochiKit.Logging={};
 }
 MochiKit.Logging.NAME=&quot;MochiKit.Logging&quot;;
-MochiKit.Logging.VERSION=&quot;1.3&quot;;
+MochiKit.Logging.VERSION=&quot;1.3.1&quot;;
 MochiKit.Logging.__repr__=function(){
 return &quot;[&quot;+this.NAME+&quot; &quot;+this.VERSION+&quot;]&quot;;
 };
@@ -1478,32 +1505,32 @@
 };
 MochiKit.Logging.EXPORT=[&quot;LogLevel&quot;,&quot;LogMessage&quot;,&quot;Logger&quot;,&quot;alertListener&quot;,&quot;logger&quot;,&quot;log&quot;,&quot;logError&quot;,&quot;logDebug&quot;,&quot;logFatal&quot;,&quot;logWarning&quot;];
 MochiKit.Logging.EXPORT_OK=[&quot;logLevelAtLeast&quot;,&quot;isLogMessage&quot;,&quot;compareLogMessage&quot;];
-MochiKit.Logging.LogMessage=function(num,_187,info){
+MochiKit.Logging.LogMessage=function(num,_192,info){
 this.num=num;
-this.level=_187;
+this.level=_192;
 this.info=info;
 this.timestamp=new Date();
 };
 MochiKit.Logging.LogMessage.prototype={repr:function(){
 var m=MochiKit.Base;
 return &quot;LogMessage(&quot;+m.map(m.repr,[this.num,this.level,this.info]).join(&quot;, &quot;)+&quot;)&quot;;
-},toString:MochiKit.Base.forward(&quot;repr&quot;)};
-MochiKit.Base.update(MochiKit.Logging,{logLevelAtLeast:function(_189){
+},toString:MochiKit.Base.forwardCall(&quot;repr&quot;)};
+MochiKit.Base.update(MochiKit.Logging,{logLevelAtLeast:function(_194){
 var self=MochiKit.Logging;
-if(typeof (_189)==&quot;string&quot;){
-_189=self.LogLevel[_189];
+if(typeof (_194)==&quot;string&quot;){
+_194=self.LogLevel[_194];
 }
 return function(msg){
-var _191=msg.level;
-if(typeof (_191)==&quot;string&quot;){
-_191=self.LogLevel[_191];
+var _196=msg.level;
+if(typeof (_196)==&quot;string&quot;){
+_196=self.LogLevel[_196];
 }
-return _191&gt;=_189;
+return _196&gt;=_194;
 };
 },isLogMessage:function(){
-var _192=MochiKit.Logging.LogMessage;
+var _197=MochiKit.Logging.LogMessage;
 for(var i=0;i&lt;arguments.length;i++){
-if(!(arguments[i] instanceof _192)){
+if(!(arguments[i] instanceof _197)){
 return false;
 }
 }
@@ -1513,17 +1540,30 @@
 },alertListener:function(msg){
 alert(&quot;num: &quot;+msg.num+&quot;\nlevel: &quot;+msg.level+&quot;\ninfo: &quot;+msg.info.join(&quot; &quot;));
 }});
-MochiKit.Logging.Logger=function(_193){
+MochiKit.Logging.Logger=function(_198){
 this.counter=0;
-if(typeof (_193)==&quot;undefined&quot;||_193==null){
-_193=-1;
+if(typeof (_198)==&quot;undefined&quot;||_198===null){
+_198=-1;
 }
-this.maxSize=_193;
+this.maxSize=_198;
 this._messages=[];
 this.listeners={};
+this.useNativeConsole=false;
 };
 MochiKit.Logging.Logger.prototype={clear:function(){
 this._messages.splice(0,this._messages.length);
+},logToConsole:function(msg){
+if(typeof (window)!=&quot;undefined&quot;&amp;&amp;window.console&amp;&amp;window.console.log){
+window.console.log(msg);
+}else{
+if(typeof (opera)!=&quot;undefined&quot;&amp;&amp;opera.postError){
+opera.postError(msg);
+}else{
+if(typeof (printfire)==&quot;function&quot;){
+printfire(msg);
+}
+}
+}
 },dispatchListeners:function(msg){
 for(var k in this.listeners){
 var pair=this.listeners[k];
@@ -1532,72 +1572,84 @@
 }
 pair[1](msg);
 }
-},addListener:function(_194,_195,_196){
-if(typeof (_195)==&quot;string&quot;){
-_195=MochiKit.Logging.logLevelAtLeast(_195);
+},addListener:function(_199,_200,_201){
+if(typeof (_200)==&quot;string&quot;){
+_200=MochiKit.Logging.logLevelAtLeast(_200);
 }
-var _197=[_195,_196];
-_197.ident=_194;
-this.listeners[_194]=_197;
-},removeListener:function(_198){
-delete this.listeners[_198];
-},baseLog:function(_199,_200){
-var msg=new MochiKit.Logging.LogMessage(this.counter,_199,MochiKit.Base.extend(null,arguments,1));
+var _202=[_200,_201];
+_202.ident=_199;
+this.listeners[_199]=_202;
+},removeListener:function(_203){
+delete this.listeners[_203];
+},baseLog:function(_204,_205){
+var msg=new MochiKit.Logging.LogMessage(this.counter,_204,MochiKit.Base.extend(null,arguments,1));
 this._messages.push(msg);
 this.dispatchListeners(msg);
+if(this.useNativeConsole){
+this.logToConsole(msg.level+&quot;: &quot;+msg.info.join(&quot; &quot;));
+}
 this.counter+=1;
 while(this.maxSize&gt;=0&amp;&amp;this._messages.length&gt;this.maxSize){
 this._messages.shift();
 }
-},getMessages:function(_201){
-var _202=0;
-if(!(typeof (_201)==&quot;undefined&quot;||_201==null)){
-_202=Math.max(0,this._messages.length-_201);
+},getMessages:function(_206){
+var _207=0;
+if(!(typeof (_206)==&quot;undefined&quot;||_206===null)){
+_207=Math.max(0,this._messages.length-_206);
 }
-return this._messages.slice(_202);
-},getMessageText:function(_203){
-if(typeof (_203)==&quot;undefined&quot;||_203==null){
-_203=30;
+return this._messages.slice(_207);
+},getMessageText:function(_208){
+if(typeof (_208)==&quot;undefined&quot;||_208===null){
+_208=30;
 }
-var _204=this.getMessages(_203);
-if(_204.length){
+var _209=this.getMessages(_208);
+if(_209.length){
 var lst=map(function(m){
 return &quot;\n  [&quot;+m.num+&quot;] &quot;+m.level+&quot;: &quot;+m.info.join(&quot; &quot;);
-},_204);
-lst.unshift(&quot;LAST &quot;+_204.length+&quot; MESSAGES:&quot;);
+},_209);
+lst.unshift(&quot;LAST &quot;+_209.length+&quot; MESSAGES:&quot;);
 return lst.join(&quot;&quot;);
 }
 return &quot;&quot;;
-},debuggingBookmarklet:function(_205){
+},debuggingBookmarklet:function(_210){
 if(typeof (MochiKit.LoggingPane)==&quot;undefined&quot;){
 alert(this.getMessageText());
 }else{
-MochiKit.LoggingPane.createLoggingPane(_205||false);
+MochiKit.LoggingPane.createLoggingPane(_210||false);
 }
 }};
 MochiKit.Logging.__new__=function(){
 this.LogLevel={ERROR:40,FATAL:50,WARNING:30,INFO:20,DEBUG:10};
 var m=MochiKit.Base;
 m.registerComparator(&quot;LogMessage&quot;,this.isLogMessage,this.compareLogMessage);
-var _206=m.partial;
-var _207=this.Logger;
-var _208=_207.prototype.baseLog;
-m.update(this.Logger.prototype,{debug:_206(_208,&quot;DEBUG&quot;),log:_206(_208,&quot;INFO&quot;),error:_206(_208,&quot;ERROR&quot;),fatal:_206(_208,&quot;FATAL&quot;),warning:_206(_208,&quot;WARNING&quot;)});
+var _211=m.partial;
+var _212=this.Logger;
+var _213=_212.prototype.baseLog;
+m.update(this.Logger.prototype,{debug:_211(_213,&quot;DEBUG&quot;),log:_211(_213,&quot;INFO&quot;),error:_211(_213,&quot;ERROR&quot;),fatal:_211(_213,&quot;FATAL&quot;),warning:_211(_213,&quot;WARNING&quot;)});
 var self=this;
-var _209=function(name){
+var _214=function(name){
 return function(){
 self.logger[name].apply(self.logger,arguments);
 };
 };
-this.log=_209(&quot;log&quot;);
-this.logError=_209(&quot;error&quot;);
-this.logDebug=_209(&quot;debug&quot;);
-this.logFatal=_209(&quot;fatal&quot;);
-this.logWarning=_209(&quot;warning&quot;);
-this.logger=new _207();
+this.log=_214(&quot;log&quot;);
+this.logError=_214(&quot;error&quot;);
+this.logDebug=_214(&quot;debug&quot;);
+this.logFatal=_214(&quot;fatal&quot;);
+this.logWarning=_214(&quot;warning&quot;);
+this.logger=new _212();
+this.logger.useNativeConsole=true;
 this.EXPORT_TAGS={&quot;:common&quot;:this.EXPORT,&quot;:all&quot;:m.concat(this.EXPORT,this.EXPORT_OK)};
 m.nameFunctions(this);
 };
+if(typeof (printfire)==&quot;undefined&quot;&amp;&amp;typeof (document)!=&quot;undefined&quot;&amp;&amp;document.createEvent&amp;&amp;typeof (dispatchEvent)!=&quot;undefined&quot;){
+printfire=function(){
+printfire.args=arguments;
+var ev=document.createEvent(&quot;Events&quot;);
+ev.initEvent(&quot;printfire&quot;,false,true);
+dispatchEvent(ev);
+};
+}
 MochiKit.Logging.__new__();
 MochiKit.Base._exportSymbols(this,MochiKit.Logging);
 if(typeof (dojo)!=&quot;undefined&quot;){
@@ -1610,7 +1662,7 @@
 MochiKit.DateTime={};
 }
 MochiKit.DateTime.NAME=&quot;MochiKit.DateTime&quot;;
-MochiKit.DateTime.VERSION=&quot;1.3&quot;;
+MochiKit.DateTime.VERSION=&quot;1.3.1&quot;;
 MochiKit.DateTime.__repr__=function(){
 return &quot;[&quot;+this.NAME+&quot; &quot;+this.VERSION+&quot;]&quot;;
 };
@@ -1619,11 +1671,11 @@
 };
 MochiKit.DateTime.isoDate=function(str){
 str=str+&quot;&quot;;
-if(typeof (str)!=&quot;string&quot;||str.length==0){
+if(typeof (str)!=&quot;string&quot;||str.length===0){
 return null;
 }
 var iso=str.split(&quot;-&quot;);
-if(iso.length==0){
+if(iso.length===0){
 return null;
 }
 return new Date(iso[0],iso[1]-1,iso[2]);
@@ -1631,38 +1683,38 @@
 MochiKit.DateTime._isoRegexp=/(\d{4,})(?:-(\d{1,2})(?:-(\d{1,2})(?:[T ](\d{1,2}):(\d{1,2})(?::(\d{1,2})(?:\.(\d+))?)?(?:(Z)|([+-])(\d{1,2})(?::(\d{1,2}))?)?)?)?)?/;
 MochiKit.DateTime.isoTimestamp=function(str){
 str=str+&quot;&quot;;
-if(typeof (str)!=&quot;string&quot;||str.length==0){
+if(typeof (str)!=&quot;string&quot;||str.length===0){
 return null;
 }
 var res=str.match(MochiKit.DateTime._isoRegexp);
-if(typeof (res)==&quot;undefined&quot;||res==null){
+if(typeof (res)==&quot;undefined&quot;||res===null){
 return null;
 }
 var year,month,day,hour,min,sec,msec;
 year=parseInt(res[1],10);
-if(typeof (res[2])==&quot;undefined&quot;||res[2]==&quot;&quot;){
+if(typeof (res[2])==&quot;undefined&quot;||res[2]===&quot;&quot;){
 return new Date(year);
 }
 month=parseInt(res[2],10)-1;
 day=parseInt(res[3],10);
-if(typeof (res[4])==&quot;undefined&quot;||res[4]==&quot;&quot;){
+if(typeof (res[4])==&quot;undefined&quot;||res[4]===&quot;&quot;){
 return new Date(year,month,day);
 }
 hour=parseInt(res[4],10);
 min=parseInt(res[5],10);
-sec=(typeof (res[6])!=&quot;undefined&quot;&amp;&amp;res[6]!=&quot;&quot;)?parseInt(res[6],10):0;
-if(typeof (res[7])!=&quot;undefined&quot;&amp;&amp;res[7]!=&quot;&quot;){
+sec=(typeof (res[6])!=&quot;undefined&quot;&amp;&amp;res[6]!==&quot;&quot;)?parseInt(res[6],10):0;
+if(typeof (res[7])!=&quot;undefined&quot;&amp;&amp;res[7]!==&quot;&quot;){
 msec=Math.round(1000*parseFloat(&quot;0.&quot;+res[7]));
 }else{
 msec=0;
 }
-if((typeof (res[8])==&quot;undefined&quot;||res[8]==&quot;&quot;)&amp;&amp;(typeof (res[9])==&quot;undefined&quot;||res[9]==&quot;&quot;)){
+if((typeof (res[8])==&quot;undefined&quot;||res[8]===&quot;&quot;)&amp;&amp;(typeof (res[9])==&quot;undefined&quot;||res[9]===&quot;&quot;)){
 return new Date(year,month,day,hour,min,sec,msec);
 }
 var ofs;
-if(typeof (res[9])!=&quot;undefined&quot;&amp;&amp;res[9]!=&quot;&quot;){
+if(typeof (res[9])!=&quot;undefined&quot;&amp;&amp;res[9]!==&quot;&quot;){
 ofs=parseInt(res[10],10)*3600000;
-if(typeof (res[11])!=&quot;undefined&quot;&amp;&amp;res[11]!=&quot;&quot;){
+if(typeof (res[11])!=&quot;undefined&quot;&amp;&amp;res[11]!==&quot;&quot;){
 ofs+=parseInt(res[11],10)*60000;
 }
 if(res[9]==&quot;-&quot;){
@@ -1673,37 +1725,37 @@
 }
 return new Date(Date.UTC(year,month,day,hour,min,sec,msec)-ofs);
 };
-MochiKit.DateTime.toISOTime=function(date,_215){
-if(typeof (date)==&quot;undefined&quot;||date==null){
+MochiKit.DateTime.toISOTime=function(date,_221){
+if(typeof (date)==&quot;undefined&quot;||date===null){
 return null;
 }
 var hh=date.getHours();
 var mm=date.getMinutes();
 var ss=date.getSeconds();
-var lst=[((_215&amp;&amp;(hh&lt;10))?&quot;0&quot;+hh:hh),((mm&lt;10)?&quot;0&quot;+mm:mm),((ss&lt;10)?&quot;0&quot;+ss:ss)];
+var lst=[((_221&amp;&amp;(hh&lt;10))?&quot;0&quot;+hh:hh),((mm&lt;10)?&quot;0&quot;+mm:mm),((ss&lt;10)?&quot;0&quot;+ss:ss)];
 return lst.join(&quot;:&quot;);
 };
-MochiKit.DateTime.toISOTimestamp=function(date,_219){
-if(typeof (date)==&quot;undefined&quot;||date==null){
+MochiKit.DateTime.toISOTimestamp=function(date,_225){
+if(typeof (date)==&quot;undefined&quot;||date===null){
 return null;
 }
-var sep=_219?&quot;T&quot;:&quot; &quot;;
-var foot=_219?&quot;Z&quot;:&quot;&quot;;
-if(_219){
+var sep=_225?&quot;T&quot;:&quot; &quot;;
+var foot=_225?&quot;Z&quot;:&quot;&quot;;
+if(_225){
 date=new Date(date.getTime()+(date.getTimezoneOffset()*60000));
 }
-return MochiKit.DateTime.toISODate(date)+sep+MochiKit.DateTime.toISOTime(date,_219)+foot;
+return MochiKit.DateTime.toISODate(date)+sep+MochiKit.DateTime.toISOTime(date,_225)+foot;
 };
 MochiKit.DateTime.toISODate=function(date){
-if(typeof (date)==&quot;undefined&quot;||date==null){
+if(typeof (date)==&quot;undefined&quot;||date===null){
 return null;
 }
-var _222=MochiKit.DateTime._padTwo;
-return [date.getFullYear(),_222(date.getMonth()+1),_222(date.getDate())].join(&quot;-&quot;);
+var _228=MochiKit.DateTime._padTwo;
+return [date.getFullYear(),_228(date.getMonth()+1),_228(date.getDate())].join(&quot;-&quot;);
 };
 MochiKit.DateTime.americanDate=function(d){
 d=d+&quot;&quot;;
-if(typeof (d)!=&quot;string&quot;||d.length==0){
+if(typeof (d)!=&quot;string&quot;||d.length===0){
 return null;
 }
 var a=d.split(&quot;/&quot;);
@@ -1713,14 +1765,14 @@
 return (n&gt;9)?n:&quot;0&quot;+n;
 };
 MochiKit.DateTime.toPaddedAmericanDate=function(d){
-if(typeof (d)==&quot;undefined&quot;||d==null){
+if(typeof (d)==&quot;undefined&quot;||d===null){
 return null;
 }
-var _224=MochiKit.DateTime._padTwo;
-return [_224(d.getMonth()+1),_224(d.getDate()),d.getFullYear()].join(&quot;/&quot;);
+var _230=MochiKit.DateTime._padTwo;
+return [_230(d.getMonth()+1),_230(d.getDate()),d.getFullYear()].join(&quot;/&quot;);
 };
 MochiKit.DateTime.toAmericanDate=function(d){
-if(typeof (d)==&quot;undefined&quot;||d==null){
+if(typeof (d)==&quot;undefined&quot;||d===null){
 return null;
 }
 return [d.getMonth()+1,d.getDate(),d.getFullYear()].join(&quot;/&quot;);
@@ -1745,11 +1797,11 @@
 if(typeof (MochiKit.Base)!=&quot;undefined&quot;){
 MochiKit.Base._exportSymbols(this,MochiKit.DateTime);
 }else{
-(function(_225,_226){
+(function(_231,_232){
 if((typeof (JSAN)==&quot;undefined&quot;&amp;&amp;typeof (dojo)==&quot;undefined&quot;)||(typeof (MochiKit.__compat__)==&quot;boolean&quot;&amp;&amp;MochiKit.__compat__)){
-var all=_226.EXPORT_TAGS[&quot;:all&quot;];
+var all=_232.EXPORT_TAGS[&quot;:all&quot;];
 for(var i=0;i&lt;all.length;i++){
-_225[all[i]]=_226[all[i]];
+_231[all[i]]=_232[all[i]];
 }
 }
 })(this,MochiKit.DateTime);
@@ -1764,87 +1816,87 @@
 MochiKit.Format={};
 }
 MochiKit.Format.NAME=&quot;MochiKit.Format&quot;;
-MochiKit.Format.VERSION=&quot;1.3&quot;;
+MochiKit.Format.VERSION=&quot;1.3.1&quot;;
 MochiKit.Format.__repr__=function(){
 return &quot;[&quot;+this.NAME+&quot; &quot;+this.VERSION+&quot;]&quot;;
 };
 MochiKit.Format.toString=function(){
 return this.__repr__();
 };
-MochiKit.Format._numberFormatter=function(_227,_228,_229,_230,_231,_232,_233,_234,_235){
+MochiKit.Format._numberFormatter=function(_233,_234,_235,_236,_237,_238,_239,_240,_241){
 return function(num){
 num=parseFloat(num);
-if(typeof (num)==&quot;undefined&quot;||num==null||isNaN(num)){
-return _227;
+if(typeof (num)==&quot;undefined&quot;||num===null||isNaN(num)){
+return _233;
 }
-var _236=_228;
-var _237=_229;
+var _242=_234;
+var _243=_235;
 if(num&lt;0){
 num=-num;
 }else{
-_236=_236.replace(/-/,&quot;&quot;);
+_242=_242.replace(/-/,&quot;&quot;);
 }
 var me=arguments.callee;
-var fmt=MochiKit.Format.formatLocale(_230);
-if(_231){
+var fmt=MochiKit.Format.formatLocale(_236);
+if(_237){
 num=num*100;
-_237=fmt.percent+_237;
+_243=fmt.percent+_243;
 }
-num=MochiKit.Format.roundToFixed(num,_232);
-var _239=num.split(/\./);
-var _240=_239[0];
-var frac=(_239.length==1)?&quot;&quot;:_239[1];
+num=MochiKit.Format.roundToFixed(num,_238);
+var _245=num.split(/\./);
+var _246=_245[0];
+var frac=(_245.length==1)?&quot;&quot;:_245[1];
 var res=&quot;&quot;;
-while(_240.length&lt;_233){
-_240=&quot;0&quot;+_240;
+while(_246.length&lt;_239){
+_246=&quot;0&quot;+_246;
 }
-if(_234){
-while(_240.length&gt;_234){
-var i=_240.length-_234;
-res=fmt.separator+_240.substring(i,_240.length)+res;
-_240=_240.substring(0,i);
+if(_240){
+while(_246.length&gt;_240){
+var i=_246.length-_240;
+res=fmt.separator+_246.substring(i,_246.length)+res;
+_246=_246.substring(0,i);
 }
 }
-res=_240+res;
-if(_232&gt;0){
-while(frac.length&lt;_235){
+res=_246+res;
+if(_238&gt;0){
+while(frac.length&lt;_241){
 frac=frac+&quot;0&quot;;
 }
 res=res+fmt.decimal+frac;
 }
-return _236+res+_237;
+return _242+res+_243;
 };
 };
-MochiKit.Format.numberFormatter=function(_242,_243,_244){
-if(typeof (_243)==&quot;undefined&quot;){
-_243=&quot;&quot;;
+MochiKit.Format.numberFormatter=function(_248,_249,_250){
+if(typeof (_249)==&quot;undefined&quot;){
+_249=&quot;&quot;;
 }
-var _245=_242.match(/((?:[0#]+,)?[0#]+)(?:\.([0#]+))?(%)?/);
-if(!_245){
+var _251=_248.match(/((?:[0#]+,)?[0#]+)(?:\.([0#]+))?(%)?/);
+if(!_251){
 throw TypeError(&quot;Invalid pattern&quot;);
 }
-var _246=_242.substr(0,_245.index);
-var _247=_242.substr(_245.index+_245[0].length);
-if(_246.search(/-/)==-1){
-_246=_246+&quot;-&quot;;
+var _252=_248.substr(0,_251.index);
+var _253=_248.substr(_251.index+_251[0].length);
+if(_252.search(/-/)==-1){
+_252=_252+&quot;-&quot;;
 }
-var _248=_245[1];
-var frac=(typeof (_245[2])==&quot;string&quot;&amp;&amp;_245[2]!=&quot;&quot;)?_245[2]:&quot;&quot;;
-var _249=(typeof (_245[3])==&quot;string&quot;&amp;&amp;_245[3]!=&quot;&quot;);
-var tmp=_248.split(/,/);
-var _251;
-if(typeof (_244)==&quot;undefined&quot;){
-_244=&quot;default&quot;;
+var _254=_251[1];
+var frac=(typeof (_251[2])==&quot;string&quot;&amp;&amp;_251[2]!=&quot;&quot;)?_251[2]:&quot;&quot;;
+var _255=(typeof (_251[3])==&quot;string&quot;&amp;&amp;_251[3]!=&quot;&quot;);
+var tmp=_254.split(/,/);
+var _257;
+if(typeof (_250)==&quot;undefined&quot;){
+_250=&quot;default&quot;;
 }
 if(tmp.length==1){
-_251=null;
+_257=null;
 }else{
-_251=tmp[1].length;
+_257=tmp[1].length;
 }
-var _252=_248.length-_248.replace(/0/g,&quot;&quot;).length;
-var _253=frac.length-frac.replace(/0/g,&quot;&quot;).length;
-var _254=frac.length;
-var rval=MochiKit.Format._numberFormatter(_243,_246,_247,_244,_249,_254,_252,_251,_253);
+var _258=_254.length-_254.replace(/0/g,&quot;&quot;).length;
+var _259=frac.length-frac.replace(/0/g,&quot;&quot;).length;
+var _260=frac.length;
+var rval=MochiKit.Format._numberFormatter(_249,_252,_253,_250,_255,_260,_258,_257,_259);
 var m=MochiKit.Base;
 if(m){
 var fn=arguments.callee;
@@ -1855,33 +1907,33 @@
 }
 return rval;
 };
-MochiKit.Format.formatLocale=function(_256){
-if(typeof (_256)==&quot;undefined&quot;||_256==null){
-_256=&quot;default&quot;;
+MochiKit.Format.formatLocale=function(_262){
+if(typeof (_262)==&quot;undefined&quot;||_262===null){
+_262=&quot;default&quot;;
 }
-if(typeof (_256)==&quot;string&quot;){
-var rval=MochiKit.Format.LOCALE[_256];
+if(typeof (_262)==&quot;string&quot;){
+var rval=MochiKit.Format.LOCALE[_262];
 if(typeof (rval)==&quot;string&quot;){
 rval=arguments.callee(rval);
-MochiKit.Format.LOCALE[_256]=rval;
+MochiKit.Format.LOCALE[_262]=rval;
 }
 return rval;
 }else{
-return _256;
+return _262;
 }
 };
-MochiKit.Format.twoDigitAverage=function(_257,_258){
-if(_258){
-var res=_257/_258;
+MochiKit.Format.twoDigitAverage=function(_263,_264){
+if(_264){
+var res=_263/_264;
 if(!isNaN(res)){
-return MochiKit.Format.twoDigitFloat(_257/_258);
+return MochiKit.Format.twoDigitFloat(_263/_264);
 }
 }
 return &quot;0&quot;;
 };
-MochiKit.Format.twoDigitFloat=function(_259){
-var sign=(_259&lt;0?&quot;-&quot;:&quot;&quot;);
-var s=Math.floor(Math.abs(_259)*100).toString();
+MochiKit.Format.twoDigitFloat=function(_265){
+var sign=(_265&lt;0?&quot;-&quot;:&quot;&quot;);
+var s=Math.floor(Math.abs(_265)*100).toString();
 if(s==&quot;0&quot;){
 return s;
 }
@@ -1903,45 +1955,45 @@
 }
 }
 };
-MochiKit.Format.lstrip=function(str,_264){
+MochiKit.Format.lstrip=function(str,_270){
 str=str+&quot;&quot;;
 if(typeof (str)!=&quot;string&quot;){
 return null;
 }
-if(!_264){
+if(!_270){
 return str.replace(/^\s+/,&quot;&quot;);
 }else{
-return str.replace(new RegExp(&quot;^[&quot;+_264+&quot;]+&quot;),&quot;&quot;);
+return str.replace(new RegExp(&quot;^[&quot;+_270+&quot;]+&quot;),&quot;&quot;);
 }
 };
-MochiKit.Format.rstrip=function(str,_265){
+MochiKit.Format.rstrip=function(str,_271){
 str=str+&quot;&quot;;
 if(typeof (str)!=&quot;string&quot;){
 return null;
 }
-if(!_265){
+if(!_271){
 return str.replace(/\s+$/,&quot;&quot;);
 }else{
-return str.replace(new RegExp(&quot;[&quot;+_265+&quot;]+$&quot;),&quot;&quot;);
+return str.replace(new RegExp(&quot;[&quot;+_271+&quot;]+$&quot;),&quot;&quot;);
 }
 };
-MochiKit.Format.strip=function(str,_266){
+MochiKit.Format.strip=function(str,_272){
 var self=MochiKit.Format;
-return self.rstrip(self.lstrip(str,_266),_266);
+return self.rstrip(self.lstrip(str,_272),_272);
 };
-MochiKit.Format.truncToFixed=function(_267,_268){
-_267=Math.floor(_267*Math.pow(10,_268));
-var res=(_267*Math.pow(10,-_268)).toFixed(_268);
+MochiKit.Format.truncToFixed=function(_273,_274){
+_273=Math.floor(_273*Math.pow(10,_274));
+var res=(_273*Math.pow(10,-_274)).toFixed(_274);
 if(res.charAt(0)==&quot;.&quot;){
 res=&quot;0&quot;+res;
 }
 return res;
 };
-MochiKit.Format.roundToFixed=function(_269,_270){
-return MochiKit.Format.truncToFixed(_269+0.5*Math.pow(10,-_270),_270);
+MochiKit.Format.roundToFixed=function(_275,_276){
+return MochiKit.Format.truncToFixed(_275+0.5*Math.pow(10,-_276),_276);
 };
-MochiKit.Format.percentFormat=function(_271){
-return MochiKit.Format.twoDigitFloat(100*_271)+&quot;%&quot;;
+MochiKit.Format.percentFormat=function(_277){
+return MochiKit.Format.twoDigitFloat(100*_277)+&quot;%&quot;;
 };
 MochiKit.Format.EXPORT=[&quot;truncToFixed&quot;,&quot;roundToFixed&quot;,&quot;numberFormatter&quot;,&quot;formatLocale&quot;,&quot;twoDigitAverage&quot;,&quot;twoDigitFloat&quot;,&quot;percentFormat&quot;,&quot;lstrip&quot;,&quot;rstrip&quot;,&quot;strip&quot;];
 MochiKit.Format.LOCALE={en_US:{separator:&quot;,&quot;,decimal:&quot;.&quot;,percent:&quot;%&quot;},de_DE:{separator:&quot;.&quot;,decimal:&quot;,&quot;,percent:&quot;%&quot;},fr_FR:{separator:&quot; &quot;,decimal:&quot;,&quot;,percent:&quot;%&quot;},&quot;default&quot;:&quot;en_US&quot;};
@@ -1974,11 +2026,11 @@
 if(typeof (MochiKit.Base)!=&quot;undefined&quot;){
 MochiKit.Base._exportSymbols(this,MochiKit.Format);
 }else{
-(function(_272,_273){
+(function(_278,_279){
 if((typeof (JSAN)==&quot;undefined&quot;&amp;&amp;typeof (dojo)==&quot;undefined&quot;)||(typeof (MochiKit.__compat__)==&quot;boolean&quot;&amp;&amp;MochiKit.__compat__)){
-var all=_273.EXPORT_TAGS[&quot;:all&quot;];
+var all=_279.EXPORT_TAGS[&quot;:all&quot;];
 for(var i=0;i&lt;all.length;i++){
-_272[all[i]]=_273[all[i]];
+_278[all[i]]=_279[all[i]];
 }
 }
 })(this,MochiKit.Format);
@@ -2002,35 +2054,36 @@
 MochiKit.Async={};
 }
 MochiKit.Async.NAME=&quot;MochiKit.Async&quot;;
-MochiKit.Async.VERSION=&quot;1.3&quot;;
+MochiKit.Async.VERSION=&quot;1.3.1&quot;;
 MochiKit.Async.__repr__=function(){
 return &quot;[&quot;+this.NAME+&quot; &quot;+this.VERSION+&quot;]&quot;;
 };
 MochiKit.Async.toString=function(){
 return this.__repr__();
 };
-MochiKit.Async.Deferred=function(_274){
+MochiKit.Async.Deferred=function(_280){
 this.chain=[];
 this.id=this._nextId();
 this.fired=-1;
 this.paused=0;
 this.results=[null,null];
-this.canceller=_274;
+this.canceller=_280;
 this.silentlyCancelled=false;
+this.chained=false;
 };
 MochiKit.Async.Deferred.prototype={repr:function(){
-var _275;
+var _281;
 if(this.fired==-1){
-_275=&quot;unfired&quot;;
+_281=&quot;unfired&quot;;
 }else{
-if(this.fired==0){
-_275=&quot;success&quot;;
+if(this.fired===0){
+_281=&quot;success&quot;;
 }else{
-_275=&quot;error&quot;;
+_281=&quot;error&quot;;
 }
 }
-return &quot;Deferred(&quot;+this.id+&quot;, &quot;+_275+&quot;)&quot;;
-},toString:MochiKit.Base.forward(&quot;repr&quot;),_nextId:MochiKit.Base.counter(),cancel:function(){
+return &quot;Deferred(&quot;+this.id+&quot;, &quot;+_281+&quot;)&quot;;
+},toString:MochiKit.Base.forwardCall(&quot;repr&quot;),_nextId:MochiKit.Base.counter(),cancel:function(){
 var self=MochiKit.Async;
 if(this.fired==-1){
 if(this.canceller){
@@ -2042,7 +2095,7 @@
 this.errback(new self.CancelledError(this));
 }
 }else{
-if((this.fired==0)&amp;&amp;(this.results[0] instanceof self.Deferred)){
+if((this.fired===0)&amp;&amp;(this.results[0] instanceof self.Deferred)){
 this.results[0].cancel();
 }
 }
@@ -2050,7 +2103,7 @@
 this.paused++;
 },_unpause:function(){
 this.paused--;
-if((this.paused==0)&amp;&amp;(this.fired&gt;=0)){
+if((this.paused===0)&amp;&amp;(this.fired&gt;=0)){
 this._fire();
 }
 },_continue:function(res){
@@ -2070,11 +2123,18 @@
 }
 },callback:function(res){
 this._check();
+if(res instanceof MochiKit.Async.Deferred){
+throw new Error(&quot;Deferred instances can only be chained if they are the result of a callback&quot;);
+}
 this._resback(res);
 },errback:function(res){
 this._check();
+var self=MochiKit.Async;
+if(res instanceof self.Deferred){
+throw new Error(&quot;Deferred instances can only be chained if they are the result of a callback&quot;);
+}
 if(!(res instanceof Error)){
-res=new MochiKit.Async.GenericError(res);
+res=new self.GenericError(res);
 }
 this._resback(res);
 },addBoth:function(fn){
@@ -2093,26 +2153,29 @@
 }
 return this.addCallbacks(null,fn);
 },addCallbacks:function(cb,eb){
+if(this.chained){
+throw new Error(&quot;Chained Deferreds can not be re-used&quot;);
+}
 this.chain.push([cb,eb]);
 if(this.fired&gt;=0){
 this._fire();
 }
 return this;
 },_fire:function(){
-var _278=this.chain;
-var _279=this.fired;
-var res=this.results[_279];
+var _284=this.chain;
+var _285=this.fired;
+var res=this.results[_285];
 var self=this;
 var cb=null;
-while(_278.length&gt;0&amp;&amp;this.paused==0){
-var pair=_278.shift();
-var f=pair[_279];
-if(f==null){
+while(_284.length&gt;0&amp;&amp;this.paused===0){
+var pair=_284.shift();
+var f=pair[_285];
+if(f===null){
 continue;
 }
 try{
 res=f(res);
-_279=((res instanceof Error)?1:0);
+_285=((res instanceof Error)?1:0);
 if(res instanceof MochiKit.Async.Deferred){
 cb=function(res){
 self._continue(res);
@@ -2121,33 +2184,34 @@
 }
 }
 catch(err){
-_279=1;
+_285=1;
 if(!(err instanceof Error)){
 err=new MochiKit.Async.GenericError(err);
 }
 res=err;
 }
 }
-this.fired=_279;
-this.results[_279]=res;
+this.fired=_285;
+this.results[_285]=res;
 if(cb&amp;&amp;this.paused){
 res.addBoth(cb);
+res.chained=true;
 }
 }};
 MochiKit.Base.update(MochiKit.Async,{evalJSONRequest:function(){
 return eval(&quot;(&quot;+arguments[0].responseText+&quot;)&quot;);
-},succeed:function(_281){
+},succeed:function(_287){
 var d=new MochiKit.Async.Deferred();
 d.callback.apply(d,arguments);
 return d;
-},fail:function(_282){
+},fail:function(_288){
 var d=new MochiKit.Async.Deferred();
 d.errback.apply(d,arguments);
 return d;
 },getXMLHttpRequest:function(){
 var self=arguments.callee;
 if(!self.XMLHttpRequest){
-var _283=[function(){
+var _289=[function(){
 return new XMLHttpRequest();
 },function(){
 return new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;);
@@ -2158,8 +2222,8 @@
 },function(){
 throw new MochiKit.Async.BrowserComplianceError(&quot;Browser does not support XMLHttpRequest&quot;);
 }];
-for(var i=0;i&lt;_283.length;i++){
-var func=_283[i];
+for(var i=0;i&lt;_289.length;i++){
+var func=_289[i];
 try{
 self.XMLHttpRequest=func;
 return func();
@@ -2169,52 +2233,32 @@
 }
 }
 return self.XMLHttpRequest();
-},sendXMLHttpRequest:function(req,_285){
-if(typeof (_285)==&quot;undefined&quot;){
-_285=&quot;&quot;;
-}
-var _286=function(){
+},_nothing:function(){
+},_xhr_onreadystatechange:function(d){
+if(this.readyState==4){
 try{
-req.onreadystatechange=null;
+this.onreadystatechange=null;
 }
 catch(e){
 try{
-req.onreadystatechange=function(){
-};
+this.onreadystatechange=MochiKit.Async._nothing;
 }
 catch(e){
 }
 }
-req.abort();
-};
-var self=MochiKit.Async;
-var d=new self.Deferred(_286);
-var _287=function(){
-if(req.readyState==4){
+var _290=null;
 try{
-req.onreadystatechange=null;
+_290=this.status;
+if(!_290&amp;&amp;MochiKit.Base.isNotEmpty(this.responseText)){
+_290=304;
 }
-catch(e){
-try{
-req.onreadystatechange=function(){
-};
 }
 catch(e){
 }
-}
-var _288=null;
-try{
-_288=req.status;
-if(!_288&amp;&amp;MochiKit.Base.isNotEmpty(req.responseText)){
-_288=304;
-}
-}
-catch(e){
-}
-if(_288==200||_288==304){
-d.callback(req);
+if(_290==200||_290==304){
+d.callback(this);
 }else{
-var err=new self.XMLHttpRequestError(req,&quot;Request failed&quot;);
+var err=new MochiKit.Async.XMLHttpRequestError(this,&quot;Request failed&quot;);
 if(err.number){
 d.errback(err);
 }else{
@@ -2222,13 +2266,31 @@
 }
 }
 }
-};
+},_xhr_canceller:function(req){
 try{
-req.onreadystatechange=_287;
-req.send(_285);
+req.onreadystatechange=null;
 }
 catch(e){
 try{
+req.onreadystatechange=MochiKit.Async._nothing;
+}
+catch(e){
+}
+}
+req.abort();
+},sendXMLHttpRequest:function(req,_293){
+if(typeof (_293)==&quot;undefined&quot;||_293===null){
+_293=&quot;&quot;;
+}
+var m=MochiKit.Base;
+var self=MochiKit.Async;
+var d=new self.Deferred(m.partial(self._xhr_canceller,req));
+try{
+req.onreadystatechange=m.bind(self._xhr_onreadystatechange,req,d);
+req.send(_293);
+}
+catch(e){
+try{
 req.onreadystatechange=null;
 }
 catch(ignore){
@@ -2253,28 +2315,28 @@
 var d=self.doSimpleXMLHttpRequest.apply(self,arguments);
 d=d.addCallback(self.evalJSONRequest);
 return d;
-},wait:function(_292,_293){
+},wait:function(_296,_297){
 var d=new MochiKit.Async.Deferred();
 var m=MochiKit.Base;
-if(typeof (_293)!=&quot;undefined&quot;){
+if(typeof (_297)!=&quot;undefined&quot;){
 d.addCallback(function(){
-return _293;
+return _297;
 });
 }
-var _294=setTimeout(m.bind(&quot;callback&quot;,d),Math.floor(_292*1000));
+var _298=setTimeout(m.bind(&quot;callback&quot;,d),Math.floor(_296*1000));
 d.canceller=function(){
 try{
-clearTimeout(_294);
+clearTimeout(_298);
 }
 catch(e){
 }
 };
 return d;
-},callLater:function(_295,func){
+},callLater:function(_299,func){
 var m=MochiKit.Base;
-var _296=m.partial.apply(m,m.extend(null,arguments,1));
-return MochiKit.Async.wait(_295).addCallback(function(res){
-return _296();
+var _300=m.partial.apply(m,m.extend(null,arguments,1));
+return MochiKit.Async.wait(_299).addCallback(function(res){
+return _300();
 });
 }});
 MochiKit.Async.DeferredLock=function(){
@@ -2301,24 +2363,101 @@
 this.waiting.shift().callback(this);
 }
 },_nextId:MochiKit.Base.counter(),repr:function(){
-var _297;
+var _301;
 if(this.locked){
-_297=&quot;locked, &quot;+this.waiting.length+&quot; waiting&quot;;
+_301=&quot;locked, &quot;+this.waiting.length+&quot; waiting&quot;;
 }else{
-_297=&quot;unlocked&quot;;
+_301=&quot;unlocked&quot;;
 }
-return &quot;DeferredLock(&quot;+this.id+&quot;, &quot;+_297+&quot;)&quot;;
-},toString:MochiKit.Base.forward(&quot;repr&quot;)};
-MochiKit.Async.EXPORT=[&quot;AlreadyCalledError&quot;,&quot;CancelledError&quot;,&quot;BrowserComplianceError&quot;,&quot;GenericError&quot;,&quot;XMLHttpRequestError&quot;,&quot;Deferred&quot;,&quot;succeed&quot;,&quot;fail&quot;,&quot;getXMLHttpRequest&quot;,&quot;doSimpleXMLHttpRequest&quot;,&quot;loadJSONDoc&quot;,&quot;wait&quot;,&quot;callLater&quot;,&quot;sendXMLHttpRequest&quot;,&quot;DeferredLock&quot;];
+return &quot;DeferredLock(&quot;+this.id+&quot;, &quot;+_301+&quot;)&quot;;
+},toString:MochiKit.Base.forwardCall(&quot;repr&quot;)};
+MochiKit.Async.DeferredList=function(list,_303,_304,_305,_306){
+this.list=list;
+this.resultList=new Array(this.list.length);
+this.chain=[];
+this.id=this._nextId();
+this.fired=-1;
+this.paused=0;
+this.results=[null,null];
+this.canceller=_306;
+this.silentlyCancelled=false;
+if(this.list.length===0&amp;&amp;!_303){
+this.callback(this.resultList);
+}
+this.finishedCount=0;
+this.fireOnOneCallback=_303;
+this.fireOnOneErrback=_304;
+this.consumeErrors=_305;
+var _307=0;
+MochiKit.Base.map(MochiKit.Base.bind(function(d){
+d.addCallback(MochiKit.Base.bind(this._cbDeferred,this),_307,true);
+d.addErrback(MochiKit.Base.bind(this._cbDeferred,this),_307,false);
+_307+=1;
+},this),this.list);
+};
+MochiKit.Base.update(MochiKit.Async.DeferredList.prototype,MochiKit.Async.Deferred.prototype);
+MochiKit.Base.update(MochiKit.Async.DeferredList.prototype,{_cbDeferred:function(_308,_309,_310){
+this.resultList[_308]=[_309,_310];
+this.finishedCount+=1;
+if(this.fired!==0){
+if(_309&amp;&amp;this.fireOnOneCallback){
+this.callback([_308,_310]);
+}else{
+if(!_309&amp;&amp;this.fireOnOneErrback){
+this.errback(_310);
+}else{
+if(this.finishedCount==this.list.length){
+this.callback(this.resultList);
+}
+}
+}
+}
+if(!_309&amp;&amp;this.consumeErrors){
+_310=null;
+}
+return _310;
+}});
+MochiKit.Async.gatherResults=function(_311){
+var d=new MochiKit.Async.DeferredList(_311,false,true,false);
+d.addCallback(function(_312){
+var ret=[];
+for(var i=0;i&lt;_312.length;i++){
+ret.push(_312[i][1]);
+}
+return ret;
+});
+return d;
+};
+MochiKit.Async.maybeDeferred=function(func){
+var self=MochiKit.Async;
+var _313;
+try{
+var r=func.apply(null,MochiKit.Base.extend([],arguments,1));
+if(r instanceof self.Deferred){
+_313=r;
+}else{
+if(r instanceof Error){
+_313=self.fail(r);
+}else{
+_313=self.succeed(r);
+}
+}
+}
+catch(e){
+_313=self.fail(e);
+}
+return _313;
+};
+MochiKit.Async.EXPORT=[&quot;AlreadyCalledError&quot;,&quot;CancelledError&quot;,&quot;BrowserComplianceError&quot;,&quot;GenericError&quot;,&quot;XMLHttpRequestError&quot;,&quot;Deferred&quot;,&quot;succeed&quot;,&quot;fail&quot;,&quot;getXMLHttpRequest&quot;,&quot;doSimpleXMLHttpRequest&quot;,&quot;loadJSONDoc&quot;,&quot;wait&quot;,&quot;callLater&quot;,&quot;sendXMLHttpRequest&quot;,&quot;DeferredLock&quot;,&quot;DeferredList&quot;,&quot;gatherResults&quot;,&quot;maybeDeferred&quot;];
 MochiKit.Async.EXPORT_OK=[&quot;evalJSONRequest&quot;];
 MochiKit.Async.__new__=function(){
 var m=MochiKit.Base;
 var ne=m.partial(m._newNamedError,this);
-ne(&quot;AlreadyCalledError&quot;,function(_299){
-this.deferred=_299;
+ne(&quot;AlreadyCalledError&quot;,function(_316){
+this.deferred=_316;
 });
-ne(&quot;CancelledError&quot;,function(_300){
-this.deferred=_300;
+ne(&quot;CancelledError&quot;,function(_317){
+this.deferred=_317;
 });
 ne(&quot;BrowserComplianceError&quot;,function(msg){
 this.message=msg;
@@ -2359,7 +2498,7 @@
 MochiKit.DOM={};
 }
 MochiKit.DOM.NAME=&quot;MochiKit.DOM&quot;;
-MochiKit.DOM.VERSION=&quot;1.3&quot;;
+MochiKit.DOM.VERSION=&quot;1.3.1&quot;;
 MochiKit.DOM.__repr__=function(){
 return &quot;[&quot;+this.NAME+&quot; &quot;+this.VERSION+&quot;]&quot;;
 };
@@ -2384,6 +2523,9 @@
 var repr=MochiKit.Base.repr;
 return &quot;{x: &quot;+repr(this.x)+&quot;, y: &quot;+repr(this.y)+&quot;}&quot;;
 };
+MochiKit.DOM.Coordinates.prototype.toString=function(){
+return this.repr();
+};
 MochiKit.Base.update(MochiKit.DOM,{setOpacity:function(elem,o){
 elem=MochiKit.DOM.getElement(elem);
 MochiKit.DOM.updateNodeAttributes(elem,{&quot;style&quot;:{&quot;opacity&quot;:o,&quot;-moz-opacity&quot;:o,&quot;-khtml-opacity&quot;:o,&quot;filter&quot;:&quot; alpha(opacity=&quot;+(o*100)+&quot;)&quot;}});
@@ -2419,39 +2561,42 @@
 return new self.Dimensions(elem.offsetWidth||0,elem.offsetHeight||0);
 }
 var s=elem.style;
-var _305=s.visibility;
-var _306=s.position;
+var _322=s.visibility;
+var _323=s.position;
 s.visibility=&quot;hidden&quot;;
 s.position=&quot;absolute&quot;;
 s.display=&quot;&quot;;
-var _307=elem.offsetWidth;
-var _308=elem.offsetHeight;
+var _324=elem.offsetWidth;
+var _325=elem.offsetHeight;
 s.display=&quot;none&quot;;
-s.position=_306;
-s.visibility=_305;
-return new self.Dimensions(_307,_308);
-},elementPosition:function(elem,_309){
+s.position=_323;
+s.visibility=_322;
+return new self.Dimensions(_324,_325);
+},elementPosition:function(elem,_326){
 var self=MochiKit.DOM;
 elem=self.getElement(elem);
-if(!elem||elem.parentNode===null||self.computedStyle(elem,&quot;display&quot;)==&quot;none&quot;){
+if(!elem){
 return undefined;
 }
 var c=new self.Coordinates(0,0);
+if(elem.x&amp;&amp;elem.y){
+c.x+=elem.x||0;
+c.y+=elem.y||0;
+return c;
+}else{
+if(elem.parentNode===null||self.computedStyle(elem,&quot;display&quot;)==&quot;none&quot;){
+return undefined;
+}
+}
 var box=null;
-var _312=null;
+var _329=null;
 var d=MochiKit.DOM._document;
-if(typeof (_309)!=&quot;undefined&quot;){
-_309=arguments.callee(_309);
-if(_309){
-c.x-=(_309.x||0);
-c.y-=(_309.y||0);
-}
-}
+var de=d.documentElement;
+var b=d.body;
 if(elem.getBoundingClientRect){
 box=elem.getBoundingClientRect();
-c.x+=box.left+(d.documentElement.scrollLeft||d.body.scrollLeft);
-c.y+=box.top+(d.documentElement.scrollTop||d.body.scrollTop);
-return c;
+c.x+=box.left+(de.scrollLeft||b.scrollLeft)-(de.clientLeft||b.clientLeft);
+c.y+=box.top+(de.scrollTop||b.scrollTop)-(de.clientTop||b.clientTop);
 }else{
 if(d.getBoxObjectFor){
 box=d.getBoxObjectFor(elem);
@@ -2461,60 +2606,64 @@
 if(elem.offsetParent){
 c.x+=elem.offsetLeft;
 c.y+=elem.offsetTop;
-_312=elem.offsetParent;
-if(_312!=elem){
-while(_312){
-c.x+=_312.offsetLeft;
-c.y+=_312.offsetTop;
-_312=_312.offsetParent;
+_329=elem.offsetParent;
+if(_329!=elem){
+while(_329){
+c.x+=_329.offsetLeft;
+c.y+=_329.offsetTop;
+_329=_329.offsetParent;
 }
 }
 var ua=navigator.userAgent.toLowerCase();
-if(ua.indexOf(&quot;opera&quot;)!=-1||(ua.indexOf(&quot;safari&quot;)!=-1&amp;&amp;self.computedStyle(elem,&quot;position&quot;)==&quot;absolute&quot;)){
-c.y-=d.body.offsetTop;
+if((typeof (opera)!=&quot;undefined&quot;&amp;&amp;parseFloat(opera.version())&lt;9)||(ua.indexOf(&quot;safari&quot;)!=-1&amp;&amp;self.computedStyle(elem,&quot;position&quot;)==&quot;absolute&quot;)){
+c.x-=b.offsetLeft;
+c.y-=b.offsetTop;
 }
-}else{
-c.x+=elem.x||0;
-c.y+=elem.y||0;
-return c;
 }
 }
 }
+if(typeof (_326)!=&quot;undefined&quot;){
+_326=arguments.callee(_326);
+if(_326){
+c.x-=(_326.x||0);
+c.y-=(_326.y||0);
+}
+}
 if(elem.parentNode){
-_312=elem.parentNode;
+_329=elem.parentNode;
 }else{
-_312=null;
+_329=null;
 }
-while(_312&amp;&amp;_312.tagName!=&quot;BODY&quot;&amp;&amp;_312.tagName!=&quot;HTML&quot;){
-c.x-=_312.scrollLeft;
-c.y-=_312.scrollTop;
-if(_312.parentNode){
-_312=_312.parentNode;
+while(_329&amp;&amp;_329.tagName!=&quot;BODY&quot;&amp;&amp;_329.tagName!=&quot;HTML&quot;){
+c.x-=_329.scrollLeft;
+c.y-=_329.scrollTop;
+if(_329.parentNode){
+_329=_329.parentNode;
 }else{
-_312=null;
+_329=null;
 }
 }
 return c;
-},setElementDimensions:function(elem,_314,_315){
+},setElementDimensions:function(elem,_332,_333){
 elem=MochiKit.DOM.getElement(elem);
-if(typeof (_315)==&quot;undefined&quot;){
-_315=&quot;px&quot;;
+if(typeof (_333)==&quot;undefined&quot;){
+_333=&quot;px&quot;;
 }
-MochiKit.DOM.updateNodeAttributes(elem,{&quot;style&quot;:{&quot;width&quot;:_314.w+_315,&quot;height&quot;:_314.h+_315}});
-},setElementPosition:function(elem,_316,_317){
+MochiKit.DOM.updateNodeAttributes(elem,{&quot;style&quot;:{&quot;width&quot;:_332.w+_333,&quot;height&quot;:_332.h+_333}});
+},setElementPosition:function(elem,_334,_335){
 elem=MochiKit.DOM.getElement(elem);
-if(typeof (_317)==&quot;undefined&quot;){
-_317=&quot;px&quot;;
+if(typeof (_335)==&quot;undefined&quot;){
+_335=&quot;px&quot;;
 }
-MochiKit.DOM.updateNodeAttributes(elem,{&quot;style&quot;:{&quot;left&quot;:_316.x+_317,&quot;top&quot;:_316.y+_317}});
+MochiKit.DOM.updateNodeAttributes(elem,{&quot;style&quot;:{&quot;left&quot;:_334.x+_335,&quot;top&quot;:_334.y+_335}});
 },currentWindow:function(){
 return MochiKit.DOM._window;
 },currentDocument:function(){
 return MochiKit.DOM._document;
 },withWindow:function(win,func){
 var self=MochiKit.DOM;
-var _319=self._document;
-var _320=self._win;
+var _337=self._document;
+var _338=self._win;
 var rval;
 try{
 self._window=win;
@@ -2522,16 +2671,16 @@
 rval=func();
 }
 catch(e){
-self._window=_320;
-self._document=_319;
+self._window=_338;
+self._document=_337;
 throw e;
 }
-self._window=_320;
-self._document=_319;
+self._window=_338;
+self._document=_337;
 return rval;
 },formContents:function(elem){
-var _321=[];
-var _322=[];
+var _339=[];
+var _340=[];
 var m=MochiKit.Base;
 var self=MochiKit.DOM;
 if(typeof (elem)==&quot;undefined&quot;||elem===null){
@@ -2542,56 +2691,56 @@
 m.nodeWalk(elem,function(elem){
 var name=elem.name;
 if(m.isNotEmpty(name)){
-var _323=elem.nodeName;
-if(_323==&quot;INPUT&quot;&amp;&amp;(elem.type==&quot;radio&quot;||elem.type==&quot;checkbox&quot;)&amp;&amp;!elem.checked){
+var _341=elem.nodeName;
+if(_341==&quot;INPUT&quot;&amp;&amp;(elem.type==&quot;radio&quot;||elem.type==&quot;checkbox&quot;)&amp;&amp;!elem.checked){
 return null;
 }
-if(_323==&quot;SELECT&quot;){
+if(_341==&quot;SELECT&quot;){
 if(elem.selectedIndex&gt;=0){
 var opt=elem.options[elem.selectedIndex];
-_321.push(name);
-_322.push((opt.value)?opt.value:opt.text);
+_339.push(name);
+_340.push((opt.value)?opt.value:opt.text);
 return null;
 }
-_321.push(name);
-_322.push(&quot;&quot;);
+_339.push(name);
+_340.push(&quot;&quot;);
 return null;
 }
-if(_323==&quot;FORM&quot;||_323==&quot;P&quot;||_323==&quot;SPAN&quot;||_323==&quot;DIV&quot;){
+if(_341==&quot;FORM&quot;||_341==&quot;P&quot;||_341==&quot;SPAN&quot;||_341==&quot;DIV&quot;){
 return elem.childNodes;
 }
-_321.push(name);
-_322.push(elem.value||&quot;&quot;);
+_339.push(name);
+_340.push(elem.value||&quot;&quot;);
 return null;
 }
 return elem.childNodes;
 });
-return [_321,_322];
+return [_339,_340];
 },withDocument:function(doc,func){
 var self=MochiKit.DOM;
-var _326=self._document;
+var _344=self._document;
 var rval;
 try{
 self._document=doc;
 rval=func();
 }
 catch(e){
-self._document=_326;
+self._document=_344;
 throw e;
 }
-self._document=_326;
+self._document=_344;
 return rval;
-},registerDOMConverter:function(name,_327,wrap,_328){
-MochiKit.DOM.domConverters.register(name,_327,wrap,_328);
+},registerDOMConverter:function(name,_345,wrap,_346){
+MochiKit.DOM.domConverters.register(name,_345,wrap,_346);
 },coerceToDOM:function(node,ctx){
 var im=MochiKit.Iter;
 var self=MochiKit.DOM;
 var iter=im.iter;
-var _332=im.repeat;
+var _350=im.repeat;
 var imap=im.imap;
-var _334=self.domConverters;
-var _335=self.coerceToDOM;
-var _336=MochiKit.Base.NotFound;
+var _352=self.domConverters;
+var _353=self.coerceToDOM;
+var _354=MochiKit.Base.NotFound;
 while(true){
 if(typeof (node)==&quot;undefined&quot;||node===null){
 return null;
@@ -2613,30 +2762,30 @@
 node=node(ctx);
 continue;
 }
-var _337=null;
+var _355=null;
 try{
-_337=iter(node);
+_355=iter(node);
 }
 catch(e){
 }
-if(_337){
-return imap(_335,_337,_332(ctx));
+if(_355){
+return imap(_353,_355,_350(ctx));
 }
 try{
-node=_334.match(node,ctx);
+node=_352.match(node,ctx);
 continue;
 }
 catch(e){
-if(e!=_336){
+if(e!=_354){
 throw e;
 }
 }
 return self._document.createTextNode(node.toString());
 }
 return undefined;
-},setNodeAttribute:function(node,attr,_339){
+},setNodeAttribute:function(node,attr,_357){
 var o={};
-o[attr]=_339;
+o[attr]=_357;
 try{
 return MochiKit.DOM.updateNodeAttributes(node,o);
 }
@@ -2645,30 +2794,30 @@
 return null;
 },getNodeAttribute:function(node,attr){
 var self=MochiKit.DOM;
-var _340=self.attributeArray.renames[attr];
+var _358=self.attributeArray.renames[attr];
 node=self.getElement(node);
 try{
-if(_340){
-return node[_340];
+if(_358){
+return node[_358];
 }
 return node.getAttribute(attr);
 }
 catch(e){
 }
 return null;
-},updateNodeAttributes:function(node,_341){
+},updateNodeAttributes:function(node,_359){
 var elem=node;
 var self=MochiKit.DOM;
 if(typeof (node)==&quot;string&quot;){
 elem=self.getElement(node);
 }
-if(_341){
-var _342=MochiKit.Base.updatetree;
+if(_359){
+var _360=MochiKit.Base.updatetree;
 if(self.attributeArray.compliant){
-for(var k in _341){
-var v=_341[k];
+for(var k in _359){
+var v=_359[k];
 if(typeof (v)==&quot;object&quot;&amp;&amp;typeof (elem[k])==&quot;object&quot;){
-_342(elem[k],v);
+_360(elem[k],v);
 }else{
 if(k.substring(0,2)==&quot;on&quot;){
 if(typeof (v)==&quot;string&quot;){
@@ -2681,18 +2830,18 @@
 }
 }
 }else{
-var _343=self.attributeArray.renames;
-for(k in _341){
-v=_341[k];
-var _344=_343[k];
+var _361=self.attributeArray.renames;
+for(k in _359){
+v=_359[k];
+var _362=_361[k];
 if(k==&quot;style&quot;&amp;&amp;typeof (v)==&quot;string&quot;){
 elem.style.cssText=v;
 }else{
-if(typeof (_344)==&quot;string&quot;){
-elem[_344]=v;
+if(typeof (_362)==&quot;string&quot;){
+elem[_362]=v;
 }else{
 if(typeof (elem[k])==&quot;object&quot;&amp;&amp;typeof (v)==&quot;object&quot;){
-_342(elem[k],v);
+_360(elem[k],v);
 }else{
 if(k.substring(0,2)==&quot;on&quot;){
 if(typeof (v)==&quot;string&quot;){
@@ -2715,16 +2864,16 @@
 if(typeof (node)==&quot;string&quot;){
 elem=self.getElement(node);
 }
-var _345=[self.coerceToDOM(MochiKit.Base.extend(null,arguments,1),elem)];
-var _346=MochiKit.Base.concat;
-while(_345.length){
-var n=_345.shift();
+var _363=[self.coerceToDOM(MochiKit.Base.extend(null,arguments,1),elem)];
+var _364=MochiKit.Base.concat;
+while(_363.length){
+var n=_363.shift();
 if(typeof (n)==&quot;undefined&quot;||n===null){
 }else{
 if(typeof (n.nodeType)==&quot;number&quot;){
 elem.appendChild(n);
 }else{
-_345=_346(n,_345);
+_363=_364(n,_363);
 }
 }
 }
@@ -2736,33 +2885,38 @@
 elem=self.getElement(node);
 arguments[0]=elem;
 }
-var _347;
-while((_347=elem.firstChild)){
-elem.removeChild(_347);
+var _365;
+while((_365=elem.firstChild)){
+elem.removeChild(_365);
 }
 if(arguments.length&lt;2){
 return elem;
 }else{
 return self.appendChildNodes.apply(this,arguments);
 }
-},createDOM:function(name,_348){
+},createDOM:function(name,_366){
 var elem;
 var self=MochiKit.DOM;
+var m=MochiKit.Base;
+if(typeof (_366)==&quot;string&quot;||typeof (_366)==&quot;number&quot;){
+var args=m.extend([name,null],arguments,1);
+return arguments.callee.apply(this,args);
+}
 if(typeof (name)==&quot;string&quot;){
-if(_348&amp;&amp;&quot;name&quot; in _348&amp;&amp;!self.attributeArray.compliant){
-name=(&quot;&lt;&quot;+name+&quot; name=\&quot;&quot;+self.escapeHTML(_348.name)+&quot;\&quot;&gt;&quot;);
+if(_366&amp;&amp;&quot;name&quot; in _366&amp;&amp;!self.attributeArray.compliant){
+name=(&quot;&lt;&quot;+name+&quot; name=\&quot;&quot;+self.escapeHTML(_366.name)+&quot;\&quot;&gt;&quot;);
 }
 elem=self._document.createElement(name);
 }else{
 elem=name;
 }
-if(_348){
-self.updateNodeAttributes(elem,_348);
+if(_366){
+self.updateNodeAttributes(elem,_366);
 }
 if(arguments.length&lt;=2){
 return elem;
 }else{
-var args=MochiKit.Base.extend([elem],arguments,2);
+var args=m.extend([elem],arguments,2);
 return self.appendChildNodes.apply(this,args);
 }
 },createDOMFunc:function(){
@@ -2771,12 +2925,12 @@
 },swapDOM:function(dest,src){
 var self=MochiKit.DOM;
 dest=self.getElement(dest);
-var _351=dest.parentNode;
+var _369=dest.parentNode;
 if(src){
 src=self.getElement(src);
-_351.replaceChild(src,dest);
+_369.replaceChild(src,dest);
 }else{
-_351.removeChild(dest);
+_369.removeChild(dest);
 }
 return src;
 },getElement:function(id){
@@ -2786,60 +2940,60 @@
 }else{
 return MochiKit.Base.map(self.getElement,arguments);
 }
-},computedStyle:function(_353,_354,_355){
+},computedStyle:function(_371,_372,_373){
 if(arguments.length==2){
-_355=_354;
+_373=_372;
 }
 var self=MochiKit.DOM;
-var el=self.getElement(_353);
-var _357=self._document;
-if(!el||el==_357){
+var el=self.getElement(_371);
+var _375=self._document;
+if(!el||el==_375){
 return undefined;
 }
 if(el.currentStyle){
-return el.currentStyle[_354];
+return el.currentStyle[_372];
 }
-if(typeof (_357.defaultView)==&quot;undefined&quot;){
+if(typeof (_375.defaultView)==&quot;undefined&quot;){
 return undefined;
 }
-if(_357.defaultView===null){
+if(_375.defaultView===null){
 return undefined;
 }
-var _358=_357.defaultView.getComputedStyle(el,null);
-if(typeof (_358)==&quot;undefined&quot;||_358===null){
+var _376=_375.defaultView.getComputedStyle(el,null);
+if(typeof (_376)==&quot;undefined&quot;||_376===null){
 return undefined;
 }
-return _358.getPropertyValue(_355);
-},getElementsByTagAndClassName:function(_359,_360,_361){
+return _376.getPropertyValue(_373);
+},getElementsByTagAndClassName:function(_377,_378,_379){
 var self=MochiKit.DOM;
-if(typeof (_359)==&quot;undefined&quot;||_359===null){
-_359=&quot;*&quot;;
+if(typeof (_377)==&quot;undefined&quot;||_377===null){
+_377=&quot;*&quot;;
 }
-if(typeof (_361)==&quot;undefined&quot;||_361===null){
-_361=self._document;
+if(typeof (_379)==&quot;undefined&quot;||_379===null){
+_379=self._document;
 }
-_361=self.getElement(_361);
-var _362=(_361.getElementsByTagName(_359)||self._document.all);
-if(typeof (_360)==&quot;undefined&quot;||_360===null){
-return MochiKit.Base.extend(null,_362);
+_379=self.getElement(_379);
+var _380=(_379.getElementsByTagName(_377)||self._document.all);
+if(typeof (_378)==&quot;undefined&quot;||_378===null){
+return MochiKit.Base.extend(null,_380);
 }
-var _363=[];
-for(var i=0;i&lt;_362.length;i++){
-var _364=_362[i];
-var _365=_364.className.split(&quot; &quot;);
-for(var j=0;j&lt;_365.length;j++){
-if(_365[j]==_360){
-_363.push(_364);
+var _381=[];
+for(var i=0;i&lt;_380.length;i++){
+var _382=_380[i];
+var _383=_382.className.split(&quot; &quot;);
+for(var j=0;j&lt;_383.length;j++){
+if(_383[j]==_378){
+_381.push(_382);
 break;
 }
 }
 }
-return _363;
+return _381;
 },_newCallStack:function(path,once){
 var rval=function(){
-var _368=arguments.callee.callStack;
-for(var i=0;i&lt;_368.length;i++){
-if(_368[i].apply(this,arguments)===false){
+var _386=arguments.callee.callStack;
+for(var i=0;i&lt;_386.length;i++){
+if(_386[i].apply(this,arguments)===false){
 break;
 }
 }
@@ -2853,98 +3007,98 @@
 };
 rval.callStack=[];
 return rval;
-},addToCallStack:function(_369,path,func,once){
+},addToCallStack:function(_387,path,func,once){
 var self=MochiKit.DOM;
-var _370=_369[path];
-var _371=_370;
-if(!(typeof (_370)==&quot;function&quot;&amp;&amp;typeof (_370.callStack)==&quot;object&quot;&amp;&amp;_370.callStack!==null)){
-_371=self._newCallStack(path,once);
-if(typeof (_370)==&quot;function&quot;){
-_371.callStack.push(_370);
+var _388=_387[path];
+var _389=_388;
+if(!(typeof (_388)==&quot;function&quot;&amp;&amp;typeof (_388.callStack)==&quot;object&quot;&amp;&amp;_388.callStack!==null)){
+_389=self._newCallStack(path,once);
+if(typeof (_388)==&quot;function&quot;){
+_389.callStack.push(_388);
 }
-_369[path]=_371;
+_387[path]=_389;
 }
-_371.callStack.push(func);
+_389.callStack.push(func);
 },addLoadEvent:function(func){
 var self=MochiKit.DOM;
 self.addToCallStack(self._window,&quot;onload&quot;,func,true);
-},focusOnLoad:function(_372){
+},focusOnLoad:function(_390){
 var self=MochiKit.DOM;
 self.addLoadEvent(function(){
-_372=self.getElement(_372);
-if(_372){
-_372.focus();
+_390=self.getElement(_390);
+if(_390){
+_390.focus();
 }
 });
-},setElementClass:function(_373,_374){
+},setElementClass:function(_391,_392){
 var self=MochiKit.DOM;
-var obj=self.getElement(_373);
+var obj=self.getElement(_391);
 if(self.attributeArray.compliant){
-obj.setAttribute(&quot;class&quot;,_374);
+obj.setAttribute(&quot;class&quot;,_392);
 }else{
-obj.setAttribute(&quot;className&quot;,_374);
+obj.setAttribute(&quot;className&quot;,_392);
 }
-},toggleElementClass:function(_375){
+},toggleElementClass:function(_393){
 var self=MochiKit.DOM;
 for(var i=1;i&lt;arguments.length;i++){
 var obj=self.getElement(arguments[i]);
-if(!self.addElementClass(obj,_375)){
-self.removeElementClass(obj,_375);
+if(!self.addElementClass(obj,_393)){
+self.removeElementClass(obj,_393);
 }
 }
-},addElementClass:function(_376,_377){
+},addElementClass:function(_394,_395){
 var self=MochiKit.DOM;
-var obj=self.getElement(_376);
+var obj=self.getElement(_394);
 var cls=obj.className;
 if(cls.length===0){
-self.setElementClass(obj,_377);
+self.setElementClass(obj,_395);
 return true;
 }
-if(cls==_377){
+if(cls==_395){
 return false;
 }
-var _379=obj.className.split(&quot; &quot;);
-for(var i=0;i&lt;_379.length;i++){
-if(_379[i]==_377){
+var _397=obj.className.split(&quot; &quot;);
+for(var i=0;i&lt;_397.length;i++){
+if(_397[i]==_395){
 return false;
 }
 }
-self.setElementClass(obj,cls+&quot; &quot;+_377);
+self.setElementClass(obj,cls+&quot; &quot;+_395);
 return true;
-},removeElementClass:function(_380,_381){
+},removeElementClass:function(_398,_399){
 var self=MochiKit.DOM;
-var obj=self.getElement(_380);
+var obj=self.getElement(_398);
 var cls=obj.className;
 if(cls.length===0){
 return false;
 }
-if(cls==_381){
+if(cls==_399){
 self.setElementClass(obj,&quot;&quot;);
 return true;
 }
-var _382=obj.className.split(&quot; &quot;);
-for(var i=0;i&lt;_382.length;i++){
-if(_382[i]==_381){
-_382.splice(i,1);
-self.setElementClass(obj,_382.join(&quot; &quot;));
+var _400=obj.className.split(&quot; &quot;);
+for(var i=0;i&lt;_400.length;i++){
+if(_400[i]==_399){
+_400.splice(i,1);
+self.setElementClass(obj,_400.join(&quot; &quot;));
 return true;
 }
 }
 return false;
-},swapElementClass:function(_383,_384,_385){
-var obj=MochiKit.DOM.getElement(_383);
-var res=MochiKit.DOM.removeElementClass(obj,_384);
+},swapElementClass:function(_401,_402,_403){
+var obj=MochiKit.DOM.getElement(_401);
+var res=MochiKit.DOM.removeElementClass(obj,_402);
 if(res){
-MochiKit.DOM.addElementClass(obj,_385);
+MochiKit.DOM.addElementClass(obj,_403);
 }
 return res;
-},hasElementClass:function(_386,_387){
-var obj=MochiKit.DOM.getElement(_386);
-var _388=obj.className.split(&quot; &quot;);
+},hasElementClass:function(_404,_405){
+var obj=MochiKit.DOM.getElement(_404);
+var _406=obj.className.split(&quot; &quot;);
 for(var i=1;i&lt;arguments.length;i++){
 var good=false;
-for(var j=0;j&lt;_388.length;j++){
-if(_388[j]==arguments[i]){
+for(var j=0;j&lt;_406.length;j++){
+if(_406[j]==arguments[i]){
 good=true;
 break;
 }
@@ -2962,55 +3116,55 @@
 if(typeof (lst)==&quot;undefined&quot;||lst===null){
 lst=[];
 }
-var _391=[dom];
+var _409=[dom];
 var self=MochiKit.DOM;
-var _392=self.escapeHTML;
-var _393=self.attributeArray;
-while(_391.length){
-dom=_391.pop();
+var _410=self.escapeHTML;
+var _411=self.attributeArray;
+while(_409.length){
+dom=_409.pop();
 if(typeof (dom)==&quot;string&quot;){
 lst.push(dom);
 }else{
 if(dom.nodeType==1){
 lst.push(&quot;&lt;&quot;+dom.nodeName.toLowerCase());
-var _394=[];
-var _395=_393(dom);
-for(var i=0;i&lt;_395.length;i++){
-var a=_395[i];
-_394.push([&quot; &quot;,a.name,&quot;=\&quot;&quot;,_392(a.value),&quot;\&quot;&quot;]);
+var _412=[];
+var _413=_411(dom);
+for(var i=0;i&lt;_413.length;i++){
+var a=_413[i];
+_412.push([&quot; &quot;,a.name,&quot;=\&quot;&quot;,_410(a.value),&quot;\&quot;&quot;]);
 }
-_394.sort();
-for(i=0;i&lt;_394.length;i++){
-var _396=_394[i];
-for(var j=0;j&lt;_396.length;j++){
-lst.push(_396[j]);
+_412.sort();
+for(i=0;i&lt;_412.length;i++){
+var _414=_412[i];
+for(var j=0;j&lt;_414.length;j++){
+lst.push(_414[j]);
 }
 }
 if(dom.hasChildNodes()){
 lst.push(&quot;&gt;&quot;);
-_391.push(&quot;&lt;/&quot;+dom.nodeName.toLowerCase()+&quot;&gt;&quot;);
-var _397=dom.childNodes;
-for(i=_397.length-1;i&gt;=0;i--){
-_391.push(_397[i]);
+_409.push(&quot;&lt;/&quot;+dom.nodeName.toLowerCase()+&quot;&gt;&quot;);
+var _415=dom.childNodes;
+for(i=_415.length-1;i&gt;=0;i--){
+_409.push(_415[i]);
 }
 }else{
 lst.push(&quot;/&gt;&quot;);
 }
 }else{
 if(dom.nodeType==3){
-lst.push(_392(dom.nodeValue));
+lst.push(_410(dom.nodeValue));
 }
 }
 }
 }
 return lst;
-},setDisplayForElement:function(_398,_399){
+},setDisplayForElement:function(_416,_417){
 var m=MochiKit.Base;
-var _400=m.extend(null,arguments,1);
-MochiKit.Iter.forEach(m.filter(null,m.map(MochiKit.DOM.getElement,_400)),function(_399){
-_399.style.display=_398;
+var _418=m.extend(null,arguments,1);
+MochiKit.Iter.forEach(m.filter(null,m.map(MochiKit.DOM.getElement,_418)),function(_417){
+_417.style.display=_416;
 });
-},scrapeText:function(node,_401){
+},scrapeText:function(node,_419){
 var rval=[];
 (function(node){
 var cn=node.childNodes;
@@ -3019,12 +3173,12 @@
 arguments.callee.call(this,cn[i]);
 }
 }
-var _403=node.nodeValue;
-if(typeof (_403)==&quot;string&quot;){
-rval.push(_403);
+var _421=node.nodeValue;
+if(typeof (_421)==&quot;string&quot;){
+rval.push(_421);
 }
 })(MochiKit.DOM.getElement(node));
-if(_401){
+if(_419){
 return rval;
 }else{
 return rval.join(&quot;&quot;);
@@ -3034,65 +3188,65 @@
 this._document=document;
 this._window=win;
 this.domConverters=new m.AdapterRegistry();
-var _404=this._document.createElement(&quot;span&quot;);
-var _405;
-if(_404&amp;&amp;_404.attributes&amp;&amp;_404.attributes.length&gt;0){
-var _406=m.filter;
-_405=function(node){
-return _406(_405.ignoreAttrFilter,node.attributes);
+var _422=this._document.createElement(&quot;span&quot;);
+var _423;
+if(_422&amp;&amp;_422.attributes&amp;&amp;_422.attributes.length&gt;0){
+var _424=m.filter;
+_423=function(node){
+return _424(_423.ignoreAttrFilter,node.attributes);
 };
-_405.ignoreAttr={};
-MochiKit.Iter.forEach(_404.attributes,function(a){
-_405.ignoreAttr[a.name]=a.value;
+_423.ignoreAttr={};
+MochiKit.Iter.forEach(_422.attributes,function(a){
+_423.ignoreAttr[a.name]=a.value;
 });
-_405.ignoreAttrFilter=function(a){
-return (_405.ignoreAttr[a.name]!=a.value);
+_423.ignoreAttrFilter=function(a){
+return (_423.ignoreAttr[a.name]!=a.value);
 };
-_405.compliant=false;
-_405.renames={&quot;class&quot;:&quot;className&quot;,&quot;checked&quot;:&quot;defaultChecked&quot;,&quot;usemap&quot;:&quot;useMap&quot;,&quot;for&quot;:&quot;htmlFor&quot;};
+_423.compliant=false;
+_423.renames={&quot;class&quot;:&quot;className&quot;,&quot;checked&quot;:&quot;defaultChecked&quot;,&quot;usemap&quot;:&quot;useMap&quot;,&quot;for&quot;:&quot;htmlFor&quot;};
 }else{
-_405=function(node){
+_423=function(node){
 return node.attributes;
 };
-_405.compliant=true;
-_405.renames={};
+_423.compliant=true;
+_423.renames={};
 }
-this.attributeArray=_405;
-var _407=this.createDOMFunc;
-this.UL=_407(&quot;ul&quot;);
-this.OL=_407(&quot;ol&quot;);
-this.LI=_407(&quot;li&quot;);
-this.TD=_407(&quot;td&quot;);
-this.TR=_407(&quot;tr&quot;);
-this.TBODY=_407(&quot;tbody&quot;);
-this.THEAD=_407(&quot;thead&quot;);
-this.TFOOT=_407(&quot;tfoot&quot;);
-this.TABLE=_407(&quot;table&quot;);
-this.TH=_407(&quot;th&quot;);
-this.INPUT=_407(&quot;input&quot;);
-this.SPAN=_407(&quot;span&quot;);
-this.A=_407(&quot;a&quot;);
-this.DIV=_407(&quot;div&quot;);
-this.IMG=_407(&quot;img&quot;);
-this.BUTTON=_407(&quot;button&quot;);
-this.TT=_407(&quot;tt&quot;);
-this.PRE=_407(&quot;pre&quot;);
-this.H1=_407(&quot;h1&quot;);
-this.H2=_407(&quot;h2&quot;);
-this.H3=_407(&quot;h3&quot;);
-this.BR=_407(&quot;br&quot;);
-this.HR=_407(&quot;hr&quot;);
-this.LABEL=_407(&quot;label&quot;);
-this.TEXTAREA=_407(&quot;textarea&quot;);
-this.FORM=_407(&quot;form&quot;);
-this.P=_407(&quot;p&quot;);
-this.SELECT=_407(&quot;select&quot;);
-this.OPTION=_407(&quot;option&quot;);
-this.OPTGROUP=_407(&quot;optgroup&quot;);
-this.LEGEND=_407(&quot;legend&quot;);
-this.FIELDSET=_407(&quot;fieldset&quot;);
-this.STRONG=_407(&quot;strong&quot;);
-this.CANVAS=_407(&quot;canvas&quot;);
+this.attributeArray=_423;
+var _425=this.createDOMFunc;
+this.UL=_425(&quot;ul&quot;);
+this.OL=_425(&quot;ol&quot;);
+this.LI=_425(&quot;li&quot;);
+this.TD=_425(&quot;td&quot;);
+this.TR=_425(&quot;tr&quot;);
+this.TBODY=_425(&quot;tbody&quot;);
+this.THEAD=_425(&quot;thead&quot;);
+this.TFOOT=_425(&quot;tfoot&quot;);
+this.TABLE=_425(&quot;table&quot;);
+this.TH=_425(&quot;th&quot;);
+this.INPUT=_425(&quot;input&quot;);
+this.SPAN=_425(&quot;span&quot;);
+this.A=_425(&quot;a&quot;);
+this.DIV=_425(&quot;div&quot;);
+this.IMG=_425(&quot;img&quot;);
+this.BUTTON=_425(&quot;button&quot;);
+this.TT=_425(&quot;tt&quot;);
+this.PRE=_425(&quot;pre&quot;);
+this.H1=_425(&quot;h1&quot;);
+this.H2=_425(&quot;h2&quot;);
+this.H3=_425(&quot;h3&quot;);
+this.BR=_425(&quot;br&quot;);
+this.HR=_425(&quot;hr&quot;);
+this.LABEL=_425(&quot;label&quot;);
+this.TEXTAREA=_425(&quot;textarea&quot;);
+this.FORM=_425(&quot;form&quot;);
+this.P=_425(&quot;p&quot;);
+this.SELECT=_425(&quot;select&quot;);
+this.OPTION=_425(&quot;option&quot;);
+this.OPTGROUP=_425(&quot;optgroup&quot;);
+this.LEGEND=_425(&quot;legend&quot;);
+this.FIELDSET=_425(&quot;fieldset&quot;);
+this.STRONG=_425(&quot;strong&quot;);
+this.CANVAS=_425(&quot;canvas&quot;);
 this.hideElement=m.partial(this.setDisplayForElement,&quot;none&quot;);
 this.showElement=m.partial(this.setDisplayForElement,&quot;block&quot;);
 this.removeElement=this.swapDOM;
@@ -3100,9 +3254,11 @@
 this.EXPORT_TAGS={&quot;:common&quot;:this.EXPORT,&quot;:all&quot;:m.concat(this.EXPORT,this.EXPORT_OK)};
 m.nameFunctions(this);
 }});
-MochiKit.DOM.__new__(this);
+MochiKit.DOM.__new__(((typeof (window)==&quot;undefined&quot;)?this:window));
+if(!MochiKit.__compat__){
 withWindow=MochiKit.DOM.withWindow;
 withDocument=MochiKit.DOM.withDocument;
+}
 MochiKit.Base._exportSymbols(this,MochiKit.DOM);
 if(typeof (dojo)!=&quot;undefined&quot;){
 dojo.provide(&quot;MochiKit.LoggingPane&quot;);
@@ -3125,40 +3281,40 @@
 MochiKit.LoggingPane={};
 }
 MochiKit.LoggingPane.NAME=&quot;MochiKit.LoggingPane&quot;;
-MochiKit.LoggingPane.VERSION=&quot;1.3&quot;;
+MochiKit.LoggingPane.VERSION=&quot;1.3.1&quot;;
 MochiKit.LoggingPane.__repr__=function(){
 return &quot;[&quot;+this.NAME+&quot; &quot;+this.VERSION+&quot;]&quot;;
 };
 MochiKit.LoggingPane.toString=function(){
 return this.__repr__();
 };
-MochiKit.LoggingPane.createLoggingPane=function(_408){
+MochiKit.LoggingPane.createLoggingPane=function(_426){
 var m=MochiKit.LoggingPane;
-_408=!(!_408);
-if(m._loggingPane&amp;&amp;m._loggingPane.inline!=_408){
+_426=!(!_426);
+if(m._loggingPane&amp;&amp;m._loggingPane.inline!=_426){
 m._loggingPane.closePane();
 m._loggingPane=null;
 }
 if(!m._loggingPane||m._loggingPane.closed){
-m._loggingPane=new m.LoggingPane(_408,MochiKit.Logging.logger);
+m._loggingPane=new m.LoggingPane(_426,MochiKit.Logging.logger);
 }
 return m._loggingPane;
 };
-MochiKit.LoggingPane.LoggingPane=function(_409,_410){
-if(typeof (_410)==&quot;undefined&quot;||_410==null){
-_410=MochiKit.Logging.logger;
+MochiKit.LoggingPane.LoggingPane=function(_427,_428){
+if(typeof (_428)==&quot;undefined&quot;||_428===null){
+_428=MochiKit.Logging.logger;
 }
-this.logger=_410;
-var _411=MochiKit.Base.update;
-var _412=MochiKit.Base.updatetree;
+this.logger=_428;
+var _429=MochiKit.Base.update;
+var _430=MochiKit.Base.updatetree;
 var bind=MochiKit.Base.bind;
-var _413=MochiKit.Base.clone;
+var _431=MochiKit.Base.clone;
 var win=window;
 var uid=&quot;_MochiKit_LoggingPane&quot;;
 if(typeof (MochiKit.DOM)!=&quot;undefined&quot;){
 win=MochiKit.DOM.currentWindow();
 }
-if(!_409){
+if(!_427){
 var url=win.location.href.split(&quot;?&quot;)[0].replace(/[:\/.&gt;&lt;&amp;]/g,&quot;_&quot;);
 var name=uid+&quot;_&quot;+url;
 var nwin=win.open(&quot;&quot;,name,&quot;dependent,resizable,height=200&quot;);
@@ -3173,89 +3329,89 @@
 }
 var doc=win.document;
 this.doc=doc;
-var _416=doc.getElementById(uid);
-var _417=!!_416;
-if(_416&amp;&amp;typeof (_416.loggingPane)!=&quot;undefined&quot;){
-_416.loggingPane.logger=this.logger;
-_416.loggingPane.buildAndApplyFilter();
-return _416.loggingPane;
+var _434=doc.getElementById(uid);
+var _435=!!_434;
+if(_434&amp;&amp;typeof (_434.loggingPane)!=&quot;undefined&quot;){
+_434.loggingPane.logger=this.logger;
+_434.loggingPane.buildAndApplyFilter();
+return _434.loggingPane;
 }
-if(_417){
-var _418;
-while((_418=_416.firstChild)){
-_416.removeChild(_418);
+if(_435){
+var _436;
+while((_436=_434.firstChild)){
+_434.removeChild(_436);
 }
 }else{
-_416=doc.createElement(&quot;div&quot;);
-_416.id=uid;
+_434=doc.createElement(&quot;div&quot;);
+_434.id=uid;
 }
-_416.loggingPane=this;
-var _419=doc.createElement(&quot;input&quot;);
-var _420=doc.createElement(&quot;input&quot;);
-var _421=doc.createElement(&quot;button&quot;);
-var _422=doc.createElement(&quot;button&quot;);
-var _423=doc.createElement(&quot;button&quot;);
-var _424=doc.createElement(&quot;button&quot;);
-var _425=doc.createElement(&quot;div&quot;);
-var _426=doc.createElement(&quot;div&quot;);
-var _427=uid+&quot;_Listener&quot;;
-this.colorTable=_413(this.colorTable);
-var _428=[];
-var _429=null;
-var _430=function(msg){
-var _431=msg.level;
-if(typeof (_431)==&quot;number&quot;){
-_431=MochiKit.Logging.LogLevel[_431];
+_434.loggingPane=this;
+var _437=doc.createElement(&quot;input&quot;);
+var _438=doc.createElement(&quot;input&quot;);
+var _439=doc.createElement(&quot;button&quot;);
+var _440=doc.createElement(&quot;button&quot;);
+var _441=doc.createElement(&quot;button&quot;);
+var _442=doc.createElement(&quot;button&quot;);
+var _443=doc.createElement(&quot;div&quot;);
+var _444=doc.createElement(&quot;div&quot;);
+var _445=uid+&quot;_Listener&quot;;
+this.colorTable=_431(this.colorTable);
+var _446=[];
+var _447=null;
+var _448=function(msg){
+var _449=msg.level;
+if(typeof (_449)==&quot;number&quot;){
+_449=MochiKit.Logging.LogLevel[_449];
 }
-return _431;
+return _449;
 };
-var _432=function(msg){
+var _450=function(msg){
 return msg.info.join(&quot; &quot;);
 };
-var _433=bind(function(msg){
-var _434=_430(msg);
-var text=_432(msg);
-var c=this.colorTable[_434];
+var _451=bind(function(msg){
+var _452=_448(msg);
+var text=_450(msg);
+var c=this.colorTable[_452];
 var p=doc.createElement(&quot;span&quot;);
-p.className=&quot;MochiKit-LogMessage MochiKit-LogLevel-&quot;+_434;
+p.className=&quot;MochiKit-LogMessage MochiKit-LogLevel-&quot;+_452;
 p.style.cssText=&quot;margin: 0px; white-space: -moz-pre-wrap; white-space: -o-pre-wrap; white-space: pre-wrap; white-space: pre-line; word-wrap: break-word; wrap-option: emergency; color: &quot;+c;
-p.appendChild(doc.createTextNode(_434+&quot;: &quot;+text));
-_426.appendChild(p);
-_426.appendChild(doc.createElement(&quot;br&quot;));
-if(_425.offsetHeight&gt;_425.scrollHeight){
-_425.scrollTop=0;
+p.appendChild(doc.createTextNode(_452+&quot;: &quot;+text));
+_444.appendChild(p);
+_444.appendChild(doc.createElement(&quot;br&quot;));
+if(_443.offsetHeight&gt;_443.scrollHeight){
+_443.scrollTop=0;
 }else{
-_425.scrollTop=_425.scrollHeight;
+_443.scrollTop=_443.scrollHeight;
 }
 },this);
-var _436=function(msg){
-_428[_428.length]=msg;
-_433(msg);
+var _454=function(msg){
+_446[_446.length]=msg;
+_451(msg);
 };
-var _437=function(){
-var _438,infore;
+var _455=function(){
+var _456,infore;
 try{
-_438=new RegExp(_419.value);
-infore=new RegExp(_420.value);
+_456=new RegExp(_437.value);
+infore=new RegExp(_438.value);
 }
 catch(e){
 logDebug(&quot;Error in filter regex: &quot;+e.message);
 return null;
 }
 return function(msg){
-return (_438.test(_430(msg))&amp;&amp;infore.test(_432(msg)));
+return (_456.test(_448(msg))&amp;&amp;infore.test(_450(msg)));
 };
 };
-var _439=function(){
-while(_426.firstChild){
-_426.removeChild(_426.firstChild);
+var _457=function(){
+while(_444.firstChild){
+_444.removeChild(_444.firstChild);
 }
 };
-var _440=function(){
-_428=[];
-_439();
+var _458=function(){
+_446=[];
+_457();
 };
-var _441=bind(function(){
+var _459=bind(function(){
 if(this.closed){
 return;
 }
@@ -3263,85 +3419,85 @@
 if(MochiKit.LoggingPane._loggingPane==this){
 MochiKit.LoggingPane._loggingPane=null;
 }
-this.logger.removeListener(_427);
-_416.loggingPane=null;
-if(_409){
-_416.parentNode.removeChild(_416);
+this.logger.removeListener(_445);
+_434.loggingPane=null;
+if(_427){
+_434.parentNode.removeChild(_434);
 }else{
 this.win.close();
 }
 },this);
-var _442=function(){
-_439();
-for(var i=0;i&lt;_428.length;i++){
-var msg=_428[i];
-if(_429==null||_429(msg)){
-_433(msg);
+var _460=function(){
+_457();
+for(var i=0;i&lt;_446.length;i++){
+var msg=_446[i];
+if(_447===null||_447(msg)){
+_451(msg);
 }
 }
 };
 this.buildAndApplyFilter=function(){
-_429=_437();
-_442();
-this.logger.removeListener(_427);
-this.logger.addListener(_427,_429,_436);
+_447=_455();
+_460();
+this.logger.removeListener(_445);
+this.logger.addListener(_445,_447,_454);
 };
-var _443=bind(function(){
-_428=this.logger.getMessages();
-_442();
+var _461=bind(function(){
+_446=this.logger.getMessages();
+_460();
 },this);
-var _444=bind(function(_445){
-_445=_445||window.event;
-key=_445.which||_445.keyCode;
+var _462=bind(function(_463){
+_463=_463||window.event;
+key=_463.which||_463.keyCode;
 if(key==13){
 this.buildAndApplyFilter();
 }
 },this);
-var _446=&quot;display: block; left: 0px; bottom: 0px; position: fixed; width: 100%; background-color: white; font: &quot;+this.logFont;
-if(_409){
-_446+=&quot;; height: 10em; border-top: 2px solid black&quot;;
+var _464=&quot;display: block; z-index: 1000; left: 0px; bottom: 0px; position: fixed; width: 100%; background-color: white; font: &quot;+this.logFont;
+if(_427){
+_464+=&quot;; height: 10em; border-top: 2px solid black&quot;;
 }else{
-_446+=&quot;; height: 100%;&quot;;
+_464+=&quot;; height: 100%;&quot;;
 }
-_416.style.cssText=_446;
-if(!_417){
-doc.body.appendChild(_416);
+_434.style.cssText=_464;
+if(!_435){
+doc.body.appendChild(_434);
 }
-_446={&quot;cssText&quot;:&quot;width: 33%; display: inline; font: &quot;+this.logFont};
-_412(_419,{&quot;value&quot;:&quot;FATAL|ERROR|WARNING|INFO|DEBUG&quot;,&quot;onkeypress&quot;:_444,&quot;style&quot;:_446});
-_416.appendChild(_419);
-_412(_420,{&quot;value&quot;:&quot;.*&quot;,&quot;onkeypress&quot;:_444,&quot;style&quot;:_446});
-_416.appendChild(_420);
-_446=&quot;width: 8%; display:inline; font: &quot;+this.logFont;
-_421.appendChild(doc.createTextNode(&quot;Filter&quot;));
-_421.onclick=bind(&quot;buildAndApplyFilter&quot;,this);
-_421.style.cssText=_446;
-_416.appendChild(_421);
-_422.appendChild(doc.createTextNode(&quot;Load&quot;));
-_422.onclick=_443;
-_422.style.cssText=_446;
-_416.appendChild(_422);
-_423.appendChild(doc.createTextNode(&quot;Clear&quot;));
-_423.onclick=_440;
-_423.style.cssText=_446;
-_416.appendChild(_423);
-_424.appendChild(doc.createTextNode(&quot;Close&quot;));
-_424.onclick=_441;
-_424.style.cssText=_446;
-_416.appendChild(_424);
-_425.style.cssText=&quot;overflow: auto; width: 100%&quot;;
-_426.style.cssText=&quot;width: 100%; height: &quot;+(_409?&quot;8em&quot;:&quot;100%&quot;);
-_425.appendChild(_426);
-_416.appendChild(_425);
+_464={&quot;cssText&quot;:&quot;width: 33%; display: inline; font: &quot;+this.logFont};
+_430(_437,{&quot;value&quot;:&quot;FATAL|ERROR|WARNING|INFO|DEBUG&quot;,&quot;onkeypress&quot;:_462,&quot;style&quot;:_464});
+_434.appendChild(_437);
+_430(_438,{&quot;value&quot;:&quot;.*&quot;,&quot;onkeypress&quot;:_462,&quot;style&quot;:_464});
+_434.appendChild(_438);
+_464=&quot;width: 8%; display:inline; font: &quot;+this.logFont;
+_439.appendChild(doc.createTextNode(&quot;Filter&quot;));
+_439.onclick=bind(&quot;buildAndApplyFilter&quot;,this);
+_439.style.cssText=_464;
+_434.appendChild(_439);
+_440.appendChild(doc.createTextNode(&quot;Load&quot;));
+_440.onclick=_461;
+_440.style.cssText=_464;
+_434.appendChild(_440);
+_441.appendChild(doc.createTextNode(&quot;Clear&quot;));
+_441.onclick=_458;
+_441.style.cssText=_464;
+_434.appendChild(_441);
+_442.appendChild(doc.createTextNode(&quot;Close&quot;));
+_442.onclick=_459;
+_442.style.cssText=_464;
+_434.appendChild(_442);
+_443.style.cssText=&quot;overflow: auto; width: 100%&quot;;
+_444.style.cssText=&quot;width: 100%; height: &quot;+(_427?&quot;8em&quot;:&quot;100%&quot;);
+_443.appendChild(_444);
+_434.appendChild(_443);
 this.buildAndApplyFilter();
-_443();
-if(_409){
+_461();
+if(_427){
 this.win=undefined;
 }else{
 this.win=win;
 }
-this.inline=_409;
-this.closePane=_441;
+this.inline=_427;
+this.closePane=_459;
 this.closed=false;
 return this;
 };
@@ -3374,60 +3530,60 @@
 MochiKit.Color={};
 }
 MochiKit.Color.NAME=&quot;MochiKit.Color&quot;;
-MochiKit.Color.VERSION=&quot;1.3&quot;;
+MochiKit.Color.VERSION=&quot;1.3.1&quot;;
 MochiKit.Color.__repr__=function(){
 return &quot;[&quot;+this.NAME+&quot; &quot;+this.VERSION+&quot;]&quot;;
 };
 MochiKit.Color.toString=function(){
 return this.__repr__();
 };
-MochiKit.Color.Color=function(red,_448,blue,_450){
-if(typeof (_450)==&quot;undefined&quot;||_450==null){
-_450=1;
+MochiKit.Color.Color=function(red,_466,blue,_468){
+if(typeof (_468)==&quot;undefined&quot;||_468===null){
+_468=1;
 }
-this.rgb={r:red,g:_448,b:blue,a:_450};
+this.rgb={r:red,g:_466,b:blue,a:_468};
 };
-MochiKit.Color.Color.prototype={__class__:MochiKit.Color.Color,colorWithAlpha:function(_451){
+MochiKit.Color.Color.prototype={__class__:MochiKit.Color.Color,colorWithAlpha:function(_469){
 var rgb=this.rgb;
 var m=MochiKit.Color;
-return m.Color.fromRGB(rgb.r,rgb.g,rgb.b,_451);
+return m.Color.fromRGB(rgb.r,rgb.g,rgb.b,_469);
 },colorWithHue:function(hue){
 var hsl=this.asHSL();
 hsl.h=hue;
 var m=MochiKit.Color;
 return m.Color.fromHSL(hsl);
-},colorWithSaturation:function(_455){
+},colorWithSaturation:function(_473){
 var hsl=this.asHSL();
-hsl.s=_455;
+hsl.s=_473;
 var m=MochiKit.Color;
 return m.Color.fromHSL(hsl);
-},colorWithLightness:function(_456){
+},colorWithLightness:function(_474){
 var hsl=this.asHSL();
-hsl.l=_456;
+hsl.l=_474;
 var m=MochiKit.Color;
 return m.Color.fromHSL(hsl);
-},darkerColorWithLevel:function(_457){
+},darkerColorWithLevel:function(_475){
 var hsl=this.asHSL();
-hsl.l=Math.max(hsl.l-_457,0);
+hsl.l=Math.max(hsl.l-_475,0);
 var m=MochiKit.Color;
 return m.Color.fromHSL(hsl);
-},lighterColorWithLevel:function(_458){
+},lighterColorWithLevel:function(_476){
 var hsl=this.asHSL();
-hsl.l=Math.min(hsl.l+_458,1);
+hsl.l=Math.min(hsl.l+_476,1);
 var m=MochiKit.Color;
 return m.Color.fromHSL(hsl);
-},blendedColor:function(_459,_460){
-if(typeof (_460)==&quot;undefined&quot;||_460==null){
-_460=0.5;
+},blendedColor:function(_477,_478){
+if(typeof (_478)==&quot;undefined&quot;||_478===null){
+_478=0.5;
 }
-var sf=1-_460;
+var sf=1-_478;
 var s=this.rgb;
-var d=_459.rgb;
-var df=_460;
+var d=_477.rgb;
+var df=_478;
 return MochiKit.Color.Color.fromRGB((s.r*sf)+(d.r*df),(s.g*sf)+(d.g*df),(s.b*sf)+(d.b*df),(s.a*sf)+(d.a*df));
-},compareRGB:function(_463){
+},compareRGB:function(_481){
 var a=this.asRGB();
-var b=_463.asRGB();
+var b=_481.asRGB();
 return MochiKit.Base.compare([a.r,a.g,a.b,a.a],[b.r,b.g,b.b,b.a]);
 },isLight:function(){
 return this.asHSL().b&gt;0.5;
@@ -3481,7 +3637,7 @@
 },asHSV:function(){
 var hsv=this.hsv;
 var c=this.rgb;
-if(typeof (hsv)==&quot;undefined&quot;||hsv==null){
+if(typeof (hsv)==&quot;undefined&quot;||hsv===null){
 hsv=MochiKit.Color.rgbToHSV(this.rgb);
 this.hsv=hsv;
 }
@@ -3489,7 +3645,7 @@
 },asHSL:function(){
 var hsl=this.hsl;
 var c=this.rgb;
-if(typeof (hsl)==&quot;undefined&quot;||hsl==null){
+if(typeof (hsl)==&quot;undefined&quot;||hsl===null){
 hsl=MochiKit.Color.rgbToHSL(this.rgb);
 this.hsl=hsl;
 }
@@ -3501,111 +3657,114 @@
 var col=[c.r,c.g,c.b,c.a];
 return this.__class__.NAME+&quot;(&quot;+col.join(&quot;, &quot;)+&quot;)&quot;;
 }};
-MochiKit.Base.update(MochiKit.Color.Color,{fromRGB:function(red,_468,blue,_469){
-var _470=MochiKit.Color.Color;
+MochiKit.Base.update(MochiKit.Color.Color,{fromRGB:function(red,_486,blue,_487){
+var _488=MochiKit.Color.Color;
 if(arguments.length==1){
 var rgb=red;
 red=rgb.r;
-_468=rgb.g;
+_486=rgb.g;
 blue=rgb.b;
 if(typeof (rgb.a)==&quot;undefined&quot;){
-_469=undefined;
+_487=undefined;
 }else{
-_469=rgb.a;
+_487=rgb.a;
 }
 }
-return new _470(red,_468,blue,_469);
-},fromHSL:function(hue,_471,_472,_473){
+return new _488(red,_486,blue,_487);
+},fromHSL:function(hue,_489,_490,_491){
 var m=MochiKit.Color;
 return m.Color.fromRGB(m.hslToRGB.apply(m,arguments));
-},fromHSV:function(hue,_474,_475,_476){
+},fromHSV:function(hue,_492,_493,_494){
 var m=MochiKit.Color;
 return m.Color.fromRGB(m.hsvToRGB.apply(m,arguments));
 },fromName:function(name){
-var _477=MochiKit.Color.Color;
-var _478=_477._namedColors[name.toLowerCase()];
-if(typeof (_478)==&quot;string&quot;){
-return _477.fromHexString(_478);
+var _495=MochiKit.Color.Color;
+if(name.charAt(0)==&quot;\&quot;&quot;){
+name=name.substr(1,name.length-2);
+}
+var _496=_495._namedColors[name.toLowerCase()];
+if(typeof (_496)==&quot;string&quot;){
+return _495.fromHexString(_496);
 }else{
 if(name==&quot;transparent&quot;){
-return _477.transparentColor();
+return _495.transparentColor();
 }
 }
 return null;
-},fromString:function(_479){
+},fromString:function(_497){
 var self=MochiKit.Color.Color;
-var _480=_479.substr(0,3);
-if(_480==&quot;rgb&quot;){
-return self.fromRGBString(_479);
+var _498=_497.substr(0,3);
+if(_498==&quot;rgb&quot;){
+return self.fromRGBString(_497);
 }else{
-if(_480==&quot;hsl&quot;){
-return self.fromHSLString(_479);
+if(_498==&quot;hsl&quot;){
+return self.fromHSLString(_497);
 }else{
-if(_479.charAt(0)==&quot;#&quot;){
-return self.fromHexString(_479);
+if(_497.charAt(0)==&quot;#&quot;){
+return self.fromHexString(_497);
 }
 }
 }
-return self.fromName(_479);
-},fromHexString:function(_481){
-if(_481.charAt(0)==&quot;#&quot;){
-_481=_481.substring(1);
+return self.fromName(_497);
+},fromHexString:function(_499){
+if(_499.charAt(0)==&quot;#&quot;){
+_499=_499.substring(1);
 }
-var _482=[];
+var _500=[];
 var i,hex;
-if(_481.length==3){
+if(_499.length==3){
 for(i=0;i&lt;3;i++){
-hex=_481.substr(i,1);
-_482.push(parseInt(hex+hex,16)/255);
+hex=_499.substr(i,1);
+_500.push(parseInt(hex+hex,16)/255);
 }
 }else{
 for(i=0;i&lt;6;i+=2){
-hex=_481.substr(i,2);
-_482.push(parseInt(hex,16)/255);
+hex=_499.substr(i,2);
+_500.push(parseInt(hex,16)/255);
 }
 }
-var _483=MochiKit.Color.Color;
-return _483.fromRGB.apply(_483,_482);
-},_fromColorString:function(pre,_485,_486,_487){
-if(_487.indexOf(pre)==0){
-_487=_487.substring(_487.indexOf(&quot;(&quot;,3)+1,_487.length-1);
+var _501=MochiKit.Color.Color;
+return _501.fromRGB.apply(_501,_500);
+},_fromColorString:function(pre,_503,_504,_505){
+if(_505.indexOf(pre)===0){
+_505=_505.substring(_505.indexOf(&quot;(&quot;,3)+1,_505.length-1);
 }
-var _488=_487.split(/\s*,\s*/);
-var _489=[];
-for(var i=0;i&lt;_488.length;i++){
-var c=_488[i];
+var _506=_505.split(/\s*,\s*/);
+var _507=[];
+for(var i=0;i&lt;_506.length;i++){
+var c=_506[i];
 var val;
-var _490=c.substring(c.length-3);
+var _508=c.substring(c.length-3);
 if(c.charAt(c.length-1)==&quot;%&quot;){
 val=0.01*parseFloat(c.substring(0,c.length-1));
 }else{
-if(_490==&quot;deg&quot;){
+if(_508==&quot;deg&quot;){
 val=parseFloat(c)/360;
 }else{
-if(_490==&quot;rad&quot;){
+if(_508==&quot;rad&quot;){
 val=parseFloat(c)/(Math.PI*2);
 }else{
-val=_486[i]*parseFloat(c);
+val=_504[i]*parseFloat(c);
 }
 }
 }
-_489.push(val);
+_507.push(val);
 }
-return this[_485].apply(this,_489);
-},fromComputedStyle:function(elem,_491,_492){
+return this[_503].apply(this,_507);
+},fromComputedStyle:function(elem,_509,_510){
 var d=MochiKit.DOM;
 var cls=MochiKit.Color.Color;
 for(elem=d.getElement(elem);elem;elem=elem.parentNode){
-var _493=d.computedStyle.apply(d,arguments);
-if(!_493){
+var _511=d.computedStyle.apply(d,arguments);
+if(!_511){
 continue;
 }
-var _494=cls.fromString(_493);
-if(!_494){
+var _512=cls.fromString(_511);
+if(!_512){
 break;
 }
-if(_494.asRGB().a&gt;0){
-return _494;
+if(_512.asRGB().a&gt;0){
+return _512;
 }
 }
 return null;
@@ -3618,13 +3777,13 @@
 },namedColors:function(){
 return MochiKit.Base.clone(MochiKit.Color.Color._namedColors);
 }});
-MochiKit.Base.update(MochiKit.Color,{clampColorComponent:function(v,_495){
-v*=_495;
+MochiKit.Base.update(MochiKit.Color,{clampColorComponent:function(v,_513){
+v*=_513;
 if(v&lt;0){
 return 0;
 }else{
-if(v&gt;_495){
-return _495;
+if(v&gt;_513){
+return _513;
 }else{
 return v;
 }
@@ -3652,118 +3811,118 @@
 }
 }
 return val;
-},hsvToRGB:function(hue,_498,_499,_500){
+},hsvToRGB:function(hue,_516,_517,_518){
 if(arguments.length==1){
 var hsv=hue;
 hue=hsv.h;
-_498=hsv.s;
-_499=hsv.v;
-_500=hsv.a;
+_516=hsv.s;
+_517=hsv.v;
+_518=hsv.a;
 }
 var red;
-var _501;
+var _519;
 var blue;
-if(_498==0){
+if(_516===0){
 red=0;
-_501=0;
+_519=0;
 blue=0;
 }else{
 var i=Math.floor(hue*6);
 var f=(hue*6)-i;
-var p=_499*(1-_498);
-var q=_499*(1-(_498*f));
-var t=_499*(1-(_498*(1-f)));
+var p=_517*(1-_516);
+var q=_517*(1-(_516*f));
+var t=_517*(1-(_516*(1-f)));
 switch(i){
 case 1:
 red=q;
-_501=_499;
+_519=_517;
 blue=p;
 break;
 case 2:
 red=p;
-_501=_499;
+_519=_517;
 blue=t;
 break;
 case 3:
 red=p;
-_501=q;
-blue=_499;
+_519=q;
+blue=_517;
 break;
 case 4:
 red=t;
-_501=p;
-blue=_499;
+_519=p;
+blue=_517;
 break;
 case 5:
-red=_499;
-_501=p;
+red=_517;
+_519=p;
 blue=q;
 break;
 case 6:
 case 0:
-red=_499;
-_501=t;
+red=_517;
+_519=t;
 blue=p;
 break;
 }
 }
-return {r:red,g:_501,b:blue,a:_500};
-},hslToRGB:function(hue,_503,_504,_505){
+return {r:red,g:_519,b:blue,a:_518};
+},hslToRGB:function(hue,_521,_522,_523){
 if(arguments.length==1){
 var hsl=hue;
 hue=hsl.h;
-_503=hsl.s;
-_504=hsl.l;
-_505=hsl.a;
+_521=hsl.s;
+_522=hsl.l;
+_523=hsl.a;
 }
 var red;
-var _506;
+var _524;
 var blue;
-if(_503==0){
-red=_504;
-_506=_504;
-blue=_504;
+if(_521===0){
+red=_522;
+_524=_522;
+blue=_522;
 }else{
 var m2;
-if(_504&lt;=0.5){
-m2=_504*(1+_503);
+if(_522&lt;=0.5){
+m2=_522*(1+_521);
 }else{
-m2=_504+_503-(_504*_503);
+m2=_522+_521-(_522*_521);
 }
-var m1=(2*_504)-m2;
+var m1=(2*_522)-m2;
 var f=MochiKit.Color._hslValue;
 var h6=hue*6;
 red=f(m1,m2,h6+2);
-_506=f(m1,m2,h6);
+_524=f(m1,m2,h6);
 blue=f(m1,m2,h6-2);
 }
-return {r:red,g:_506,b:blue,a:_505};
-},rgbToHSV:function(red,_510,blue,_511){
+return {r:red,g:_524,b:blue,a:_523};
+},rgbToHSV:function(red,_528,blue,_529){
 if(arguments.length==1){
 var rgb=red;
 red=rgb.r;
-_510=rgb.g;
+_528=rgb.g;
 blue=rgb.b;
-_511=rgb.a;
+_529=rgb.a;
 }
-var max=Math.max(Math.max(red,_510),blue);
-var min=Math.min(Math.min(red,_510),blue);
+var max=Math.max(Math.max(red,_528),blue);
+var min=Math.min(Math.min(red,_528),blue);
 var hue;
-var _514;
-var _515=max;
+var _532;
+var _533=max;
 if(min==max){
 hue=0;
-_514=0;
+_532=0;
 }else{
-var _516=(max-min);
-_514=_516/max;
+var _534=(max-min);
+_532=_534/max;
 if(red==max){
-hue=(_510-blue)/_516;
+hue=(_528-blue)/_534;
 }else{
-if(_510==max){
-hue=2+((blue-red)/_516);
+if(_528==max){
+hue=2+((blue-red)/_534);
 }else{
-hue=4+((red-_510)/_516);
+hue=4+((red-_528)/_534);
 }
 }
 hue/=6;
@@ -3774,37 +3933,37 @@
 hue-=1;
 }
 }
-return {h:hue,s:_514,v:_515,a:_511};
-},rgbToHSL:function(red,_517,blue,_518){
+return {h:hue,s:_532,v:_533,a:_529};
+},rgbToHSL:function(red,_535,blue,_536){
 if(arguments.length==1){
 var rgb=red;
 red=rgb.r;
-_517=rgb.g;
+_535=rgb.g;
 blue=rgb.b;
-_518=rgb.a;
+_536=rgb.a;
 }
-var max=Math.max(red,Math.max(_517,blue));
-var min=Math.min(red,Math.min(_517,blue));
+var max=Math.max(red,Math.max(_535,blue));
+var min=Math.min(red,Math.min(_535,blue));
 var hue;
-var _519;
-var _520=(max+min)/2;
-var _521=max-min;
-if(_521==0){
+var _537;
+var _538=(max+min)/2;
+var _539=max-min;
+if(_539===0){
 hue=0;
-_519=0;
+_537=0;
 }else{
-if(_520&lt;=0.5){
-_519=_521/(max+min);
+if(_538&lt;=0.5){
+_537=_539/(max+min);
 }else{
-_519=_521/(2-max-min);
+_537=_539/(2-max-min);
 }
 if(red==max){
-hue=(_517-blue)/_521;
+hue=(_535-blue)/_539;
 }else{
-if(_517==max){
-hue=2+((blue-red)/_521);
+if(_535==max){
+hue=2+((blue-red)/_539);
 }else{
-hue=4+((red-_517)/_521);
+hue=4+((red-_535)/_539);
 }
 }
 hue/=6;
@@ -3815,33 +3974,33 @@
 hue-=1;
 }
 }
-return {h:hue,s:_519,l:_520,a:_518};
+return {h:hue,s:_537,l:_538,a:_536};
 },toColorPart:function(num){
 num=Math.round(num);
-var _522=num.toString(16);
+var _540=num.toString(16);
 if(num&lt;16){
-return &quot;0&quot;+_522;
+return &quot;0&quot;+_540;
 }
-return _522;
+return _540;
 },__new__:function(){
 var m=MochiKit.Base;
 this.Color.fromRGBString=m.bind(this.Color._fromColorString,this.Color,&quot;rgb&quot;,&quot;fromRGB&quot;,[1/255,1/255,1/255,1]);
 this.Color.fromHSLString=m.bind(this.Color._fromColorString,this.Color,&quot;hsl&quot;,&quot;fromHSL&quot;,[1/360,0.01,0.01,1]);
-var _523=1/3;
-var _524={black:[0,0,0],blue:[0,0,1],brown:[0.6,0.4,0.2],cyan:[0,1,1],darkGray:[_523,_523,_523],gray:[0.5,0.5,0.5],green:[0,1,0],lightGray:[2*_523,2*_523,2*_523],magenta:[1,0,1],orange:[1,0.5,0],purple:[0.5,0,0.5],red:[1,0,0],transparent:[0,0,0,0],white:[1,1,1],yellow:[1,1,0]};
-var _525=function(name,r,g,b,a){
+var _541=1/3;
+var _542={black:[0,0,0],blue:[0,0,1],brown:[0.6,0.4,0.2],cyan:[0,1,1],darkGray:[_541,_541,_541],gray:[0.5,0.5,0.5],green:[0,1,0],lightGray:[2*_541,2*_541,2*_541],magenta:[1,0,1],orange:[1,0.5,0],purple:[0.5,0,0.5],red:[1,0,0],transparent:[0,0,0,0],white:[1,1,1],yellow:[1,1,0]};
+var _543=function(name,r,g,b,a){
 var rval=this.fromRGB(r,g,b,a);
 this[name]=function(){
 return rval;
 };
 return rval;
 };
-for(var k in _524){
+for(var k in _542){
 var name=k+&quot;Color&quot;;
-var _528=m.concat([_525,this.Color,name],_524[k]);
-this.Color[name]=m.bind.apply(null,_528);
+var _545=m.concat([_543,this.Color,name],_542[k]);
+this.Color[name]=m.bind.apply(null,_545);
 }
-var _529=function(){
+var _546=function(){
 for(var i=0;i&lt;arguments.length;i++){
 if(!(arguments[i] instanceof Color)){
 return false;
@@ -3849,11 +4008,11 @@
 }
 return true;
 };
-var _530=function(a,b){
+var _547=function(a,b){
 return a.compareRGB(b);
 };
 m.nameFunctions(this);
-m.registerComparator(this.Color.NAME,_529,_530);
+m.registerComparator(this.Color.NAME,_546,_547);
 this.EXPORT_TAGS={&quot;:common&quot;:this.EXPORT,&quot;:all&quot;:m.concat(this.EXPORT,this.EXPORT_OK)};
 }});
 MochiKit.Color.EXPORT=[&quot;Color&quot;];
@@ -3890,21 +4049,42 @@
 MochiKit.Signal={};
 }
 MochiKit.Signal.NAME=&quot;MochiKit.Signal&quot;;
-MochiKit.Signal.VERSION=&quot;1.3&quot;;
+MochiKit.Signal.VERSION=&quot;1.3.1&quot;;
 MochiKit.Signal._observers=[];
-MochiKit.Signal.Event=function(e){
+MochiKit.Signal.Event=function(src,e){
 this._event=e||window.event;
+this._src=src;
 };
-MochiKit.Signal.Event.prototype.event=function(){
+MochiKit.Base.update(MochiKit.Signal.Event.prototype,{__repr__:function(){
+var repr=MochiKit.Base.repr;
+var str=&quot;{event(): &quot;+repr(this.event())+&quot;, src(): &quot;+repr(this.src())+&quot;, type(): &quot;+repr(this.type())+&quot;, target(): &quot;+repr(this.target())+&quot;, modifier(): &quot;+&quot;{alt: &quot;+repr(this.modifier().alt)+&quot;, ctrl: &quot;+repr(this.modifier().ctrl)+&quot;, meta: &quot;+repr(this.modifier().meta)+&quot;, shift: &quot;+repr(this.modifier().shift)+&quot;, any: &quot;+repr(this.modifier().any)+&quot;}&quot;;
+if(this.type()&amp;&amp;this.type().indexOf(&quot;key&quot;)===0){
+str+=&quot;, key(): {code: &quot;+repr(this.key().code)+&quot;, string: &quot;+repr(this.key().string)+&quot;}&quot;;
+}
+if(this.type()&amp;&amp;(this.type().indexOf(&quot;mouse&quot;)===0||this.type().indexOf(&quot;click&quot;)!=-1||this.type()==&quot;contextmenu&quot;)){
+str+=&quot;, mouse(): {page: &quot;+repr(this.mouse().page)+&quot;, client: &quot;+repr(this.mouse().client);
+if(this.type()!=&quot;mousemove&quot;){
+str+=&quot;, button: {left: &quot;+repr(this.mouse().button.left)+&quot;, middle: &quot;+repr(this.mouse().button.middle)+&quot;, right: &quot;+repr(this.mouse().button.right)+&quot;}}&quot;;
+}else{
+str+=&quot;}&quot;;
+}
+}
+if(this.type()==&quot;mouseover&quot;||this.type()==&quot;mouseout&quot;){
+str+=&quot;, relatedTarget(): &quot;+repr(this.relatedTarget());
+}
+str+=&quot;}&quot;;
+return str;
+},toString:function(){
+return this.__repr__();
+},src:function(){
+return this._src;
+},event:function(){
 return this._event;
-};
-MochiKit.Signal.Event.prototype.type=function(){
+},type:function(){
 return this._event.type||undefined;
-};
-MochiKit.Signal.Event.prototype.target=function(){
+},target:function(){
 return this._event.target||this._event.srcElement;
-};
-MochiKit.Signal.Event.prototype.relatedTarget=function(){
+},relatedTarget:function(){
 if(this.type()==&quot;mouseover&quot;){
 return (this._event.relatedTarget||this._event.fromElement);
 }else{
@@ -3912,17 +4092,16 @@
 return (this._event.relatedTarget||this._event.toElement);
 }
 }
-throw new Error(&quot;No related target&quot;);
-};
-MochiKit.Signal.Event.prototype.modifier=function(){
+return undefined;
+},modifier:function(){
 var m={};
 m.alt=this._event.altKey;
 m.ctrl=this._event.ctrlKey;
 m.meta=this._event.metaKey||false;
 m.shift=this._event.shiftKey;
+m.any=m.alt||m.ctrl||m.shift||m.meta;
 return m;
-};
-MochiKit.Signal.Event.prototype.key=function(){
+},key:function(){
 var k={};
 if(this.type()&amp;&amp;this.type().indexOf(&quot;key&quot;)===0){
 if(this.type()==&quot;keydown&quot;||this.type()==&quot;keyup&quot;){
@@ -3931,137 +4110,103 @@
 return k;
 }else{
 if(this.type()==&quot;keypress&quot;){
-k.code=(this._event.charCode||this._event.keyCode);
+k.code=0;
+k.string=&quot;&quot;;
+if(typeof (this._event.charCode)!=&quot;undefined&quot;&amp;&amp;this._event.charCode!==0&amp;&amp;!MochiKit.Signal._specialMacKeys[this._event.charCode]){
+k.code=this._event.charCode;
 k.string=String.fromCharCode(k.code);
+}else{
+if(this._event.keyCode&amp;&amp;typeof (this._event.charCode)==&quot;undefined&quot;){
+k.code=this._event.keyCode;
+k.string=String.fromCharCode(k.code);
+}
+}
 return k;
 }
 }
 }
-throw new Error(&quot;This is not a key event&quot;);
-};
-MochiKit.Signal.Event.prototype._fixPoint=function(_531){
-if(typeof (_531)==&quot;undefined&quot;||_531&lt;0){
-return 0;
-}
-return _531;
-};
-MochiKit.Signal.Event.prototype.mouse=function(){
+return undefined;
+},mouse:function(){
 var m={};
+var e=this._event;
 if(this.type()&amp;&amp;(this.type().indexOf(&quot;mouse&quot;)===0||this.type().indexOf(&quot;click&quot;)!=-1||this.type()==&quot;contextmenu&quot;)){
 m.client=new MochiKit.DOM.Coordinates(0,0);
-if(this._event.clientX||this._event.clientY){
-m.client.x=this._fixPoint(this._event.clientX);
-m.client.y=this._fixPoint(this._event.clientY);
+if(e.clientX||e.clientY){
+m.client.x=(!e.clientX||e.clientX&lt;0)?0:e.clientX;
+m.client.y=(!e.clientY||e.clientY&lt;0)?0:e.clientY;
 }
 m.page=new MochiKit.DOM.Coordinates(0,0);
-if(this._event.pageX||this._event.pageY){
-m.page.x=this._fixPoint(this._event.pageX);
-m.page.y=this._fixPoint(this._event.pageY);
+if(e.pageX||e.pageY){
+m.page.x=(!e.pageX||e.pageX&lt;0)?0:e.pageX;
+m.page.y=(!e.pageY||e.pageY&lt;0)?0:e.pageY;
 }else{
-m.page.x=(this._event.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft);
-m.page.y=(this._event.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop);
+var de=MochiKit.DOM._document.documentElement;
+var b=MochiKit.DOM._document.body;
+m.page.x=e.clientX+(de.scrollLeft||b.scrollLeft)-(de.clientLeft||b.clientLeft);
+m.page.y=e.clientY+(de.scrollTop||b.scrollTop)-(de.clientTop||b.clientTop);
 }
 if(this.type()!=&quot;mousemove&quot;){
 m.button={};
 m.button.left=false;
 m.button.right=false;
 m.button.middle=false;
-if(this._event.which){
-m.button.left=(this._event.which==1);
-m.button.middle=(this._event.which==2);
-m.button.right=(this._event.which==3);
+if(e.which){
+m.button.left=(e.which==1);
+m.button.middle=(e.which==2);
+m.button.right=(e.which==3);
 }else{
-m.button.left=!!(this._event.button&amp;1);
-m.button.right=!!(this._event.button&amp;2);
-m.button.middle=!!(this._event.button&amp;4);
+m.button.left=!!(e.button&amp;1);
+m.button.right=!!(e.button&amp;2);
+m.button.middle=!!(e.button&amp;4);
 }
 }
 return m;
 }
-throw new Error(&quot;This is not a mouse event&quot;);
-};
-MochiKit.Signal.Event.prototype.stop=function(){
+return undefined;
+},stop:function(){
 this.stopPropagation();
 this.preventDefault();
-};
-MochiKit.Signal.Event.prototype.stopPropagation=function(){
+},stopPropagation:function(){
 if(this._event.stopPropagation){
 this._event.stopPropagation();
 }else{
 this._event.cancelBubble=true;
 }
-};
-MochiKit.Signal.Event.prototype.preventDefault=function(){
+},preventDefault:function(){
 if(this._event.preventDefault){
 this._event.preventDefault();
 }else{
 this._event.returnValue=false;
 }
-};
-MochiKit.Signal.Event.prototype.__repr__=function(){
-var repr=MochiKit.Base.repr;
-var str=&quot;{event(): &quot;+repr(this.event())+&quot;, type(): &quot;+repr(this.type())+&quot;, target(): &quot;+repr(this.target())+&quot;, modifier(): &quot;+&quot;{alt: &quot;+repr(this.modifier().alt)+&quot;, ctrl: &quot;+repr(this.modifier().ctrl)+&quot;, meta: &quot;+repr(this.modifier().meta)+&quot;, shift: &quot;+repr(this.modifier().shift)+&quot;}&quot;;
-if(this.type()&amp;&amp;this.type().indexOf(&quot;key&quot;)===0){
-str+=&quot;, key(): {code: &quot;+repr(this.key().code)+&quot;, string: &quot;+repr(this.key().string)+&quot;}&quot;;
+}});
+MochiKit.Signal._specialMacKeys={3:&quot;KEY_ENTER&quot;,63289:&quot;KEY_NUM_PAD_CLEAR&quot;,63276:&quot;KEY_PAGE_UP&quot;,63277:&quot;KEY_PAGE_DOWN&quot;,63275:&quot;KEY_END&quot;,63273:&quot;KEY_HOME&quot;,63234:&quot;KEY_ARROW_LEFT&quot;,63232:&quot;KEY_ARROW_UP&quot;,63235:&quot;KEY_ARROW_RIGHT&quot;,63233:&quot;KEY_ARROW_DOWN&quot;,63302:&quot;KEY_INSERT&quot;,63272:&quot;KEY_DELETE&quot;};
+for(i=63236;i&lt;=63242;i++){
+MochiKit.Signal._specialMacKeys[i]=&quot;KEY_F&quot;+(i-63236+1);
 }
-if(this.type()&amp;&amp;(this.type().indexOf(&quot;mouse&quot;)===0||this.type().indexOf(&quot;click&quot;)!=-1||this.type()==&quot;contextmenu&quot;)){
-str+=&quot;, mouse(): {page: &quot;+repr(this.mouse().page)+&quot;, client: &quot;+repr(this.mouse().client);
-if(this.type()!=&quot;mousemove&quot;){
-str+=&quot;, button: {left: &quot;+repr(this.mouse().button.left)+&quot;, middle: &quot;+repr(this.mouse().button.middle)+&quot;, right: &quot;+repr(this.mouse().button.right)+&quot;}}&quot;;
-}else{
-str+=&quot;}&quot;;
+MochiKit.Signal._specialKeys={8:&quot;KEY_BACKSPACE&quot;,9:&quot;KEY_TAB&quot;,12:&quot;KEY_NUM_PAD_CLEAR&quot;,13:&quot;KEY_ENTER&quot;,16:&quot;KEY_SHIFT&quot;,17:&quot;KEY_CTRL&quot;,18:&quot;KEY_ALT&quot;,19:&quot;KEY_PAUSE&quot;,20:&quot;KEY_CAPS_LOCK&quot;,27:&quot;KEY_ESCAPE&quot;,32:&quot;KEY_SPACEBAR&quot;,33:&quot;KEY_PAGE_UP&quot;,34:&quot;KEY_PAGE_DOWN&quot;,35:&quot;KEY_END&quot;,36:&quot;KEY_HOME&quot;,37:&quot;KEY_ARROW_LEFT&quot;,38:&quot;KEY_ARROW_UP&quot;,39:&quot;KEY_ARROW_RIGHT&quot;,40:&quot;KEY_ARROW_DOWN&quot;,44:&quot;KEY_PRINT_SCREEN&quot;,45:&quot;KEY_INSERT&quot;,46:&quot;KEY_DELETE&quot;,59:&quot;KEY_SEMICOLON&quot;,91:&quot;KEY_WINDOWS_LEFT&quot;,92:&quot;KEY_WINDOWS_RIGHT&quot;,93:&quot;KEY_SELECT&quot;,106:&quot;KEY_NUM_PAD_ASTERISK&quot;,107:&quot;KEY_NUM_PAD_PLUS_SIGN&quot;,109:&quot;KEY_NUM_PAD_HYPHEN-MINUS&quot;,110:&quot;KEY_NUM_PAD_FULL_STOP&quot;,111:&quot;KEY_NUM_PAD_SOLIDUS&quot;,144:&quot;KEY_NUM_LOCK&quot;,145:&quot;KEY_SCROLL_LOCK&quot;,186:&quot;KEY_SEMICOLON&quot;,187:&quot;KEY_EQUALS_SIGN&quot;,188:&quot;KEY_COMMA&quot;,189:&quot;KEY_HYPHEN-MINUS&quot;,190:&quot;KEY_FULL_STOP&quot;,191:&quot;KEY_SOLIDUS&quot;,192:&quot;KEY_GRAVE_ACCENT&quot;,219:&quot;KEY_LEFT_SQUARE_BRACKET&quot;,220:&quot;KEY_REVERSE_SOLIDUS&quot;,221:&quot;KEY_RIGHT_SQUARE_BRACKET&quot;,222:&quot;KEY_APOSTROPHE&quot;};
+for(var i=48;i&lt;=57;i++){
+MochiKit.Signal._specialKeys[i]=&quot;KEY_&quot;+(i-48);
 }
+for(i=65;i&lt;=90;i++){
+MochiKit.Signal._specialKeys[i]=&quot;KEY_&quot;+String.fromCharCode(i);
 }
-if(this.type()==&quot;mouseover&quot;||this.type()==&quot;mouseout&quot;){
-str+=&quot;, relatedTarget(): &quot;+repr(this.relatedTarget());
+for(i=96;i&lt;=105;i++){
+MochiKit.Signal._specialKeys[i]=&quot;KEY_NUM_PAD_&quot;+(i-96);
 }
-str+=&quot;}&quot;;
-return str;
-};
-MochiKit.Signal.Event.prototype.toString=function(){
-return this.__repr__();
-};
+for(i=112;i&lt;=123;i++){
+MochiKit.Signal._specialKeys[i]=&quot;KEY_F&quot;+(i-112+1);
+}
 MochiKit.Base.update(MochiKit.Signal,{__repr__:function(){
 return &quot;[&quot;+this.NAME+&quot; &quot;+this.VERSION+&quot;]&quot;;
 },toString:function(){
 return this.__repr__();
-},_specialKeys:{8:&quot;KEY_BACKSPACE&quot;,9:&quot;KEY_TAB&quot;,13:&quot;KEY_ENTER&quot;,16:&quot;KEY_SHIFT&quot;,17:&quot;KEY_CTRL&quot;,18:&quot;KEY_ALT&quot;,19:&quot;KEY_PAUSE&quot;,20:&quot;KEY_CAPS_LOCK&quot;,27:&quot;KEY_ESCAPE&quot;,32:&quot;KEY_SPACE&quot;,33:&quot;KEY_PAGE_UP&quot;,34:&quot;KEY_PAGE_DOWN&quot;,35:&quot;KEY_END&quot;,36:&quot;KEY_HOME&quot;,37:&quot;KEY_LEFT_ARROW&quot;,38:&quot;KEY_UP_ARROW&quot;,39:&quot;KEY_RIGHT_ARROW&quot;,40:&quot;KEY_DOWN_ARROW&quot;,45:&quot;KEY_INSERT&quot;,46:&quot;KEY_DELETE&quot;,91:&quot;KEY_LEFT_WINDOW&quot;,92:&quot;KEY_RIGHT_WINDOW&quot;,93:&quot;KEY_SELECT&quot;,112:&quot;KEY_F1&quot;,113:&quot;KEY_F2&quot;,114:&quot;KEY_F3&quot;,115:&quot;KEY_F4&quot;,116:&quot;KEY_F5&quot;,117:&quot;KEY_F6&quot;,118:&quot;KEY_F7&quot;,119:&quot;KEY_F8&quot;,120:&quot;KEY_F9&quot;,121:&quot;KEY_F10&quot;,122:&quot;KEY_F11&quot;,123:&quot;KEY_F12&quot;,144:&quot;KEY_NUM_LOCK&quot;,145:&quot;KEY_SCROLL_LOCK&quot;},_getSlot:function(slot,func){
-if(typeof (func)==&quot;string&quot;||typeof (func)==&quot;function&quot;){
-if(typeof (func)==&quot;string&quot;&amp;&amp;typeof (slot[func])==&quot;undefined&quot;){
-throw new Error(&quot;Invalid function slot&quot;);
-}
-slot=[slot,func];
-}else{
-if(!func&amp;&amp;typeof (slot)==&quot;function&quot;){
-slot=[slot];
-}else{
-throw new Error(&quot;Invalid slot parameters&quot;);
-}
-}
-return slot;
 },_unloadCache:function(){
-for(var i=0;i&lt;MochiKit.Signal._observers.length;i++){
-var src=MochiKit.Signal._observers[i][0];
-var sig=MochiKit.Signal._observers[i][1];
-var _534=MochiKit.Signal._observers[i][2];
-try{
-if(src.addEventListener){
-src.removeEventListener(sig.substr(2),_534,false);
-}else{
-if(src.attachEvent){
-src.detachEvent(sig,_534);
-}else{
-src._signals[sig]=undefined;
+var self=MochiKit.Signal;
+var _548=self._observers;
+for(var i=0;i&lt;_548.length;i++){
+self._disconnect(_548[i]);
 }
-}
-src._listeners[sig]=undefined;
-delete (src._listeners);
-delete (src._signals);
-}
-catch(e){
-}
-}
-MochiKit.Signal._observers=undefined;
+delete self._observers;
 try{
 window.onload=undefined;
 }
@@ -4072,156 +4217,161 @@
 }
 catch(e){
 }
-},connect:function(src,sig,slot,func){
-if(typeof (src)==&quot;string&quot;){
+},_listener:function(src,func,obj,_549){
+var E=MochiKit.Signal.Event;
+if(!_549){
+return MochiKit.Base.bind(func,obj);
+}
+obj=obj||src;
+if(typeof (func)==&quot;string&quot;){
+return function(_551){
+obj[func].apply(obj,[new E(src,_551)]);
+};
+}else{
+return function(_552){
+func.apply(obj,[new E(src,_552)]);
+};
+}
+},connect:function(src,sig,_554,_555){
 src=MochiKit.DOM.getElement(src);
-}
+var self=MochiKit.Signal;
 if(typeof (sig)!=&quot;string&quot;){
 throw new Error(&quot;'sig' must be a string&quot;);
 }
-slot=MochiKit.Signal._getSlot(slot,func);
-if(src.addEventListener||src.attachEvent||src[sig]){
-if(!src._listeners){
-src._listeners={};
+var obj=null;
+var func=null;
+if(typeof (_555)!=&quot;undefined&quot;){
+obj=_554;
+func=_555;
+if(typeof (_555)==&quot;string&quot;){
+if(typeof (_554[_555])!=&quot;function&quot;){
+throw new Error(&quot;'funcOrStr' must be a function on 'objOrFunc'&quot;);
 }
-if(!src._listeners[sig]){
-var _535=function(_536){
-var _537=new MochiKit.Signal.Event(_536);
-MochiKit.Signal.signal(src,sig,_537);
-return true;
-};
-MochiKit.Signal._observers.push([src,sig,_535]);
-if(src.addEventListener){
-src.addEventListener(sig.substr(2),_535,false);
 }else{
-if(src.attachEvent){
-src.attachEvent(sig,_535);
-}else{
-src[sig]=_535;
+if(typeof (_555)!=&quot;function&quot;){
+throw new Error(&quot;'funcOrStr' must be a function or string&quot;);
 }
 }
-src._listeners[sig]=_535;
+}else{
+if(typeof (_554)!=&quot;function&quot;){
+throw new Error(&quot;'objOrFunc' must be a function if 'funcOrStr' is not given&quot;);
+}else{
+func=_554;
 }
-if(!src._signals){
-src._signals={};
 }
-if(!src._signals[sig]){
-src._signals[sig]=[];
+if(typeof (obj)==&quot;undefined&quot;||obj===null){
+obj=src;
 }
+var _556=!!(src.addEventListener||src.attachEvent);
+var _557=self._listener(src,func,obj,_556);
+if(src.addEventListener){
+src.addEventListener(sig.substr(2),_557,false);
 }else{
-if(!src._signals||!src._signals[sig]){
-throw new Error(&quot;No such signal '&quot;+sig+&quot;' registered.&quot;);
+if(src.attachEvent){
+src.attachEvent(sig,_557);
 }
 }
-var _538=src._signals[sig];
-for(var i=0;i&lt;_538.length;i++){
-var s=_538[i];
-if(slot[0]===s[0]&amp;&amp;slot[1]===s[1]&amp;&amp;slot[2]===s[2]){
+var _558=[src,sig,_557,_556,_554,_555];
+self._observers.push(_558);
+return _558;
+},_disconnect:function(_559){
+if(!_559[3]){
 return;
 }
+var src=_559[0];
+var sig=_559[1];
+var _560=_559[2];
+if(src.removeEventListener){
+src.removeEventListener(sig.substr(2),_560,false);
+}else{
+if(src.detachEvent){
+src.detachEvent(sig,_560);
+}else{
+throw new Error(&quot;'src' must be a DOM element&quot;);
 }
-_538.push(slot);
-},disconnect:function(src,sig,slot,func){
-if(typeof (src)==&quot;string&quot;){
-src=MochiKit.DOM.getElement(src);
 }
-if(typeof (sig)!=&quot;string&quot;){
-throw new Error(&quot;'signal' must be a string&quot;);
+},disconnect:function(_561){
+var self=MochiKit.Signal;
+var _562=self._observers;
+var m=MochiKit.Base;
+if(arguments.length&gt;1){
+var src=MochiKit.DOM.getElement(arguments[0]);
+var sig=arguments[1];
+var obj=arguments[2];
+var func=arguments[3];
+for(var i=_562.length-1;i&gt;=0;i--){
+var o=_562[i];
+if(o[0]===src&amp;&amp;o[1]===sig&amp;&amp;o[4]===obj&amp;&amp;o[5]===func){
+self._disconnect(o);
+_562.splice(i,1);
+return true;
 }
-slot=MochiKit.Signal._getSlot(slot,func);
-if(src._signals&amp;&amp;src._signals[sig]){
-var _539=src._signals[sig];
-var _540=_539.length;
-for(var i=0;i&lt;_539.length;i++){
-var s=_539[i];
-if(s[0]===slot[0]&amp;&amp;s[1]===slot[1]&amp;&amp;s[2]===slot[2]){
-_539.splice(i,1);
-break;
 }
-}
 }else{
-throw new Error(&quot;Invalid signal to disconnect&quot;);
+var idx=m.findIdentical(_562,_561);
+if(idx&gt;=0){
+self._disconnect(_561);
+_562.splice(idx,1);
+return true;
 }
-if(src.addEventListener||src.attachEvent||src._signals[sig]){
-if(src._listeners&amp;&amp;src._listeners[sig]&amp;&amp;src._signals[sig].length===0){
-var _541=src._listeners[sig];
-if(src.addEventListener){
-src.removeEventListener(sig.substr(2),_541,false);
-}else{
-if(src.attachEvent){
-src.detachEvent(sig,_541);
-}else{
-src._signals[sig]=undefined;
 }
+return false;
+},disconnectAll:function(src,sig){
+src=MochiKit.DOM.getElement(src);
+var m=MochiKit.Base;
+var _563=m.flattenArguments(m.extend(null,arguments,1));
+var self=MochiKit.Signal;
+var _564=self._disconnect;
+var _565=self._observers;
+if(_563.length===0){
+for(var i=_565.length-1;i&gt;=0;i--){
+var _566=_565[i];
+if(_566[0]===src){
+_564(_566);
+_565.splice(i,1);
 }
-var _542=MochiKit.Signal._observers;
-for(var i=0;i&lt;_542.length;i++){
-var o=_542[i];
-if(o[0]===src&amp;&amp;o[1]===sig&amp;&amp;o[2]===_541){
-_542.splice(i,1);
-break;
 }
+}else{
+var sigs={};
+for(var i=0;i&lt;_563.length;i++){
+sigs[_563[i]]=true;
 }
-src._listeners[sig]=undefined;
+for(var i=_565.length-1;i&gt;=0;i--){
+var _566=_565[i];
+if(_566[0]===src&amp;&amp;_566[1] in sigs){
+_564(_566);
+_565.splice(i,1);
 }
 }
+}
 },signal:function(src,sig){
-if(typeof (src)==&quot;string&quot;){
+var _568=MochiKit.Signal._observers;
 src=MochiKit.DOM.getElement(src);
-}
-if(typeof (sig)!=&quot;string&quot;){
-throw new Error(&quot;'signal' must be a string&quot;);
-}
-if(!src._signals||!src._signals[sig]){
-if(src.addEventListener||src.attachEvent||src[sig]){
-return;
-}else{
-throw new Error(&quot;No such signal '&quot;+sig+&quot;'&quot;);
-}
-}
-var _543=src._signals[sig];
 var args=MochiKit.Base.extend(null,arguments,2);
-var slot;
-var _544=[];
-for(var i=0;i&lt;_543.length;i++){
-slot=_543[i];
+var _569=[];
+for(var i=0;i&lt;_568.length;i++){
+var _570=_568[i];
+if(_570[0]===src&amp;&amp;_570[1]===sig){
 try{
-if(slot.length==1){
-slot[0].apply(src,args);
-}else{
-if(typeof (slot[1])==&quot;string&quot;){
-slot[0][slot[1]].apply(slot[0],args);
-}else{
-slot[1].apply(slot[0],args);
+_570[2].apply(src,args);
 }
+catch(e){
+_569.push(e);
 }
 }
-catch(e){
-_544.push(e);
 }
-}
-if(_544.length==1){
-throw _544[0];
+if(_569.length==1){
+throw _569[0];
 }else{
-if(_544.length){
-var e=new Error(&quot;There were errors in handling signal 'sig'.&quot;);
-e.errors=_544;
+if(_569.length&gt;1){
+var e=new Error(&quot;Multiple errors thrown in handling 'sig', see errors property&quot;);
+e.errors=_569;
 throw e;
 }
 }
-},registerSignals:function(src,_545){
-if(!src._signals){
-src._signals={};
-}
-for(var i=0;i&lt;_545.length;i++){
-var sig=_545[i];
-if(!src._signals[sig]){
-src._signals[sig]=[];
-}
-}
 }});
 MochiKit.Signal.EXPORT_OK=[];
-MochiKit.Signal.EXPORT=[&quot;connect&quot;,&quot;disconnect&quot;,&quot;signal&quot;,&quot;registerSignals&quot;];
+MochiKit.Signal.EXPORT=[&quot;connect&quot;,&quot;disconnect&quot;,&quot;signal&quot;,&quot;disconnectAll&quot;];
 MochiKit.Signal.__new__=function(win){
 var m=MochiKit.Base;
 this._document=document;
@@ -4235,6 +4385,12 @@
 m.nameFunctions(this);
 };
 MochiKit.Signal.__new__(this);
+if(!MochiKit.__compat__){
+connect=MochiKit.Signal.connect;
+disconnect=MochiKit.Signal.disconnect;
+disconnectAll=MochiKit.Signal.disconnectAll;
+signal=MochiKit.Signal.signal;
+}
 MochiKit.Base._exportSymbols(this,MochiKit.Signal);
 if(typeof (dojo)!=&quot;undefined&quot;){
 dojo.provide(&quot;MochiKit.Visual&quot;);
@@ -4259,198 +4415,198 @@
 MochiKit.Visual={};
 }
 MochiKit.Visual.NAME=&quot;MochiKit.Visual&quot;;
-MochiKit.Visual.VERSION=&quot;1.3&quot;;
+MochiKit.Visual.VERSION=&quot;1.3.1&quot;;
 MochiKit.Visual.__repr__=function(){
 return &quot;[&quot;+this.NAME+&quot; &quot;+this.VERSION+&quot;]&quot;;
 };
 MochiKit.Visual.toString=function(){
 return this.__repr__();
 };
-MochiKit.Visual._RoundCorners=function(e,_546){
+MochiKit.Visual._RoundCorners=function(e,_571){
 e=MochiKit.DOM.getElement(e);
-this._setOptions(_546);
+this._setOptions(_571);
 if(this.options.__unstable__wrapElement){
 e=this._doWrap(e);
 }
-var _547=this.options.color;
+var _572=this.options.color;
 var C=MochiKit.Color.Color;
 if(this.options.color==&quot;fromElement&quot;){
-_547=C.fromBackground(e);
+_572=C.fromBackground(e);
 }else{
-if(!(_547 instanceof C)){
-_547=C.fromString(_547);
+if(!(_572 instanceof C)){
+_572=C.fromString(_572);
 }
 }
-this.isTransparent=(_547.asRGB().a&lt;=0);
-var _549=this.options.bgColor;
+this.isTransparent=(_572.asRGB().a&lt;=0);
+var _574=this.options.bgColor;
 if(this.options.bgColor==&quot;fromParent&quot;){
-_549=C.fromBackground(e.offsetParent);
+_574=C.fromBackground(e.offsetParent);
 }else{
-if(!(_549 instanceof C)){
-_549=C.fromString(_549);
+if(!(_574 instanceof C)){
+_574=C.fromString(_574);
 }
 }
-this._roundCornersImpl(e,_547,_549);
+this._roundCornersImpl(e,_572,_574);
 };
 MochiKit.Visual._RoundCorners.prototype={_doWrap:function(e){
-var _550=e.parentNode;
+var _575=e.parentNode;
 var doc=MochiKit.DOM.currentDocument();
-if(typeof (doc.defaultView)==&quot;undefined&quot;||doc.defaultView==null){
+if(typeof (doc.defaultView)==&quot;undefined&quot;||doc.defaultView===null){
 return e;
 }
-var _551=doc.defaultView.getComputedStyle(e,null);
-if(typeof (_551)==&quot;undefined&quot;||_551==null){
+var _576=doc.defaultView.getComputedStyle(e,null);
+if(typeof (_576)==&quot;undefined&quot;||_576===null){
 return e;
 }
-var _552=MochiKit.DOM.DIV({&quot;style&quot;:{display:&quot;block&quot;,marginTop:_551.getPropertyValue(&quot;padding-top&quot;),marginRight:_551.getPropertyValue(&quot;padding-right&quot;),marginBottom:_551.getPropertyValue(&quot;padding-bottom&quot;),marginLeft:_551.getPropertyValue(&quot;padding-left&quot;),padding:&quot;0px&quot;}});
-_552.innerHTML=e.innerHTML;
+var _577=MochiKit.DOM.DIV({&quot;style&quot;:{display:&quot;block&quot;,marginTop:_576.getPropertyValue(&quot;padding-top&quot;),marginRight:_576.getPropertyValue(&quot;padding-right&quot;),marginBottom:_576.getPropertyValue(&quot;padding-bottom&quot;),marginLeft:_576.getPropertyValue(&quot;padding-left&quot;),padding:&quot;0px&quot;}});
+_577.innerHTML=e.innerHTML;
 e.innerHTML=&quot;&quot;;
-e.appendChild(_552);
+e.appendChild(_577);
 return e;
-},_roundCornersImpl:function(e,_553,_554){
+},_roundCornersImpl:function(e,_578,_579){
 if(this.options.border){
-this._renderBorder(e,_554);
+this._renderBorder(e,_579);
 }
 if(this._isTopRounded()){
-this._roundTopCorners(e,_553,_554);
+this._roundTopCorners(e,_578,_579);
 }
 if(this._isBottomRounded()){
-this._roundBottomCorners(e,_553,_554);
+this._roundBottomCorners(e,_578,_579);
 }
-},_renderBorder:function(el,_555){
-var _556=&quot;1px solid &quot;+this._borderColor(_555);
-var _557=&quot;border-left: &quot;+_556;
-var _558=&quot;border-right: &quot;+_556;
-var _559=&quot;style='&quot;+_557+&quot;;&quot;+_558+&quot;'&quot;;
-el.innerHTML=&quot;&lt;div &quot;+_559+&quot;&gt;&quot;+el.innerHTML+&quot;&lt;/div&gt;&quot;;
-},_roundTopCorners:function(el,_560,_561){
-var _562=this._createCorner(_561);
+},_renderBorder:function(el,_580){
+var _581=&quot;1px solid &quot;+this._borderColor(_580);
+var _582=&quot;border-left: &quot;+_581;
+var _583=&quot;border-right: &quot;+_581;
+var _584=&quot;style='&quot;+_582+&quot;;&quot;+_583+&quot;'&quot;;
+el.innerHTML=&quot;&lt;div &quot;+_584+&quot;&gt;&quot;+el.innerHTML+&quot;&lt;/div&gt;&quot;;
+},_roundTopCorners:function(el,_585,_586){
+var _587=this._createCorner(_586);
 for(var i=0;i&lt;this.options.numSlices;i++){
-_562.appendChild(this._createCornerSlice(_560,_561,i,&quot;top&quot;));
+_587.appendChild(this._createCornerSlice(_585,_586,i,&quot;top&quot;));
 }
 el.style.paddingTop=0;
-el.insertBefore(_562,el.firstChild);
-},_roundBottomCorners:function(el,_563,_564){
-var _565=this._createCorner(_564);
+el.insertBefore(_587,el.firstChild);
+},_roundBottomCorners:function(el,_588,_589){
+var _590=this._createCorner(_589);
 for(var i=(this.options.numSlices-1);i&gt;=0;i--){
-_565.appendChild(this._createCornerSlice(_563,_564,i,&quot;bottom&quot;));
+_590.appendChild(this._createCornerSlice(_588,_589,i,&quot;bottom&quot;));
 }
 el.style.paddingBottom=0;
-el.appendChild(_565);
-},_createCorner:function(_566){
+el.appendChild(_590);
+},_createCorner:function(_591){
 var dom=MochiKit.DOM;
-return dom.DIV({style:{backgroundColor:_566.toString()}});
-},_createCornerSlice:function(_567,_568,n,_569){
-var _570=MochiKit.DOM.SPAN();
-var _571=_570.style;
-_571.backgroundColor=_567.toString();
-_571.display=&quot;block&quot;;
-_571.height=&quot;1px&quot;;
-_571.overflow=&quot;hidden&quot;;
-_571.fontSize=&quot;1px&quot;;
-var _572=this._borderColor(_567,_568);
-if(this.options.border&amp;&amp;n==0){
-_571.borderTopStyle=&quot;solid&quot;;
-_571.borderTopWidth=&quot;1px&quot;;
-_571.borderLeftWidth=&quot;0px&quot;;
-_571.borderRightWidth=&quot;0px&quot;;
-_571.borderBottomWidth=&quot;0px&quot;;
-_571.height=&quot;0px&quot;;
-_571.borderColor=_572.toString();
+return dom.DIV({style:{backgroundColor:_591.toString()}});
+},_createCornerSlice:function(_592,_593,n,_594){
+var _595=MochiKit.DOM.SPAN();
+var _596=_595.style;
+_596.backgroundColor=_592.toString();
+_596.display=&quot;block&quot;;
+_596.height=&quot;1px&quot;;
+_596.overflow=&quot;hidden&quot;;
+_596.fontSize=&quot;1px&quot;;
+var _597=this._borderColor(_592,_593);
+if(this.options.border&amp;&amp;n===0){
+_596.borderTopStyle=&quot;solid&quot;;
+_596.borderTopWidth=&quot;1px&quot;;
+_596.borderLeftWidth=&quot;0px&quot;;
+_596.borderRightWidth=&quot;0px&quot;;
+_596.borderBottomWidth=&quot;0px&quot;;
+_596.height=&quot;0px&quot;;
+_596.borderColor=_597.toString();
 }else{
-if(_572){
-_571.borderColor=_572.toString();
-_571.borderStyle=&quot;solid&quot;;
-_571.borderWidth=&quot;0px 1px&quot;;
+if(_597){
+_596.borderColor=_597.toString();
+_596.borderStyle=&quot;solid&quot;;
+_596.borderWidth=&quot;0px 1px&quot;;
 }
 }
 if(!this.options.compact&amp;&amp;(n==(this.options.numSlices-1))){
-_571.height=&quot;2px&quot;;
+_596.height=&quot;2px&quot;;
 }
-this._setMargin(_570,n,_569);
-this._setBorder(_570,n,_569);
-return _570;
-},_setOptions:function(_573){
+this._setMargin(_595,n,_594);
+this._setBorder(_595,n,_594);
+return _595;
+},_setOptions:function(_598){
 this.options={corners:&quot;all&quot;,color:&quot;fromElement&quot;,bgColor:&quot;fromParent&quot;,blend:true,border:false,compact:false,__unstable__wrapElement:false};
-MochiKit.Base.update(this.options,_573);
+MochiKit.Base.update(this.options,_598);
 this.options.numSlices=(this.options.compact?2:4);
 },_whichSideTop:function(){
-var _574=this.options.corners;
-if(this._hasString(_574,&quot;all&quot;,&quot;top&quot;)){
+var _599=this.options.corners;
+if(this._hasString(_599,&quot;all&quot;,&quot;top&quot;)){
 return &quot;&quot;;
 }
-var _575=(_574.indexOf(&quot;tl&quot;)!=-1);
-var _576=(_574.indexOf(&quot;tr&quot;)!=-1);
-if(_575&amp;&amp;_576){
+var _600=(_599.indexOf(&quot;tl&quot;)!=-1);
+var _601=(_599.indexOf(&quot;tr&quot;)!=-1);
+if(_600&amp;&amp;_601){
 return &quot;&quot;;
 }
-if(_575){
+if(_600){
 return &quot;left&quot;;
 }
-if(_576){
+if(_601){
 return &quot;right&quot;;
 }
 return &quot;&quot;;
 },_whichSideBottom:function(){
-var _577=this.options.corners;
-if(this._hasString(_577,&quot;all&quot;,&quot;bottom&quot;)){
+var _602=this.options.corners;
+if(this._hasString(_602,&quot;all&quot;,&quot;bottom&quot;)){
 return &quot;&quot;;
 }
-var _578=(_577.indexOf(&quot;bl&quot;)!=-1);
-var _579=(_577.indexOf(&quot;br&quot;)!=-1);
-if(_578&amp;&amp;_579){
+var _603=(_602.indexOf(&quot;bl&quot;)!=-1);
+var _604=(_602.indexOf(&quot;br&quot;)!=-1);
+if(_603&amp;&amp;_604){
 return &quot;&quot;;
 }
-if(_578){
+if(_603){
 return &quot;left&quot;;
 }
-if(_579){
+if(_604){
 return &quot;right&quot;;
 }
 return &quot;&quot;;
-},_borderColor:function(_580,_581){
-if(_580==&quot;transparent&quot;){
-return _581;
+},_borderColor:function(_605,_606){
+if(_605==&quot;transparent&quot;){
+return _606;
 }else{
 if(this.options.border){
 return this.options.border;
 }else{
 if(this.options.blend){
-return _581.blendedColor(_580);
+return _606.blendedColor(_605);
 }
 }
 }
 return &quot;&quot;;
-},_setMargin:function(el,n,_582){
-var _583=this._marginSize(n)+&quot;px&quot;;
-var _584=(_582==&quot;top&quot;?this._whichSideTop():this._whichSideBottom());
-var _585=el.style;
-if(_584==&quot;left&quot;){
-_585.marginLeft=_583;
-_585.marginRight=&quot;0px&quot;;
+},_setMargin:function(el,n,_607){
+var _608=this._marginSize(n)+&quot;px&quot;;
+var _609=(_607==&quot;top&quot;?this._whichSideTop():this._whichSideBottom());
+var _610=el.style;
+if(_609==&quot;left&quot;){
+_610.marginLeft=_608;
+_610.marginRight=&quot;0px&quot;;
 }else{
-if(_584==&quot;right&quot;){
-_585.marginRight=_583;
-_585.marginLeft=&quot;0px&quot;;
+if(_609==&quot;right&quot;){
+_610.marginRight=_608;
+_610.marginLeft=&quot;0px&quot;;
 }else{
-_585.marginLeft=_583;
-_585.marginRight=_583;
+_610.marginLeft=_608;
+_610.marginRight=_608;
 }
 }
-},_setBorder:function(el,n,_586){
-var _587=this._borderSize(n)+&quot;px&quot;;
-var _588=(_586==&quot;top&quot;?this._whichSideTop():this._whichSideBottom());
-var _589=el.style;
-if(_588==&quot;left&quot;){
-_589.borderLeftWidth=_587;
-_589.borderRightWidth=&quot;0px&quot;;
+},_setBorder:function(el,n,_611){
+var _612=this._borderSize(n)+&quot;px&quot;;
+var _613=(_611==&quot;top&quot;?this._whichSideTop():this._whichSideBottom());
+var _614=el.style;
+if(_613==&quot;left&quot;){
+_614.borderLeftWidth=_612;
+_614.borderRightWidth=&quot;0px&quot;;
 }else{
-if(_588==&quot;right&quot;){
-_589.borderRightWidth=_587;
-_589.borderLeftWidth=&quot;0px&quot;;
+if(_613==&quot;right&quot;){
+_614.borderRightWidth=_612;
+_614.borderLeftWidth=&quot;0px&quot;;
 }else{
-_589.borderLeftWidth=_587;
-_589.borderRightWidth=_587;
+_614.borderLeftWidth=_612;
+_614.borderRightWidth=_612;
 }
 }
 },_marginSize:function(n){
@@ -4459,39 +4615,39 @@
 }
 var o=this.options;
 if(o.compact&amp;&amp;o.blend){
-var _590=[1,0];
-return _590[n];
+var _615=[1,0];
+return _615[n];
 }else{
 if(o.compact){
-var _591=[2,1];
-return _591[n];
+var _616=[2,1];
+return _616[n];
 }else{
 if(o.blend){
-var _592=[3,2,1,0];
-return _592[n];
+var _617=[3,2,1,0];
+return _617[n];
 }else{
-var _593=[5,3,2,1];
-return _593[n];
+var _618=[5,3,2,1];
+return _618[n];
 }
 }
 }
 },_borderSize:function(n){
 var o=this.options;
-var _594;
+var _619;
 if(o.compact&amp;&amp;(o.blend||this.isTransparent)){
 return 1;
 }else{
 if(o.compact){
-_594=[1,0];
+_619=[1,0];
 }else{
 if(o.blend){
-_594=[2,1,1,1];
+_619=[2,1,1,1];
 }else{
 if(o.border){
-_594=[0,2,0,0];
+_619=[0,2,0,0];
 }else{
 if(this.isTransparent){
-_594=[5,3,2,1];
+_619=[5,3,2,1];
 }else{
 return 0;
 }
@@ -4499,7 +4655,7 @@
 }
 }
 }
-return _594[n];
+return _619[n];
 },_hasString:function(str){
 for(var i=1;i&lt;arguments.length;i++){
 if(str.indexOf(arguments[i])!=-1){
@@ -4514,13 +4670,13 @@
 },_hasSingleTextChild:function(el){
 return (el.childNodes.length==1&amp;&amp;el.childNodes[0].nodeType==3);
 }};
-MochiKit.Visual.roundElement=function(e,_595){
-new MochiKit.Visual._RoundCorners(e,_595);
+MochiKit.Visual.roundElement=function(e,_620){
+new MochiKit.Visual._RoundCorners(e,_620);
 };
-MochiKit.Visual.roundClass=function(_596,_597,_598){
-var _599=MochiKit.DOM.getElementsByTagAndClassName(_596,_597);
-for(var i=0;i&lt;_599.length;i++){
-MochiKit.Visual.roundElement(_599[i],_598);
+MochiKit.Visual.roundClass=function(_621,_622,_623){
+var _624=MochiKit.DOM.getElementsByTagAndClassName(_621,_622);
+for(var i=0;i&lt;_624.length;i++){
+MochiKit.Visual.roundElement(_624[i],_623);
 }
 };
 MochiKit.Visual.Color=MochiKit.Color.Color;
@@ -4541,7 +4697,7 @@
 MochiKit.MochiKit={};
 }
 MochiKit.MochiKit.NAME=&quot;MochiKit.MochiKit&quot;;
-MochiKit.MochiKit.VERSION=&quot;1.3&quot;;
+MochiKit.MochiKit.VERSION=&quot;1.3.1&quot;;
 MochiKit.MochiKit.__repr__=function(){
 return &quot;[&quot;+this.NAME+&quot; &quot;+this.VERSION+&quot;]&quot;;
 };
@@ -4568,23 +4724,23 @@
 JSAN.use(&quot;MochiKit.Visual&quot;,[]);
 }
 (function(){
-var _600=MochiKit.Base.extend;
+var _625=MochiKit.Base.extend;
 var self=MochiKit.MochiKit;
-var _601=self.SUBMODULES;
-var _602=[];
-var _603=[];
-var _604={};
+var _626=self.SUBMODULES;
+var _627=[];
+var _628=[];
+var _629={};
 var i,k,m,all;
-for(i=0;i&lt;_601.length;i++){
-m=MochiKit[_601[i]];
-_600(_602,m.EXPORT);
-_600(_603,m.EXPORT_OK);
+for(i=0;i&lt;_626.length;i++){
+m=MochiKit[_626[i]];
+_625(_627,m.EXPORT);
+_625(_628,m.EXPORT_OK);
 for(k in m.EXPORT_TAGS){
-_604[k]=_600(_604[k],m.EXPORT_TAGS[k]);
+_629[k]=_625(_629[k],m.EXPORT_TAGS[k]);
 }
 all=m.EXPORT_TAGS[&quot;:all&quot;];
 if(!all){
-all=_600(null,m.EXPORT,m.EXPORT_OK);
+all=_625(null,m.EXPORT,m.EXPORT_OK);
 }
 var j;
 for(j=0;j&lt;all.length;j++){
@@ -4592,50 +4748,50 @@
 self[k]=m[k];
 }
 }
-self.EXPORT=_602;
-self.EXPORT_OK=_603;
-self.EXPORT_TAGS=_604;
+self.EXPORT=_627;
+self.EXPORT_OK=_628;
+self.EXPORT_TAGS=_629;
 }());
 }else{
 if(typeof (MochiKit.__compat__)==&quot;undefined&quot;){
 MochiKit.__compat__=true;
 }
 (function(){
-var _605=document.getElementsByTagName(&quot;script&quot;);
-var _606=&quot;<A HREF="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul</A>&quot;;
+var _630=document.getElementsByTagName(&quot;script&quot;);
+var _631=&quot;<A HREF="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul</A>&quot;;
 var base=null;
-var _607=null;
-var _608={};
+var _632=null;
+var _633={};
 var i;
-for(i=0;i&lt;_605.length;i++){
-var src=_605[i].getAttribute(&quot;src&quot;);
+for(i=0;i&lt;_630.length;i++){
+var src=_630[i].getAttribute(&quot;src&quot;);
 if(!src){
 continue;
 }
-_608[src]=true;
+_633[src]=true;
 if(src.match(/MochiKit.js$/)){
 base=src.substring(0,src.lastIndexOf(&quot;MochiKit.js&quot;));
-_607=_605[i];
+_632=_630[i];
 }
 }
-if(base==null){
+if(base===null){
 return;
 }
-var _609=MochiKit.MochiKit.SUBMODULES;
-for(var i=0;i&lt;_609.length;i++){
-if(MochiKit[_609[i]]){
+var _634=MochiKit.MochiKit.SUBMODULES;
+for(var i=0;i&lt;_634.length;i++){
+if(MochiKit[_634[i]]){
 continue;
 }
-var uri=base+_609[i]+&quot;.js&quot;;
-if(uri in _608){
+var uri=base+_634[i]+&quot;.js&quot;;
+if(uri in _633){
 continue;
 }
-if(document.documentElement&amp;&amp;document.documentElement.namespaceURI==_606){
-var s=document.createElementNS(_606,&quot;script&quot;);
-s.setAttribute(&quot;id&quot;,&quot;MochiKit_&quot;+base+_609[i]);
+if(document.documentElement&amp;&amp;document.documentElement.namespaceURI==_631){
+var s=document.createElementNS(_631,&quot;script&quot;);
+s.setAttribute(&quot;id&quot;,&quot;MochiKit_&quot;+base+_634[i]);
 s.setAttribute(&quot;src&quot;,uri);
 s.setAttribute(&quot;type&quot;,&quot;application/x-javascript&quot;);
-_607.parentNode.appendChild(s);
+_632.parentNode.appendChild(s);
 }else{
 document.write(&quot;&lt;script src=\&quot;&quot;+uri+&quot;\&quot; type=\&quot;text/javascript\&quot;&gt;&lt;/script&gt;&quot;);
 }

Modified: trunk/src/Model.js
===================================================================
--- trunk/src/Model.js	2006-04-28 21:18:29 UTC (rev 61)
+++ trunk/src/Model.js	2006-04-29 09:20:10 UTC (rev 62)
@@ -6,7 +6,6 @@
 	this.ready = false;
 	this.document = null;
 	this._query = query;
-	Freja._aux.registerSignals(this, [&quot;onload&quot;]);
 };
 /**
   * Returns a single value

Modified: trunk/src/QueryEngine.js
===================================================================
--- trunk/src/QueryEngine.js	2006-04-28 21:18:29 UTC (rev 61)
+++ trunk/src/QueryEngine.js	2006-04-29 09:20:10 UTC (rev 62)
@@ -19,7 +19,7 @@
 		return null;
 	}
 	if(node) return node.nodeValue;
-	
+
 };
 Freja.QueryEngine.prototype.set = function(document, expression, value) {
 	try {
@@ -28,8 +28,8 @@
 			node.nodeValue = value;
 	} catch(x) {
 		// text node not found. Might need to be created.
-		// try not to process field names that are not meant to be xpath expressions  
-		if(expression.lastIndexOf('/') != -1) {		
+		// try not to process field names that are not meant to be xpath expressions
+		if(expression.lastIndexOf('/') != -1) {
 			var nodeName = expression.substr(expression.lastIndexOf('/')+1);
 			if(nodeName.charAt(0)=='@') {
 				// trying to set a non-existing attribute. Let's create it.
@@ -54,21 +54,21 @@
 	var node = document.selectSingleNode(expression);
 	if (node &amp;&amp; node.nodeType == 2) {
 		return node;
-	} 
+	}
 	if (node &amp;&amp; node.firstChild &amp;&amp; node.firstChild.nodeType == 3) {
 		return node.firstChild;
-	} 
+	}
 	if (node &amp;&amp; node.firstChild &amp;&amp; node.firstChild.nodeType == 4) {
 		return node.firstChild;
-	} 
+	}
 	if (node &amp;&amp; node.nodeType==1 &amp;&amp; !node.firstChild) {
 		// empty element (&lt;tag/&gt;). Let's create and return a blank text node
-		return node.appendChild(document.createTextNode(''));			  
+		return node.appendChild(window.document.createTextNode(''));
 	}
-	
+
 	throw new Error(&quot;Can't evaluate expression &quot; + expression);
 	return null;
-}; 
+};
 /**
   * SimplePath
   */
@@ -91,7 +91,7 @@
 		if(filter) {
 			// filter[1] element name, filter[2] attribute name, filter[3] attribute value
 			if(i&gt;0 &amp;&amp; parts[i-1]=='') {
-				// expression was of type //element[...] 
+				// expression was of type //element[...]
 				var cn = node.getElementsByTagName(filter[1]);
 			} else {
 				var cn = node.childNodes;
@@ -105,7 +105,7 @@
 			if (j==l)
 				throw new Error(&quot;Can't evaluate expression &quot; + part);
 		}
-		else {		
+		else {
 			offset = regOffset.exec(part);
 			if (offset) {
 				part = offset[1];
@@ -125,16 +125,16 @@
 	}
 	if (node &amp;&amp; node.firstChild &amp;&amp; node.firstChild.nodeType == 3) {
 		return node.firstChild;
-	} 
+	}
 	if (node &amp;&amp; node.firstChild &amp;&amp; node.firstChild.nodeType == 4) {
 		return node.firstChild;
 	}
 	if (node &amp;&amp; node.nodeType==1 &amp;&amp; !node.firstChild) {
 		// empty element (&lt;tag/&gt;). Let's create and return a blank text node
-		return node.appendChild(document.createTextNode(''));			  
+		return node.appendChild(window.document.createTextNode(''));
 	}
-	
-	if (!node) {		
+
+	if (!node) {
 		throw new Error(&quot;Can't evaluate expression &quot; + expression);
 	}
 	return node;

Modified: trunk/src/View.js
===================================================================
--- trunk/src/View.js	2006-04-28 21:18:29 UTC (rev 61)
+++ trunk/src/View.js	2006-04-29 09:20:10 UTC (rev 62)
@@ -9,7 +9,6 @@
 	this._destination = null;
 	this.behaviors = [];
 	this.placeholder = null;
-	Freja._aux.registerSignals(this, [&quot;onload&quot;,&quot;onrendercomplete&quot;]);
 	Freja._aux.connect(this, &quot;onrendercomplete&quot;, Freja._aux.bind(this._connectBehavior, this));
 };
 /**
@@ -106,8 +105,8 @@
 				var child = c[i];
 				if (child.nodeType == 1) {
 					if(child.className) {
-						var classNames = child.className.split(' ');						
-						for (var j=0;j&lt;classNames.length;j++) {											
+						var classNames = child.className.split(' ');
+						for (var j=0;j&lt;classNames.length;j++) {
 							var handler = behaviors[classNames[j]];
 							if (handler) {
 								for (var eventType in handler) {
@@ -193,14 +192,14 @@
 	// prepare posted data  (no need to send the XSL document, just its url)
 	var xslUrl = view.url;
 	var postedData = &quot;xslFile=&quot; + encodeURIComponent(xslUrl) + &quot;&amp;xmlData=&quot; + encodeURIComponent(Freja._aux.serializeXML(model.document));
-	
+
 	var xslParameterString = '';
 	for (var paramname in xslParameters) {
 		xslParameterString += encodeURIComponent(paramname + &quot;,&quot; + xslParameters[paramname]);
 	}
 	if(xslParameterString.length &gt; 0) {
 		postedData  = postedData + '&amp;xslParam=' + xslParameterString;
-	} 
+	}
 
 	// send request to the server-side XSL transformation service
 	var req = Freja.AssetManager.openXMLHttpRequest(&quot;POST&quot;, Freja.AssetManager.XSLT_SERVICE_URL);

Modified: trunk/src/auxiliary/minimal.js
===================================================================
--- trunk/src/auxiliary/minimal.js	2006-04-28 21:18:29 UTC (rev 61)
+++ trunk/src/auxiliary/minimal.js	2006-04-29 09:20:10 UTC (rev 62)
@@ -84,8 +84,6 @@
 	}
 };
 
-/** registerSignals(src, signals) : void */
-Freja._aux.registerSignals = function(src, signals) { /* void */ };
 /** connect(src, signal, fnc) : void */
 Freja._aux.connect = function(src, signal, fnc) {
 

Modified: trunk/src/auxiliary/mochi+sarissa.js
===================================================================
--- trunk/src/auxiliary/mochi+sarissa.js	2006-04-28 21:18:29 UTC (rev 61)
+++ trunk/src/auxiliary/mochi+sarissa.js	2006-04-29 09:20:10 UTC (rev 62)
@@ -47,8 +47,6 @@
 /** getElement(id) : HTMLElement */
 Freja._aux.getElement = MochiKit.DOM.getElement;
 
-/** registerSignals(src, signals) : void */
-Freja._aux.registerSignals = MochiKit.Signal.registerSignals;
 /** connect(src, signal, fnc) : void */
 Freja._aux.connect = MochiKit.Signal.connect;
 /** signal(src, signal, arg) : void */

Modified: trunk/tests/data/form-view.xsl
===================================================================
--- trunk/tests/data/form-view.xsl	2006-04-28 21:18:29 UTC (rev 61)
+++ trunk/tests/data/form-view.xsl	2006-04-29 09:20:10 UTC (rev 62)
@@ -3,11 +3,11 @@
 	xmlns:xsl=&quot;<A HREF="http://www.w3.org/1999/XSL/Transform">http://www.w3.org/1999/XSL/Transform</A>&quot;&gt;
 
 &lt;xsl:template match=&quot;item&quot;&gt;	
-	&lt;form method=&quot;post&quot; freja-behaviour=&quot;form&quot;&gt;
+	&lt;form method=&quot;post&quot; class=&quot;form&quot;&gt;
 		&lt;h3&gt;&lt;input name=&quot;item/name&quot; type=&quot;text&quot; value=&quot;{name}&quot; /&gt;&lt;/h3&gt;
 		&lt;p&gt;&lt;textarea name=&quot;item/description&quot;&gt;&lt;xsl:value-of select=&quot;description&quot; /&gt;&lt;/textarea&gt;&lt;/p&gt;
 		&lt;p&gt;&lt;input name=&quot;item/price&quot; type=&quot;text&quot; value=&quot;{price}&quot; /&gt;&lt;/p&gt;
-		&lt;input type=&quot;submit&quot; value=&quot;ok&quot; freja-behaviour=&quot;form-submit&quot; id=&quot;form-submit&quot; /&gt;
+		&lt;input type=&quot;submit&quot; value=&quot;ok&quot; class=&quot;form-submit&quot; id=&quot;form-submit&quot; /&gt;
 	&lt;/form&gt;
 &lt;/xsl:template&gt;
 

Modified: trunk/tests/test_View.js
===================================================================
--- trunk/tests/test_View.js	2006-04-28 21:18:29 UTC (rev 61)
+++ trunk/tests/test_View.js	2006-04-29 09:20:10 UTC (rev 62)
@@ -36,7 +36,8 @@
 	// test of form
 	var formView = Freja.AssetManager.getView(&quot;data/form-view.xsl&quot;);
 	var testofsubmit = false;
-	formView.behaviours[&quot;form&quot;] = {
+
+	formView.behaviors[&quot;form&quot;] = {
 		onsubmit : function() { testofsubmit = true; }
 	};
 	formView.render(model, out);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000059.html">[Freja-svn] r61 - trunk/src
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58">[ date ]</a>
              <a href="thread.html#58">[ thread ]</a>
              <a href="subject.html#58">[ subject ]</a>
              <a href="author.html#58">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/freja-svn">More information about the Freja-svn
mailing list</a><br>
</body></html>
